montageDefine("b7b5e36","ui/component",{dependencies:["../core/core","../core/target","../core/template","../core/document-resources","../core/gate","../core/promise","../core/event/event-manager","../core/serialization/alias","../core/logger","../core/logger","../core/logger","../core/logger","../core/logger","collections/weak-map","collections/map","collections/set","../core/application","../core/core","../core/core"],factory:function(e,t,i){function r(e){return e?e._montage_metadata.objectName+":"+Object.hash(e)+" id: "+e.identifier:"NIL"}var n,a=e("../core/core").Montage,o=e("../core/target").Target,s=e("../core/template").Template,l=e("../core/document-resources").DocumentResources,u=e("../core/gate").Gate,c=e("../core/promise").Promise,h=e("../core/event/event-manager").defaultEventManager,d=e("../core/serialization/alias").Alias,p=e("../core/logger").logger("component"),m=e("../core/logger").logger("Drawing performance").color.green(),v=e("../core/logger").logger("drawing list").color.blue(),f=e("../core/logger").logger("drawing needsDraw").color.violet(),_=e("../core/logger").logger("drawing").color.blue(),g=e("collections/weak-map"),b=e("collections/map"),y=e("collections/set"),D="data-montage-le-component",w="data-montage-le-arg",P="data-montage-le-arg-begin",T="data-montage-le-arg-end",O=a.specialize({component:{value:null},fromCssClass:{value:null},cssClass:{value:null},toCssClass:{value:null},hasOneFrameDelay:{value:!1},_animationAndTransitionProperties:{value:["-webkit-animation","-moz-animation","-ms-animation","animation","-webkit-transition","-moz-transition","-ms-transition","transition"]},_emptyArray:{value:[]},_parseComputedStyleTimeValue:{value:function(e){var t,i;if("string"!=typeof e||""===e)return this._emptyArray;for(t=e.replace(/s| /g,"").split(","),i=0;i<t.length;i++)t[i]=+t[i];return t}},_getMaxAnimationTime:{value:function(){var e,t,i,r,n,a,o,s=0;if(this.component&&this.component.element){for(e=global.getComputedStyle(this.component.element),a=0;a<this._animationAndTransitionProperties.length;a++)for(t=this._parseComputedStyleTimeValue(e.getPropertyValue(this._animationAndTransitionProperties[a]+"-duration")),i=this._parseComputedStyleTimeValue(e.getPropertyValue(this._animationAndTransitionProperties[a]+"-delay")),n=Math.max(t.length,i.length),o=0;o<n;o++)r="undefined"==typeof t[o]?t[0]||0:t[o],r+="undefined"==typeof i[o]?i[0]||0:i[o],r>s&&(s=r);s>0&&(s+=.3)}return s}},_onAnimationsCompletedTimeout:{value:null},_cancelOnAnimationsCompletedEvent:{value:function(){clearTimeout(this._onAnimationsCompletedTimeout)}},_onAnimationsCompleted:{value:function(e){var t,i=this._getMaxAnimationTime();return i?(t=this,this._cancelOnAnimationsCompletedEvent(),void(this._onAnimationsCompletedTimeout=setTimeout(function(){e.call(t)},1e3*i))):void e.call(this)}},_needsToMeasureAnimationTimeOnNextDraw:{value:!1},_needsToMeasureAnimationTime:{value:!1},handleDidDraw:{value:function(e){this._needsToMeasureAnimationTimeOnNextDraw?(this.fromCssClass&&this.component.classList.remove(this.fromCssClass),this.cssClass&&this.component.classList.add(this.cssClass),this.toCssClass&&this.component.classList.add(this.toCssClass),this._needsToMeasureAnimationTimeOnNextDraw=!1,this._needsToMeasureAnimationTime=!0,this.component.needsDraw=!0):this._needsToMeasureAnimationTime&&(this._onAnimationsCompleted(function(){this._finishedDeferred&&(this._finishedDeferred.resolve(),this._finishedDeferred=null)}),this.component.removeEventListener("didDraw",this,!1),this._needsToMeasureAnimationTime=!1)}},_finishedDeferred:{value:null},finished:{get:function(){return this._finishedDeferred||(this._finishedDeferred=c.pending()),this._finishedDeferred.promise}},play:{value:function(){this.component&&(this._finishedDeferred&&!this._cancelled||(this._cancelled=!1,this._finishedDeferred=c.pending()),this.component.needsDraw=!0,this.fromCssClass?(this.fromCssClass&&this.component.classList.add(this.fromCssClass),this.cssClass&&this.component.classList.remove(this.cssClass),this.toCssClass&&this.component.classList.remove(this.toCssClass),this._needsToMeasureAnimationTime=!1,this._needsToMeasureAnimationTimeOnNextDraw=!0):this.hasOneFrameDelay?(this._needsToMeasureAnimationTime=!1,this._needsToMeasureAnimationTimeOnNextDraw=!0):(this.cssClass&&this.component.classList.add(this.cssClass),this.toCssClass&&this.component.classList.add(this.toCssClass),this._needsToMeasureAnimationTime=!0,this._needsToMeasureAnimationTimeOnNextDraw=!1),this.component.addEventListener("didDraw",this,!1))}},_cancelled:{value:!1},cancel:{value:function(){this._cancelled=!0,this.fromCssClass&&this.component.classList.remove(this.fromCssClass),this.cssClass&&this.component.classList.remove(this.cssClass),this.toCssClass&&this.component.classList.remove(this.toCssClass),this.component.removeEventListener("didDraw",this,!1),this._finishedDeferred&&this._finishedDeferred.reject()}}}),E=t.Component=o.specialize({DOM_ARG_ATTRIBUTE:{value:"data-arg"},drawListLogger:{value:v},delegate:{value:null},_templateObjects:{serializable:!1,value:null},templateObjects:{serializable:!1,get:function(){return this._templateObjects||(this._templateObjects=Object.create(null)),!this._setupTemplateObjectsCompleted&&this._templateDocumentPart&&this._setupTemplateObjects(this._templateDocumentPart.objects),this._templateObjects},set:function(e){this._templateObjects=e}},getResources:{value:function(){if(!this._setupTemplateObjectsCompleted&&this._templateDocumentPart)return this._templateDocumentPart.template.getResources()._resources}},_nextTarget:{value:null},nextTarget:{get:function(){return this._nextTarget||this.parentComponent},set:function(e){this._nextTarget=e}},_ownerDocumentPart:{value:null},_templateDocumentPart:{value:null},_domArguments:{value:void 0},_domArgumentNames:{value:void 0},_dispatchActionEvent:{value:function(){this.dispatchEvent(this.createActionEvent())},enumerable:!1},createActionEvent:{value:function(){var e=document.createEvent("CustomEvent");return e.initCustomEvent("action",!0,!0,null),e}},canDrawGate:{get:function(){return this._canDrawGate||(this._canDrawGate=(new u).initWithDelegate(this),this._canDrawGate.setField("componentTreeLoaded",!1)),this._canDrawGate},enumerable:!1},_blockDrawGate:{value:null},blockDrawGate:{enumerable:!1,get:function(){return this._blockDrawGate||(this._blockDrawGate=(new u).initWithDelegate(this),this._blockDrawGate.setField("element",!1),this._blockDrawGate.setField("drawRequested",!1)),this._blockDrawGate}},_firstDraw:{enumerable:!1,value:!0},_completedFirstDraw:{enumerable:!1,value:!1},originalElement:{value:null},_element:{enumerable:!1,value:null},element:{get:function(){return this._element},set:function(e){if(null===e||void 0===e)return void console.warn("Tried to set element of ",this," to ",e);if(e.component&&e.component!==this)throw new Error("Element "+e+" is already assigned to another component: "+e.component);if(global._montage_le_flag&&e.setAttribute(D,a.getInfoForObject(this).moduleId),this.isDeserializing)this.eventManager.registerEventHandlerForElement(this,e),this._isTemplateInstantiated?this._templateElement||(this._templateElement=e):(this._element=e,!this.blockDrawGate.value&&this._element&&this.blockDrawGate.setField("element",!0));else{if(!this._firstDraw)return void console.error("Cannot change element of ",this," after it has been set");this.eventManager.registerEventHandlerForElement(this,e),this._element=e,!this.blockDrawGate.value&&this._element&&this.blockDrawGate.setField("element",!0)}this._initializeClassListFromElement(e)}},getElementId:{value:function(){var e=this._element;if(e)return e.getAttribute("data-montage-id")}},_initDomArguments:{value:function(){var e,t,i,r,n=this.element;e=n.querySelectorAll("*["+this.DOM_ARG_ATTRIBUTE+"]"),e.length&&(t={});e:for(var a,o=0;a=e[o];o++){for(r=a;(r=r.parentNode)!==n;)if(r.component)continue e;this._findAndDetachComponents(a),a.parentNode.removeChild(a),i=a.getAttribute(this.DOM_ARG_ATTRIBUTE),a.removeAttribute(this.DOM_ARG_ATTRIBUTE),t[i]=a}this._domArguments=t}},_sharedEmptyArray:{value:[]},getDomArgumentNames:{value:function(){return void 0===this._domArgumentNames&&(this._domArgumentNames=this._domArguments?Object.keys(this._domArguments):this._sharedEmptyArray),this._domArgumentNames}},extractDomArgument:{value:function(e){if(this._domArguments){var t;return t=this._domArguments[e],this._domArguments[e]=null,t}return null}},_getTemplateDomArgument:{value:function(e){var t,i,r,n,a,o,s=this._ownerDocumentPart.template;r=s.getElementById(this.getElementId()),t=r.querySelectorAll("*["+this.DOM_ARG_ATTRIBUTE+"='"+e+"']");e:for(var l,u=0;l=t[u];u++){for(i=l;(i=i.parentNode)!==r;)if(n=s.getElementId(i),n&&(a=s.getSerialization(),o=a.getSerializationLabelsWithElements(n),o.length>0))continue e;return l}}},getTemplateArgumentElement:{value:function(e){var t,i,r,n,a,o=this._ownerDocumentPart.template;return global._montage_le_flag&&(t=this.ownerComponent._montage_metadata.moduleId,a=this._montage_metadata.label),"*"===e?(i=o.getElementById(this.getElementId()),r=o.document.createRange(),r.selectNodeContents(i),n=r.cloneContents(),global._montage_le_flag&&i.children.length>0&&this._leTagStarArgument(t,a,n)):(n=this._getTemplateDomArgument(e).cloneNode(!0),n.removeAttribute(this.DOM_ARG_ATTRIBUTE),global._montage_le_flag&&this._leTagNamedArgument(t,a,n,e)),n}},getTemplateArgumentSerialization:{value:function(e){var t=this._ownerDocumentPart.template;return t._createSerializationWithElementIds(e)}},resolveTemplateArgumentTemplateProperty:{value:function(e){var t,i,r,n,o=e.indexOf(":"),s=e.slice(0,o),l=e.slice(o),u=this._templateDocumentPart;if(a.getInfoForObject(this).label===s)return u&&(r=u.objects[l]),r instanceof d&&(i=u.objects[r.componentLabel],t=r.value.slice(1),n=i.resolveTemplateArgumentTemplateProperty(t),n||(n=t)),n}},setElementWithParentComponent:{value:function(e,t){this._alternateParentComponent=t,this.element!==e&&(this.element=e)}},_application:{value:null},application:{enumerable:!1,get:function(){return this._application||(E.prototype._application=e("../core/application").application)}},eventManager:{enumerable:!1,get:function(){return h}},rootComponent:{enumerable:!1,get:function(){return t.__root__}},elementControllerFromEvent:{enumerable:!1,value:function(e,t){return t}},_alternateParentComponent:{value:null},__parentComponent:{value:null},_parentComponent:{set:function(e){this.__parentComponent=e,this.dispatchOwnPropertyChange("parentComponent",e)},get:function(){return this.__parentComponent}},parentComponent:{enumerable:!1,get:function(){return this._parentComponent}},findParentComponent:{value:function(){var e,t=this.element,i=this.eventManager;if(t){for(;(e=t.parentNode)&&!i.eventHandlerForElement(e);)t=e;return e?i.eventHandlerForElement(e):this._alternateParentComponent}}},querySelectorComponent:{value:function(e){if("string"!=typeof e)throw"querySelectorComponent: Selector needs to be a string.";var t=e.match(/^\s*(?:@([^>\s]+))?(?:\s*(>)?\s*@([^>\s]+)(.*))?$/);if(!t)throw'querySelectorComponent: Syntax error "'+e+'"';var i,r,n,o=this.childComponents,s=t[1],l=(t[2]||" ",t[3]),u=t[4];if(s)for(u=l?"@"+l+u:"",r=0,n;n=o[r];r++){if(s===a.getInfoForObject(n).label)return u?n.querySelectorComponent(u):n;if(i=n.querySelectorComponent(e))return i}else for(r=0,n;n=o[r];r++)if(l===a.getInfoForObject(n).label)return u?n.querySelectorComponent(u):n;return null}},querySelectorAllComponent:{value:function(e,t){if("string"!=typeof e)throw"querySelectorComponent: Selector needs to be a string.";var i=e.match(/^\s*(?:@([^>\s]+))?(?:\s*(>)?\s*@([^>\s]+)(.*))?$/);if(!i)throw'querySelectorComponent: Syntax error "'+e+'"';var r,n,o=this.childComponents,s=i[1],l=(i[2]||" ",i[3]),u=i[4],c=[];if(s)for(u=l?"@"+l+u:"",r=0,n;n=o[r];r++)s!==a.getInfoForObject(n).label||t&&t!==n.ownerComponent?c=c.concat(n.querySelectorAllComponent(e,t)):u?c=c.concat(n.querySelectorAllComponent(u)):c.push(n);else for(r=0,n;n=o[r];r++)l!==a.getInfoForObject(n).label||t&&t!==n.ownerComponent||(u?c=c.concat(n.querySelectorAllComponent(u,t)):c.push(n));return c}},template:{enumerable:!1,value:null},hasTemplate:{enumerable:!1,value:!0},_templateModuleId:{serializable:!1,value:null},_template:{value:null},_treeLevel:{value:0},_addChildComponent:{value:function(e){return this.addChildComponent(e)}},addChildComponent:{value:function(e){this.childComponents.indexOf(e)===-1&&(this.childComponents.push(e),e._parentComponent=this,e._prepareForEnterDocument(),e.needsDraw&&!this.rootComponent.isComponentWaitingNeedsDraw(e)&&e._addToParentsDrawList()),e._shouldBuildIn=!0}},attachToParentComponent:{value:function(){this.detachFromParentComponent(),this._parentComponent=null;var e,t,i=this.findParentComponent();if(i){e=i.childComponents;for(var r=0;t=e[r];r++){var n=t.findParentComponent();n===this&&(i.removeChildComponent(t),n.addChildComponent(t))}i.addChildComponent(this)}}},detachFromParentComponent:{value:function(){var e=this.parentComponent;e&&e.removeChildComponent(this)}},removeChildComponent:{value:function(e){var t=this.childComponents,i=t.indexOf(e);i>-1&&(e._exitDocument(),t.splice(i,1),e._parentComponent=null,e._alternateParentComponent=null,e._addedToDrawList&&(e._addedToDrawList=!1,i=this._drawList.indexOf(e),this._drawList.splice(i,1)),this.rootComponent.removeFromCannotDrawList(e))}},_childComponents:{value:null},childComponents:{enumerable:!1,get:function(){return this._childComponents||(this._childComponents=[])}},_needsEnterDocument:{value:!1},_inDocument:{value:!1},__exitDocument:{value:function(){this._inDocument&&"function"==typeof this.exitDocument&&(this.exitDocument(),this._inDocument=!1)}},_exitDocument:{value:function(){var e;this._needsEnterDocument?this._needsEnterDocument=!1:(e=function(t){for(var i,r=t.childComponents,n=0;i=r[n];n++)i._isComponentExpanded&&e(i);t._inDocument&&t.__exitDocument()})(this)}},exitDocument:{value:function(){this.isActiveTarget&&(h.activeTarget=this.nextTarget)}},_prepareForEnterDocument:{value:function(){this._firstDraw?this._needsEnterDocument=!0:(this.needsDraw=!0,this.traverseComponentTree(function(e){return!e._needsEnterDocument&&(e._needsEnterDocument=!0,void(e.needsDraw=!0))}))}},ownerComponent:{enumerable:!1,value:null},components:{enumerable:!1,value:{}},_isComponentExpanded:{enumerable:!1,value:!1},_isTemplateLoaded:{enumerable:!1,value:!1},_isTemplateInstantiated:{enumerable:!1,value:!1},cleanupDeletedComponentTree:{value:function(e){e&&this.cancelBindings(),this.needsDraw=!1,this.traverseComponentTree(function(t){e&&t.cancelBindings(),t.needsDraw=!1})}},_newDomContent:{enumerable:!1,value:null},_elementsToAppend:{value:null},domContent:{serializable:!1,get:function(){return this._element?Array.prototype.slice.call(this._element.childNodes,0):null},set:function(e){var t,i,r,n=[];if(this._elementsToAppend||(this._elementsToAppend=[]),this._newDomContent=e,this.needsDraw=!0,null===this._newDomContent&&(this._shouldClearDomContentOnNextDraw=!0),"function"==typeof this.contentWillChange&&this.contentWillChange(e),t=this.childComponents,e)for(this._componentsPendingBuildOut||(this._componentsPendingBuildOut=[]),i=t.length-1;i>=0;i--)this._componentsPendingBuildOut.indexOf(t[i])===-1&&this._componentsPendingBuildOut.push(t[i]);else for(this._componentsPendingBuildOut=[],i=t.length-1;i>=0;i--)t[i]._shouldBuildOut=!0;if(e instanceof Element)this._elementsToAppend.push(e),this._findAndDetachComponents(e,n);else if(e&&e[0])for(i=0;i<e.length;i++)this._elementsToAppend.push(e[i]),this._findAndDetachComponents(e[i],n);for(i=0;r=n[i];i++)this.addChildComponent(r)}},_shouldClearDomContentOnNextDraw:{value:!1},_findAndDetachComponents:{value:function(e,t){var i,r=e.component;if(t||(t=[]),r)r.detachFromParentComponent(),t.push(r);else{i=e.children||e.childNodes;for(var n,a=0;n=i[a];a++)this._findAndDetachComponents(n,t)}return t}},clonesChildComponents:{writable:!1,value:!1},_innerTemplate:{value:null},innerTemplate:{serializable:!1,get:function(){var e,t,i,r,n,a,o,s=this._innerTemplate;if(!s&&(e=this._ownerDocumentPart)){t=e.template,i=this.getElementId(),s=t.createTemplateFromElementContents(i),r=s.getSerialization(),n=r.getExternalObjectLabels(),a=e.objects,o=Object.create(null);for(var l,u=0;l=n[u];u++)o[l]=a[l];s.setInstances(o),this._innerTemplate=s}return s},set:function(e){this._innerTemplate=e}},canDraw:{value:function(){return this._canDraw}},_canDraw:{get:function(){return!this._canDrawGate||this._canDrawGate.value},set:function(e){n.componentCanDraw(this,e)},enumerable:!1},_prepareCanDraw:{enumerable:!1,value:function(){if(!this._isComponentTreeLoaded)return this.loadComponentTree()}},_blocksOwnerComponentDraw:{value:!1},_updateOwnerCanDrawGate:{value:function(){this._blocksOwnerComponentDraw&&this.ownerComponent&&this.ownerComponent.canDrawGate.setField(this,this.canDrawGate.value)}},_isComponentTreeLoaded:{value:!1},shouldLoadComponentTree:{value:!0},_loadComponentTreeDeferred:{value:null},loadComponentTree:{value:function(){if(!this._loadComponentTreeDeferred){this.canDrawGate.setField("componentTreeLoaded",!1),(this.needsDraw||this.hasTemplate)&&(this._canDraw=!1);var e=this;this._loadComponentTreeDeferred=this.expandComponent().then(function(){if(e.hasTemplate||e.shouldLoadComponentTree){var t,i,r=e._childComponents;if(r&&r.length){t=[];for(var n=0;i=r[n];n++)t.push(i.loadComponentTree());return c.all(t)}return c.resolve(null)}}).then(function(){e._isComponentTreeLoaded=!0,e._needsEnterDocument&&(e.needsDraw=!0),e.canDrawGate.setField("componentTreeLoaded",!0)})["catch"](function(e){console.error(e)})}return this._loadComponentTreeDeferred}},traverseComponentTree:{value:function(e,t){function i(){var i,n,a=r.childComponents;if(e&&e(r)===!1)return void(t&&t());if(0===(n=a.length))return void(t&&t());for(var o=function(){0===--n&&t&&t()},s=0;i=a[s];s++)i.traverseComponentTree(e,o)}var r=this;this._isComponentExpanded?i():t&&t()}},_expandComponentPromise:{value:null},expandComponent:{value:function(){if(!this._expandComponentPromise)if(this.hasTemplate){var e=this;this._expandComponentPromise=this._instantiateTemplate().then(function(){e._isComponentExpanded=!0,e._addTemplateStylesIfNeeded(),e.needsDraw=!0})["catch"](function(e){console.error(e)})}else this._isComponentExpanded=!0,this._expandComponentPromise=c.resolve();return this._expandComponentPromise}},_templateObjectDescriptor:{value:{enumerable:!0,configurable:!0}},_setupTemplateObjects:{value:function(e){return this._templateObjects=this._templateObjects||Object.create(null),this._addTemplateObjects(e),this._setupTemplateObjectsCompleted=!0,this._templateObjects}},_setupTemplateObjectsCompleted:{value:!1},_addTemplateObjects:{value:function(e){var t,i,r=this._templateObjectDescriptor,n=this._templateObjects;for(t in e)i=e[t],null!==i&&void 0!==i&&(E.prototype.isPrototypeOf(i)&&i!==this&&i.parentComponent!==this?(r.get=this._makeTemplateObjectGetter(this,t,i),Object.defineProperty(n,t,r)):n[t]=i)}},_makeTemplateObjectGetter:{value:function(e,t,i){var r,n,a,o="@"+t;return function(){if(r)return e.querySelectorAllComponent(o,e);if(n=e.querySelectorAllComponent(o,e),1===n.length)for(a=n[0];a=a.parentComponent;){if(a===e)return Object.defineProperty(this,t,{value:n[0]}),n[0];if(a.clonesChildComponents)break}else if(0===n.length)return i;return r=!0,n}}},_instantiateTemplate:{value:function(){var e=this;return this._loadTemplate().then(function(t){if(!e._element)return c.reject(new Error("Cannot instantiate template without an element.",e));var i=null,r=e._element.ownerDocument;return i||(i=Object.create(null)),i.owner=e,e._isTemplateInstantiated=!0,t.instantiateWithInstances(i,r).then(function(t){t.parentDocumentPart=e._ownerDocumentPart,e._templateDocumentPart=t,t.fragment=null,i=null},function(e){throw new Error(t.getBaseUrl()+":"+e.stack||e)})})}},_templateDidLoad:{value:function(e){this._templateDocumentPart=e,this._templateObjects&&this._setupTemplateObjects(e.objects)}},_loadTemplatePromise:{value:null},_loadTemplate:{value:function(){var e;if(!this._loadTemplatePromise){var t=this;e=a.getInfoForObject(this),this._loadTemplatePromise=s.getTemplateWithModuleId(this.templateModuleId,e.require).then(function(e){return t._template=e,t._isTemplateLoaded=!0,e})}return this._loadTemplatePromise}},templateModuleId:{get:function(){return this._templateModuleId||this._getDefaultTemplateModuleId()}},_getDefaultTemplateModuleId:{value:function(){var e,t,i,r;return r=a.getInfoForObject(this),i=r.moduleId,t=i.lastIndexOf("/"),e=i+"/"+i.slice(t===-1?0:t+1,-5)+".html"}},deserializedFromSerialization:{value:function(){this.attachToParentComponent()}},_deserializedFromTemplate:{value:function(e,t,i){a.getInfoForObject(this).label=t,this._ownerDocumentPart=i,this.hasOwnProperty("identifier")||(this.identifier=t),this.ownerComponent||(E.prototype.isPrototypeOf(e)?this.ownerComponent=e:this.ownerComponent=this.rootComponent,this._updateOwnerCanDrawGate()),this._needsDrawInDeserialization&&(this.needsDraw=!0)}},blueprintModuleId:{serializable:!1,enumerable:!1,get:function(){return this.objectDescriptorModuleId}},blueprint:e("../core/core")._objectDescriptorDescriptor,objectDescriptor:e("../core/core")._objectDescriptorDescriptor,objectDescriptorModuleId:{serializable:!1,enumerable:!1,get:function(){var e=a.getInfoForObject(this),t=e&&!e.isInstance?this:Object.getPrototypeOf(this);if(!Object.getOwnPropertyDescriptor(t,"_objectDescriptorModuleId")||!t._objectDescriptorModuleId){e=a.getInfoForObject(t);var i=e.moduleId,r=i.lastIndexOf("/"),n=i.lastIndexOf(".");r=r===-1?0:r+1,n=n===-1?i.length:n,n=n<r?i.length:n;var o;o=n<i.length&&".reel"===i.slice(n,i.length)?i+"/"+i.slice(r,n)+".meta":i.slice(0,n)+".meta",a.defineProperty(t,"_objectDescriptorModuleId",{value:o})}return t._objectDescriptorModuleId}},gateDidBecomeTrue:{value:function(e){e===this._canDrawGate?(this._canDraw=!0,this._updateOwnerCanDrawGate()):e===this._blockDrawGate&&(n.componentBlockDraw(this),this._prepareCanDraw())},enumerable:!1},gateDidBecomeFalse:{value:function(e){e===this._canDrawGate&&this._updateOwnerCanDrawGate()},enumerable:!1},_canDrawGate:{enumerable:!1,value:null},preparedForActivationEvents:{enumerable:!1,value:!1},_arrayObjectPool:{value:{pool:null,size:200,ix:0}},_getArray:{value:function(){if(!this._arrayObjectPool.pool){this._arrayObjectPool.pool=[];for(var e=0;e<this._arrayObjectPool.size;e++)this._arrayObjectPool.pool[e]=[]}return this._arrayObjectPool.ix<this._arrayObjectPool.size?this._arrayObjectPool.pool[this._arrayObjectPool.ix++]:[]}},_disposeArray:{value:function(e){this._arrayObjectPool.ix>0&&(e.length=0,this._arrayObjectPool.pool[--this._arrayObjectPool.ix]=e)}},_drawIfNeeded:{enumerable:!1,value:function(e){var t,i,n,a,o=this._firstDraw;if(this._treeLevel=e,o&&(this.originalElement=this.element),this.needsDraw&&this.rootComponent.addToDrawCycle(this),this._needsEnterDocument&&(this._needsEnterDocument=!1,this._willEnterDocument(),this._enterDocument(o),"function"==typeof this.enterDocument&&this.enterDocument(o)),o&&(this.originalElement=null),null!==this._drawList&&this._drawList.length>0){for(i=this._drawList,this._drawList=this._getArray(),a=i.length,n=0;n<a;n++)t=i[n],t._addedToDrawList=!1,t.canDraw()?t._drawIfNeeded(e+1):_.isDebug&&_.debug(r(t)+" can't draw.");this._disposeArray(i)}}},_updateComponentDom:{value:function(){if(this._firstDraw){if(this._prepareForDraw(),this._composerList)for(var e,t=0,i=this._composerList.length;t<i;t++)e=this._composerList[t],e.lazyLoad||this.loadComposer(e);this._firstDraw=!1}(null!==this._newDomContent||this._shouldClearDomContentOnNextDraw)&&(_.isDebug&&p.debug("Component content changed: component ",this._montage_metadata.objectName,this.identifier," newDomContent",this._newDomContent),this._performDomContentChanges())}},_replaceElementWithTemplate:{enumerable:!1,value:function(){var e,t,i,r,n,a=this.element,o=this._templateElement,s=this.element.attributes;for(i=0;r=s[i];i++)e=r.nodeName,global._montage_le_flag&&e===D?t=r.nodeValue:"id"===e||"data-montage-id"===e?t=r.nodeValue:(n=o.getAttribute(e)||"",t=n?n+("style"===e?"; ":" ")+r.nodeValue:r.nodeValue),o.setAttribute(e,t);this._initializeClassListFromElement(o),a.parentNode?a.parentNode.replaceChild(o,a):this._canDrawOutsideDocument||console.warn("Warning: Trying to replace element ",a," which has no parentNode"),this.eventManager.unregisterEventHandlerForElement(a),this.eventManager.registerEventHandlerForElement(this,o),this._element=o,this._templateElement=null,this._newDomContent&&(this._newDomContent=null,this._shouldClearDomContentOnNextDraw=!1)}},_addTemplateStylesIfNeeded:{value:function(){var e=this._templateDocumentPart;e&&this.rootComponent.addStyleSheetsFromTemplate(e.template)}},_prepareForDraw:{value:function(){p.isDebug&&p.debug(this,"_templateElement: "+this._templateElement);var e;global._montage_le_flag&&(e=this.element.children.length>0),this._initDomArguments(),e&&this._leTagArguments(),this._templateElement&&(this._bindTemplateParametersToArguments(),this._replaceElementWithTemplate())},enumerable:!1},_leTagArguments:{value:function(){if(this!==this.rootComponent){var e=this.ownerComponent._montage_metadata.moduleId,t=this._montage_metadata.label,i=this.getDomArgumentNames();if(i&&0!==i.length)for(var r,n=0;r=i[n];n++)this._leTagNamedArgument(e,t,this._domArguments[r],r);else this._leTagStarArgument(e,t,this.element)}}},_getNodeFirstElement:{value:function(e){var t=e.firstElementChild;if(!t){t=e.firstChild;do if(t.nodeType===Node.ELEMENT_NODE)break;while(t=t.nextSibling)}return t}},_getNodeLastElement:{value:function(e){var t=e.lastElementChild;if(!t){t=e.lastChild;do if(t.nodeType===Node.ELEMENT_NODE)break;while(t=t.previousSibling)}return t}},_leTagStarArgument:{value:function(e,t,i){var r=this._getNodeFirstElement(i),n=this._getNodeLastElement(i);r.setAttribute(P,(r.getAttribute(P)||"")+" "+e+","+t),n.setAttribute(T,(n.getAttribute(T)||"")+" "+e+","+t)}},_leTagNamedArgument:{value:function(e,t,i,r){i.setAttribute(w,e+","+t+","+r)}},_bindTemplateParametersToArguments:{value:function(){var e,t,i,r,n,a,o,s=this._templateDocumentPart?this._templateDocumentPart.parameters:null,l=this._domArguments;if(i=this._validateTemplateArguments(l,s))throw i;for(var u in s)if(s.hasOwnProperty(u)&&(e=s[u],t=l?l[u]:void 0,"*"===u||"each"===u?0===this._element.childElementCount?e&&e.childElementCount>0?(a=this._element.ownerDocument.createRange(),a.selectNodeContents(e),e.parentNode.replaceChild(a.extractContents(),e)):e.parentNode.removeChild(e):(a=this._element.ownerDocument.createRange(),a.selectNodeContents(this._element),r=a.extractContents()):r=t,r)){var c,h;if(r instanceof Element){var d=e.classList,p=r.component?r.component.classList:r.classList;for(c=0,h=d.length;c<h;c++)p.add(d[c])}for(n=this._findAndDetachComponents(r),e.parentNode.replaceChild(r,e),c=0;o=n[c];c++)o.attachToParentComponent()}}},_validateTemplateArguments:{value:function(e,t){var i,r=t?Object.keys(t):void 0;if(r&&0!==r.length){for(i in e)if("*"!==i&&!(i in t))return new Error('"'+i+'" parameter does not exist in '+this.templateModuleId);var n=t["*"];if(n)for(i in t)if("*"!==i&&n.contains(t[i]))return new Error('"'+i+'" parameter cannot be used within an element with the star parameter')}}},prepareForActivationEvents:{enumerable:!1,value:null},_prepareForActivationEvents:{value:function(){if("function"==typeof this.prepareForActivationEvents&&this.prepareForActivationEvents(),this._composerList)for(var e,t=0,i=this._composerList.length;t<i;t++)e=this._composerList[t],e.lazyLoad&&this.loadComposer(e);this.preparedForActivationEvents=!0}},_performDomContentChanges:{value:function(){var e,t,i,r=this._newDomContent;if(r||this._shouldClearDomContentOnNextDraw){for(e=this._element,i=e.childNodes.length-1;i>=0;i--)e.childNodes[i].component||e.removeChild(e.childNodes[i]);if(this._elementsToAppend)for(;this._elementsToAppend.length;)t=this._elementsToAppend.shift(),e.contains(t)||e.appendChild(t);this._newDomContent=null,"function"==typeof this.contentDidChange&&this.contentDidChange(),this._shouldClearDomContentOnNextDraw=!1}}},prepareForDraw:{enumerable:!1,value:null},draw:{enumerable:!1,value:Function.noop},willDraw:{enumerable:!1,value:null},didDraw:{enumerable:!1,value:Function.noop},_addedToDrawList:{value:!1},_addToParentsDrawList:{enumerable:!1,value:function(){if(!this._addedToDrawList){var e=this._parentComponent;e?(e._addToDrawList(this),this.drawListLogger.isDebug&&this.drawListLogger.debug(r(this)+" added to "+r(e)+"'s drawList")):this.drawListLogger.isDebug&&this.drawListLogger.debug(this,"parentComponent is null")}}},_needsDraw:{value:!1},_needsDrawInDeserialization:{value:!1},needsDraw:{enumerable:!1,get:function(){return this._needsDraw},set:function(e){return this.isDeserializing?void(this._needsDrawInDeserialization=!0):(e=!!e,void(this._needsDraw!==e&&(f.isDebug&&f.debug("needsDraw toggled "+e+" for "+this._montage_metadata.objectName),this._needsDraw=e,e&&(this.canDrawGate.value?this._addToParentsDrawList():this.blockDrawGate.setField("drawRequested",!0)))))}},_drawList:{value:null},__addToDrawList:{enumerable:!1,value:function(e){null===this._drawList?(this._drawList=[e],e._addedToDrawList=!0):this._drawList.indexOf(e)===-1&&(this._drawList.push(e),e._addedToDrawList=!0)}},_addToDrawList:{enumerable:!1,value:function(e){this.__addToDrawList(e),this._addToParentsDrawList()}},_templateElement:{enumerable:!1,value:null},surrenderPointer:{value:function(e,t){return!0}},_composerList:{value:null,serializable:!1},composerList:{get:function(){return this._composerList||(this._composerList=[]),this._composerList},serializable:!1},addComposer:{value:function(e){this.addComposerForElement(e,e.element)}},addComposerForElement:{value:function(e,t){e.component=this,e.element=t,this.composerList.push(e),this._firstDraw||(e.lazyLoad?this.preparedForActivationEvents&&this.loadComposer(e):this.loadComposer(e))}},loadComposer:{value:function(e){this._composerList&&this._composerList.indexOf(e)>-1&&o.prototype.loadComposer.call(this,e)}},unloadComposer:{value:function(e){this._composerList&&this._composerList.indexOf(e)>-1&&o.prototype.unloadComposer.call(this,e)}},scheduleComposer:{value:function(e){this.rootComponent.addToComposerList(e)}},removeComposer:{value:function(e){if(this._composerList)for(var t=0,i=this._composerList.length;t<i;t++)if(this._composerList[t]===e){this.unloadComposer(this._composerList[t]),this._composerList.splice(t,1);break}}},clearAllComposers:{value:function(){if(this._composerList){for(var e=this._composerList,t=0,i=e.length;t<i;t++)this.unloadComposer(e[t]);e.length=0}}},localizer:{value:null},_waitForLocalizerMessages:{value:!1},waitForLocalizerMessages:{enumerable:!1,get:function(){return this._waitForLocalizerMessages},set:function(e){if(this._waitForLocalizerMessages!==e)if(e!==!0||this.localizer.messages)this._waitForLocalizerMessages=!1,this.canDrawGate.setField("messages",!0);else{if(!this.localizer)throw"Cannot wait for messages on localizer if it is not set";this._waitForLocalizerMessages=!0,p.debug(this,"waiting for messages from localizer"),this.canDrawGate.setField("messages",!1);var t=this;this.localizer.messagesPromise.then(function(e){p.isDebug&&p.debug(t,"got messages from localizer"),t.canDrawGate.setField("messages",!0)})}}},__elementAttributeValues:{value:null},_elementAttributeValues:{get:function(){return this.__elementAttributeValues||(this.__elementAttributeValues={})}},_elementAttributeDescriptors:{value:null},_getElementAttributeDescriptor:{value:function(e){for(var t,i=this;i&&i._elementAttributeDescriptors&&!(t=i._elementAttributeDescriptors[e]);)i=Object.getPrototypeOf(i);return t}},__shouldBuildIn:{value:!0},_shouldBuildIn:{get:function(){return this.__shouldBuildIn},set:function(e){var t;e=!!e,this.__shouldBuildIn=e,e&&(this.parentComponent&&this.parentComponent._componentsPendingBuildOut&&(t=this.parentComponent._componentsPendingBuildOut.indexOf(this),
t!==-1&&this.parentComponent._componentsPendingBuildOut.splice(t,1)),this._shouldBuildOut=!1,this._inDocument&&this._buildIn())}},__shouldBuildOut:{value:!1},_shouldBuildOut:{get:function(){return this.__shouldBuildOut},set:function(e){e=!!e,this.__shouldBuildOut=e,e&&(this._shouldBuildIn=!1,this._inDocument&&this._buildOut())}},buildInInitialAnimation:{get:function(){var e=null;return this._activeBuildInAnimation&&"object"==typeof this._activeBuildInAnimation&&"undefined"!=typeof this._activeBuildInAnimation.cssClass&&(e=new O,e.component=this,e.fromCssClass=this._activeBuildInAnimation.fromCssClass,e.cssClass=this._activeBuildInAnimation.cssClass,e.toCssClass=this._activeBuildInAnimation.toCssClass),e}},buildInSwitchAnimation:{get:function(){var e=null;return this._activeBuildInAnimation&&"object"==typeof this._activeBuildInAnimation&&"undefined"!=typeof this._activeBuildInAnimation.cssClass&&(e=new O,e.component=this,e.cssClass=this._activeBuildInAnimation.cssClass,e.toCssClass=this._activeBuildInAnimation.toCssClass),e}},buildOutInitialAnimation:{get:function(){var e=null;return this._activeBuildOutAnimation&&"object"==typeof this._activeBuildOutAnimation&&"undefined"!=typeof this._activeBuildOutAnimation.cssClass&&(e=new O,e.component=this,e.hasOneFrameDelay=!0,e.fromCssClass=this._activeBuildOutAnimation.fromCssClass,e.cssClass=this._activeBuildOutAnimation.cssClass,e.toCssClass=this._activeBuildOutAnimation.toCssClass),e}},buildOutSwitchAnimation:{get:function(){var e=null;return this._activeBuildOutAnimation&&"object"==typeof this._activeBuildOutAnimation&&"undefined"!=typeof this._activeBuildOutAnimation.cssClass&&(e=new O,e.component=this,e.cssClass=this._activeBuildOutAnimation.cssClass,e.toCssClass=this._activeBuildOutAnimation.toCssClass),e}},buildInAnimation:{value:null},buildOutAnimation:{value:null},buildInAnimationOverride:{value:null},buildOutAnimationOverride:{value:null},_activeBuildInAnimation:{value:null},_activeBuildOutAnimation:{value:null},_updateActiveBuildAnimations:{value:function(){this.buildInAnimationOverride?this._activeBuildInAnimation=this.buildInAnimationOverride:this._activeBuildInAnimation=this.buildInAnimation,this.buildOutAnimationOverride?this._activeBuildOutAnimation=this.buildOutAnimationOverride:this._activeBuildOutAnimation=this.buildOutAnimation}},_currentBuildAnimation:{value:null},_buildIn:{value:function(){var e=this;this._currentBuildAnimation&&this._currentBuildAnimation.cancel(),this._element&&this._element.parentNode&&this._element.parentNode.component&&(this._isElementAttachedToParent?this._currentBuildAnimation=this.buildInSwitchAnimation:(this._updateActiveBuildAnimations(),this._currentBuildAnimation=this.buildInInitialAnimation),this._currentBuildAnimation&&(this._currentBuildAnimation.play(),this._currentBuildAnimation.finished.then(function(){e._currentBuildAnimation.cancel(),e._currentBuildAnimation=null,e.dispatchEventNamed("buildInEnd",!0,!0)},function(){})))}},_buildOut:{value:function(){var e=this;this._currentBuildAnimation?(this._currentBuildAnimation.cancel(),this._currentBuildAnimation=this.buildOutSwitchAnimation):(this._updateActiveBuildAnimations(),this._currentBuildAnimation=this.buildOutInitialAnimation),this._element&&this._element.parentNode&&this._element.parentNode.component&&(this._currentBuildAnimation?(this._currentBuildAnimation.play(),this._currentBuildAnimation.finished.then(function(){var t=e.parentComponent;e._currentBuildAnimation.cancel(),e._currentBuildAnimation=null,e.detachFromParentComponent(),e.buildInAnimationOverride=null,e.buildOutAnimationOverride=null,e._element.parentNode.component&&e._element.parentNode.removeChild(e._element),e._isElementAttachedToParent=!1,t.dispatchEventNamed("buildOutEnd",!0,!0)},function(){})):(this.detachFromParentComponent(),this.buildInAnimationOverride=null,this.buildOutAnimationOverride=null,this._isElementAttachedToParent&&(this._element.parentNode&&this._element.parentNode.component&&this._element.parentNode.removeChild(this._element),this._isElementAttachedToParent=!1)))}},_willEnterDocument:{value:function(){var e;e=new CustomEvent("willEnterDocument",{details:{component:this},bubbles:!1}),this.dispatchEvent(e),this._inDocument=!0,this.parentComponent&&this.parentComponent._childWillEnterDocument(),this.__shouldBuildIn&&this._buildIn(),this._isElementAttachedToParent=!0,this.__shouldBuildOut&&this._buildOut()}},_childWillEnterDocument:{value:function(){if(this._componentsPendingBuildOut)for(;this._componentsPendingBuildOut.length;)this._componentsPendingBuildOut.pop()._shouldBuildOut=!0}},_enterDocument:{value:function(e){var t;if(e){t=this.originalElement;var i,r,n,a,o,s,l;if(i=t.attributes)for(n=i.length,r=0;r<n;r++)a=i[r].name,o=i[r].value,l=this._getElementAttributeDescriptor(a,this),(l||"undefined"!=typeof this[a])&&"undefined"==typeof this._elementAttributeValues[a]&&(this._elementAttributeValues[a]=o,null!==this[a]&&void 0!==this[a]||(this[a]=o));if(l=this._getElementAttributeDescriptor("textContent",this)){var u=t.textContent;"undefined"==typeof this._elementAttributeValues.textContent&&(this._elementAttributeValues.textContent=u,null!==this.textContent&&void 0!==this.textContent||(this.textContent=u))}if(this._elementAttributeDescriptors)for(s in this._elementAttributeDescriptors)if(this._elementAttributeDescriptors.hasOwnProperty(s)){l=this._elementAttributeDescriptors[s];var c="_"+s;null===this[c]&&null!==l&&"value"in l&&(this[c]=l.value)}}}},_draw:{value:function(){var e,t=this.element;if(null!==this.__elementAttributeValues)for(var i in this._elementAttributeValues)if(this._elementAttributeValues.hasOwnProperty(i)){var r=this[i];e=this._getElementAttributeDescriptor(i,this),e&&("boolean"===e.dataType?r===!0?(t[i]=!0,t.setAttribute(i,i.toLowerCase())):(t[i]=!1,t.removeAttribute(i)):"undefined"!=typeof r&&("textContent"===i?t.textContent=r:t.setAttribute(i,r))),delete this._elementAttributeValues[i]}this._drawClassListIntoComponent()}},_classList:{value:null},_classListDirty:{value:!1},classList:{get:function(){return null===this._classList&&(this._classList=new y,this._subscribeToToClassListChanges(),this._initializeClassListFromElement(this.element)),this._classList}},_initializeClassListFromElement:{value:function(e){if(e&&e.classList&&e.classList.length>0){this._classList?this._unsubscribeToClassListChanges&&this._unsubscribeToClassListChanges():this._classList=new y;for(var t=e.classList,i=0,r=t.length;i<r;i++)this._classList.add(t[i]);this._subscribeToToClassListChanges()}}},_unsubscribeToClassListChanges:{value:null},_subscribeToToClassListChanges:{value:function(){this._unsubscribeToClassListChanges=this._classList.addRangeChangeListener(this,"classList")}},handleClassListRangeChange:{value:function(e,t){this._classListDirty=!0,this.needsDraw=!0}},_drawClassListIntoComponent:{value:function(){if(this._classListDirty){for(var e,t=this.element.classList,i=this._classList,r=0,n=t.length;r<n;r++)e=t.item(r),i.has(e)||(t.remove(e),r--,n--);this._classList.forEach(function(e){t.add(e)}),this._classListDirty=!1}}},dispose:{value:function(){this.cancelBindings(),this.detachFromParentComponent(),this._element&&(h.unregisterEventHandlerForElement(this._element),this._element=null),this.childComponents.forEach(function(e){e.dispose()})}}},{addAttributes:{value:function(e){var t,i,r;this.prototype._elementAttributeDescriptors=e;for(i in e)e.hasOwnProperty(i)&&(r=e[i],null===r||"string"==typeof r?(t={value:r,dataType:"string"},e[i]=t):t=r,"undefined"==typeof this[i]&&this.defineAttribute(i,t))}},defineAttributeSetter:{value:function(e,t,i){return function(e,t,i){return function(r,n){var a=this._getElementAttributeDescriptor(e,this);a&&"boolean"===a.dataType&&(r=!(!r&&""!==r)),"undefined"!=typeof r&&this[t]!==r&&(i?i.call(this,r):this[t]=r,this._elementAttributeValues[e]=r,n||(this.needsDraw=!0))}}(e,t,i.set)}},defineAttributeGetter:{value:function(e){return function(e){return function(){return this[e]}}(e)}},defineAttribute:{value:function(e,t){t=t||{};var i="_"+e,r={configurable:"undefined"==typeof t.configurable||t.configurable,enumerable:"undefined"==typeof t.enumerable||t.enumerable,set:this.defineAttributeSetter(e,i,t),get:t.get||this.defineAttributeGetter(i)};this.prototype.hasOwnProperty(i)||a.defineProperty(this.prototype,i,{value:t.value}),a.defineProperty(this.prototype,e,r)}}}),S=E.specialize({constructor:{value:function(){this._drawTree=this._drawTree.bind(this),this._readyToDrawListIndex=new b,this._addedStyleSheetsByTemplate=new g}},init:{value:function(){return this}},needsDraw:{enumerable:!0,get:function(){return!!this._needsDraw},set:function(e){if(this._needsDraw!==e&&(this._needsDraw=!!e,e))for(var t,i=this.childComponents,r=0;t=i[r];r++)f.isDebug&&f.debug(this,"needsDraw = true for: "+t._montage_metadata.exportedSymbol),t.needsDraw=!0}},canDrawGate:{get:function(){return this._canDrawGate||(this._canDrawGate=(new u).initWithDelegate(this))}},_clearNeedsDrawTimeOut:{value:null},_needsDrawList:{value:[]},_cannotDrawList:{value:null},componentBlockDraw:{value:function(e){this._cannotDrawList=this._cannotDrawList?this._cannotDrawList:new y,this._cannotDrawList.add(e),this._clearNeedsDrawTimeOut&&(clearTimeout(this._clearNeedsDrawTimeOut),this._clearNeedsDrawTimeOut=null)}},isComponentWaitingNeedsDraw:{value:function(e){return this._cannotDrawList.has(e)||this._needsDrawList.indexOf(e)>=0}},componentCanDraw:{value:function(e,t){if(t){if(!this._cannotDrawList)return;if(this._cannotDrawList["delete"](e),this._needsDrawList.push(e),0===this._cannotDrawList.size&&this._needsDrawList.length>0&&!this._clearNeedsDrawTimeOut){var i=this;this._clearNeedsDrawTimeOut=setTimeout(function(){i._clearNeedsDrawList()},0)}}else this._clearNeedsDrawTimeOut&&(clearTimeout(this._clearNeedsDrawTimeOut),this._clearNeedsDrawTimeOut=null)}},_clearNeedsDrawList:{value:function(){var e,t,i,r=this._needsDrawList;for(i=r.length,t=0;t<i;t++)e=r[t],(e.needsDraw||e._drawList&&e._drawList.length>0)&&e._addToParentsDrawList();this._clearNeedsDrawTimeOut=null,r.length=0}},removeFromCannotDrawList:{value:function(e){if(this._cannotDrawList&&(this._cannotDrawList["delete"](e),0===this._cannotDrawList.size&&this._needsDrawList.length>0&&!this._clearNeedsDrawTimeOut)){var t=this;this._clearNeedsDrawTimeOut=setTimeout(function(){t._clearNeedsDrawList()},0)}}},_cancelDrawIfScheduled:{value:function(){var e=this.requestedAnimationFrame,t=this.cancelAnimationFrame;null!==e&&(this._frameTime||(p.isDebug&&p.debug(this,"clearing draw"),t?t(e):clearTimeout(e),this.requestedAnimationFrame=null))}},_addToDrawList:{value:function(e){this.__addToDrawList(e),this.drawListLogger.isDebug&&this.drawListLogger.debug(this,this.canDrawGate.value,this.requestedAnimationFrame),this.drawTree()},enumerable:!1},addToComposerList:{value:function(e){this.composerList.push(e),_.isDebug&&_.debug(this,e,"Added to composer list"),this._scheduleComposerRequest=!0,this.drawTree()}},composerListSwap:{get:function(){return this._composerListSwap||(this._composerListSwap=[]),this._composerListSwap}},_composerListSwap:{value:null},_scheduleComposerRequest:{value:!1},requestedAnimationFrame:{value:null,enumerable:!1},requestAnimationFrame:{value:global.requestAnimationFrame||global.webkitRequestAnimationFrame||global.mozRequestAnimationFrame||global.msRequestAnimationFrame||setTimeout,enumerable:!1},cancelAnimationFrame:{value:global.cancelAnimationFrame||global.webkitCancelAnimationFrame||global.mozCancelAnimationFrame||global.msCancelAnimationFrame||clearTimeout,enumerable:!1},_frameTime:{value:null},_oldSource:{value:null},_diff:{value:function(e,t){function i(e){return void 0===e||null===e}for(var r={},n={},a=0;a<t.length;a++)i(r[t[a]])&&(r[t[a]]={rows:[],o:null}),r[t[a]].rows.push(a);for(a=0;a<e.length;a++)i(n[e[a]])&&(n[e[a]]={rows:[],n:null}),n[e[a]].rows.push(a);for(a in r)1!==r[a].rows.length||i(n[a])||1!==n[a].rows.length||(t[r[a].rows[0]]={text:t[r[a].rows[0]],row:n[a].rows[0]},e[n[a].rows[0]]={text:e[n[a].rows[0]],row:r[a].rows[0]});for(a=0;a<t.length-1;a++)!i(t[a].text)&&i(t[a+1].text)&&t[a].row+1<e.length&&i(e[t[a].row+1].text)&&t[a+1]===e[t[a].row+1]&&(t[a+1]={text:t[a+1],row:t[a].row+1},e[t[a].row+1]={text:e[t[a].row+1],row:a+1});for(a=t.length-1;a>0;a--)!i(t[a].text)&&i(t[a-1].text)&&t[a].row>0&&i(e[t[a].row-1].text)&&t[a-1]===e[t[a].row-1]&&(t[a-1]={text:t[a-1],row:t[a].row-1},e[t[a].row-1]={text:e[t[a].row-1],row:a-1});return{o:e,n:t}}},_previousDrawDate:{enumerable:!1,value:0},_documentResources:{value:null},_needsStylesheetsDraw:{value:!1},_stylesheets:{value:[]},addStylesheet:{value:function(e){this._stylesheets.push(e),this._needsStylesheetsDraw=!0}},_addedStyleSheetsByTemplate:{value:null},addStyleSheetsFromTemplate:{value:function(e){if(!this._addedStyleSheetsByTemplate.has(e)){for(var t,i=e.getResources(),r=this.element.ownerDocument,n=i.createStylesForDocument(r),a=0;t=n[a];a++)this.addStylesheet(t);this._addedStyleSheetsByTemplate.set(e,!0)}}},__bufferDocumentFragment:{value:null},_bufferDocumentFragment:{get:function(){return this.__bufferDocumentFragment||(this.__bufferDocumentFragment=this._element.ownerDocument.createDocumentFragment())}},drawStylesheets:{value:function(){for(var e,t=this._documentResources,i=this._stylesheets,r=t._document.head,n=this._bufferDocumentFragment;e=i.shift();)t.addStyle(e,n);r.insertBefore(n,r.firstChild),this._needsStylesheetsDraw=!1}},drawTree:{value:function(){if(null===this.requestedAnimationFrame){var e=this.requestAnimationFrame;if(e)this.requestedAnimationFrame=e.call(window,this._drawTree);else{var t=Date.now(),i=17-t+this._previousDrawDate;i<0&&(i=0),this.requestedAnimationFrame=setTimeout(this._drawTree,i),this._previousDrawDate=t+i}this._scheduleComposerRequest=!1}},enumerable:!1},_drawTree:{value:function(e){var t;if(this._needsStylesheetsDraw&&this.drawStylesheets(),!this._documentResources.areStylesLoaded)return m.isDebug&&console.log("Draw Cycle Waiting Stylesheets: ",this._documentResources._expectedStyles.length),this.requestedAnimationFrame=null,void this.drawTree();if(m.isDebug&&(t=window.performance?window.performance.now():Date.now()),this._frameTime=e?e:Date.now(),this._clearNeedsDrawTimeOut&&this._clearNeedsDrawList(),_.isDebug){var i=document.body.innerHTML;if(this._oldSource&&i!==this._oldSource){for(var r=["DOM modified outside of the draw loop"],n=this._diff(this._oldSource.split("\n"),i.split("\n")),a=0;a<n.n.length;a++)if(void 0===n.n[a].text||null===n.n[a].text)r.push("+ "+n.n[a]);else for(var o=n.n[a].row+1;o<n.o.length&&(void 0===n.o[o].text||null===n.o[o].text);o++)r.push("- "+n.o[o]);console.warn(r.join("\n"))}console.group((e?_.toTimeString(new Date(e))+" ":"")+"Draw Fired")}if(this.drawIfNeeded(),m.isDebug){var s;s=window.performance?window.performance.now():Date.now(),console.log("Draw Cycle Time: ",s-t,", Components: ",this._lastDrawComponentsCount)}_.isDebug&&(console.groupEnd(),this._oldSource=document.body.innerHTML),this._frameTime=null,this._scheduleComposerRequest&&this.drawTree()}},_readyToDrawList:{enumerable:!1,value:[]},_readyToDrawListIndex:{enumerable:!1,value:null},addToDrawCycle:{value:function(e){var t=this._readyToDrawListIndex;return t.has(e)?void(_.isDebug&&this!==n&&_.debug(r(this)+" added to the draw cycle twice, this should not happen.")):(this._readyToDrawList.push(e),this._readyToDrawListIndex.set(e,!0),void e._updateComponentDom())}},_lastDrawComponentsCount:{value:null},_sortByLevel:{value:function(e,t){return e._treeLevel-t._treeLevel}},drawIfNeeded:{value:function(){var e,t,i,n,a,o,s=this._readyToDrawList,l=0,u=this._composerList,c=_.isDebug;if(s.length=0,this._readyToDrawListIndex.clear(),u&&(o=u.length)>0){for(this._composerList=this.composerListSwap,t=0;t<o;t++)a=u[t],a.needsFrame=!1,a.frame(this._frameTime);u.length=0,this._composerListSwap=u}for(this._drawIfNeeded(0),i=s.length,c&&console.groupCollapsed("willDraw - "+s.length+(s.length>1?" components.":" component."));l<i;){for(t=l;t<i;t++)e=s[t],"function"==typeof e.willDraw&&e.willDraw(this._frameTime),c&&_.debug("Level "+e._treeLevel+" "+r(e));this._drawIfNeeded(0),l=i,i=s.length}for(c&&(console.groupEnd(),console.group("draw - "+s.length+(s.length>1?" components.":" component."))),s.sort(this._sortByLevel),t=0;t<i;t++)e=s[t],e.needsDraw=!1;for(this.requestedAnimationFrame=null,t=i-1;t>=0;t--)e=s[t],e._draw(this._frameTime),e.draw(this._frameTime),c&&_.debug("Level "+e._treeLevel+" "+r(e));for(c&&(console.groupEnd(),console.groupCollapsed("didDraw - "+s.length+(s.length>1?" components.":" component."))),this._didDrawEvent||(this._didDrawEvent=new CustomEvent("didDraw",{bubbles:!1})),t=0;t<i;t++)e=s[t],e.dispatchEvent(this._didDrawEvent),e.didDraw(this._frameTime),e._completedFirstDraw||(n=document.createEvent("CustomEvent"),n.initCustomEvent("firstDraw",!0,!1,null),e.dispatchEvent(n),e._completedFirstDraw=!0),c&&_.debug("Level "+e._treeLevel+" "+r(e));return this._completedFirstDraw||(n=document.createEvent("CustomEvent"),n.initCustomEvent("firstDraw",!0,!1,null),this.dispatchEvent(n),this._completedFirstDraw=!0),c&&console.groupEnd(),m.isDebug&&(this._lastDrawComponentsCount=s.length),!!s.length}},element:{get:function(){return this._element},set:function(e){h.registerEventHandlerForElement(this,e),this._element=e.documentElement,this._documentResources=l.getInstanceForDocument(e)}}});t.__root__=n=(new S).init(),E.addAttributes({accesskey:null,contenteditable:null,contextmenu:null,dir:null,draggable:null,dropzone:null,hidden:{dataType:"boolean"},lang:null,spellcheck:null,tabindex:null,title:null})}}),montageDefine("b7b5e36","data/service/data-service",{dependencies:["core/core","data/service/authorization-manager","data/service/authorization-policy","data/model/data-object-descriptor","data/model/data-query","data/service/data-stream","data/service/data-trigger","collections/map","core/promise","core/meta/object-descriptor","collections/set","collections/weak-map"],factory:function(e,t,i){var r=e("core/core").Montage,n=e("data/service/authorization-manager").AuthorizationManager,a=e("data/service/authorization-policy").AuthorizationPolicy,o=e("data/model/data-object-descriptor").DataObjectDescriptor,s=e("data/model/data-query").DataQuery,l=e("data/service/data-stream").DataStream,u=e("data/service/data-trigger").DataTrigger,c=e("collections/map"),h=e("core/promise").Promise,d=e("core/meta/object-descriptor").ObjectDescriptor,p=e("collections/set"),m=e("collections/weak-map"),v=new r;v.NoAuthorizationPolicy=a.NONE,v.UpfrontAuthorizationPolicy=a.UP_FRONT,v.OnDemandAuthorizationPolicy=a.ON_DEMAND,v.OnFirstFetchAuthorizationPolicy=a.ON_FIRST_FETCH,t.DataService=r.specialize({constructor:{value:function(){t.DataService.mainService=t.DataService.mainService||this,this._initializeAuthorization(),this._initializeOffline()}},deserializeSelf:{value:function(e){var t;t=e.getProperty("childServices"),t&&this.registerChildServices(t),t=e.getProperty("model")||e.getProperty("binder"),t&&(this.model=t),t=!this.model&&e.getProperty("types"),t&&Array.prototype.push.apply(this._childServiceTypes,t),t=e.getProperty("mappings"),t&&Array.prototype.push.apply(this._childServiceMappings,t),t=e.getProperty("delegate"),t&&(this.delegate=t)}},delegate:{value:null},types:{get:function(){return this._childServiceTypes}},mappings:{get:function(){return this._childServiceMappings}},parentService:{get:function(){return this._parentService}},_parentService:{value:void 0},rootService:{get:function(){return this.parentService?this.parentService.rootService:this}},isRootService:{get:function(){return this===this.rootService}},childServices:{get:function(){return this._childServices||(this._childServices=new p),this._childServices}},_childServices:{value:void 0},addChildService:{value:function(e,i){e instanceof t.DataService&&e.constructor!==t.DataService?this._addChildService(e,i):(console.warn("Cannot add child -",e),console.warn("Children must be instances of DataService subclasses."))}},_addChildService:{value:function(e,t){var i,r,n,a,o=1;for(t=t||e.model&&e.model.objectDescriptors||e.types,e._parentService&&e._parentService.removeChildService(e),this.childServices.add(e),this._childServicesByIdentifier.set(e.identifier,e),n=0,a=t&&t.length||o;n<a;n+=1)r=t&&t.length&&t[n]||null,i=this._childServicesByType.get(r)||[],i.push(e),1===i.length&&(this._childServicesByType.set(r,i),r&&this._childServiceTypes.push(r));e._parentService=this}},__childServiceRegistrationPromise:{value:null},_childServiceRegistrationPromise:{get:function(){return this.__childServiceRegistrationPromise||(this.__childServiceRegistrationPromise=h.resolve())},set:function(e){this.__childServiceRegistrationPromise=e}},registerChildServices:{value:function(e){var t;this.__childServiceRegistrationPromise||(t=this,this.__childServiceRegistrationPromise=h.all(e.map(function(e){return t.registerChildService(e)})))}},registerChildService:{value:function(e,t){var i=this,r=e.mappings||[];return t=t&&Array.isArray(t)&&t||t&&[t]||e.model&&e.model.objectDescriptors||e.types&&Array.isArray(e.types)&&e.types||e.types&&[e.types]||[],e._childServiceRegistrationPromise.then(function(){return i._registerChildServiceTypesAndMappings(e,t,r)})}},_registerChildServiceTypesAndMappings:{value:function(e,t,i){var r,n=this;return this._resolveAsynchronousTypes(t).then(function(t){return r=t,n._registerTypesByModuleId(r),n._registerChildServiceMappings(e,i)}).then(function(){return n._makePrototypesForTypes(r)}).then(function(){return n.addChildService(e,t),null})}},_resolveAsynchronousTypes:{value:function(e){var t=this;return h.all(this._flattenArray(e).map(function(e){return e instanceof h?e:h.resolve(e)})).then(function(e){return t._flattenArray(e)})}},_flattenArray:{value:function(e){return Array.prototype.concat.apply([],e)}},_registerTypesByModuleId:{value:function(e){var t=this._moduleIdToObjectDescriptorMap;e.forEach(function(e){var i=e.module,r=[i.id,e.exportName].join("/");t[r]=e})}},_registerChildServiceMappings:{value:function(e,t){var i=this;return h.all(t.map(function(t){return i._addMappingToChild(t,e)}))}},_makePrototypesForTypes:{value:function(e){var t=this;return h.all(e.map(function(e){return t._makePrototypeForType(e)}))}},_makePrototypeForType:{value:function(e){var t=this,i=e.module;return i.require.async(i.id).then(function(i){var r=i[e.exportName],n=Object.create(r.prototype),a=t.mappingWithType(e),o=a&&a.requisitePropertyNames||new p,s=u.addTriggers(t,e,n,o);return t._dataObjectPrototypes.set(r,n),t._dataObjectPrototypes.set(e,n),t._dataObjectTriggers.set(e,s),t._constructorToObjectDescriptorMap.set(r,e),null})}},_addMappingToChild:{value:function(e,t){var i=this;return h.all([e.objectDescriptorReference,e.schemaDescriptorReference]).spread(function(r,n){var a=[r.module.id,r.name].join("/");return r=i._moduleIdToObjectDescriptorMap[a],e.objectDescriptor=r,e.schemaDescriptor=n,e.service=t,t.addMappingForType(e,r),null})}},_objectDescriptorForType:{value:function(e){return this._constructorToObjectDescriptorMap.get(e)||"string"==typeof e&&this._moduleIdToObjectDescriptorMap[e]||e}},_constructorToObjectDescriptorMap:{get:function(){return this.__constructorToObjectDescriptorMap||(this.__constructorToObjectDescriptorMap=new c),this.__constructorToObjectDescriptorMap}},_moduleIdToObjectDescriptorMap:{get:function(){return this.__moduleIdToObjectDescriptorMap||(this.__moduleIdToObjectDescriptorMap={}),this.__moduleIdToObjectDescriptorMap}},removeChildService:{value:function(e,t){var i,r,n,a,o;for(t=t||e.types,a=0,o=t&&t.length||1;a<o;a+=1)i=t&&t.length&&t[a]||null,r=this._childServicesByType.get(i),n=r?r.indexOf(e):-1,n>=0&&r.length>1?r.splice(n,1):0===n&&(this._childServicesByType["delete"](i),n=i?this._childServiceTypes.indexOf(i):-1,n>=0&&this._childServiceTypes.splice(n,1));this.childServices["delete"](e),e._parentService===this&&(e._parentService=void 0)}},unregisterChildService:{value:function(e){var t=this;return new h(function(i,r){t.removeChildService(e,e.types),i()})}},_childServicesByType:{get:function(){return this.__childServicesByType||(this.__childServicesByType=new c),this.__childServicesByType}},__childServicesByType:{value:void 0},_childServicesByIdentifier:{get:function(){return this.__childServicesByIdentifier||(this.__childServicesByIdentifier=new c),this.__childServicesByIdentifier}},__childServicesByIdentifier:{value:void 0},_childServiceTypes:{get:function(){return this.__childServiceTypes||(this.__childServiceTypes=[]),this.__childServiceTypes}},__childServiceTypes:{value:void 0},_getChildServiceForObject:{value:function(e){return this.childServiceForType(this.rootService._getObjectType(e))}},childServiceForType:{value:function(e){var t;return e=e instanceof d?e:this._objectDescriptorForType(e),t=this._childServicesByType.get(e)||this._childServicesByType.get(null),t&&t[0]||null}},addMappingForType:{value:function(e,t){this._mappingByType.set(t,e)}},mappingWithType:{value:function(e){var t;return e=this._objectDescriptorForType(e),t=this._mappingByType.has(e)&&this._mappingByType.get(e),t||null}},_mappingByType:{get:function(){return this.__mappingByType||(this.__mappingByType=new c),this.__mappingByType}},__mappingByType:{value:void 0},_childServiceMappings:{get:function(){return this.__childServiceMappings||(this.__childServiceMappings=[]),this.__childServiceMappings}},__childServiceMappings:{value:void 0},model:{value:void 0},dataMaxAge:{value:void 0},_initializeAuthorization:{value:function(){if(this.providesAuthorization&&t.DataService.authorizationManager.registerAuthorizationService(this),this.authorizationPolicy===v.UpfrontAuthorizationPolicy){var e=this;t.DataService.authorizationManager.authorizeService(this).then(function(t){return e.authorization=t,t})["catch"](function(e){console.log(e)})}else this.authorizationPromise=h.resolve()}},authorizationPolicy:{value:v.NoAuthorizationPolicy},authorization:{value:void 0},authorizationPromise:{value:h.resolve()},authorizationServices:{value:null},authorizationPanel:{value:void 0},providesAuthorization:{value:!1},authorize:{value:function(){return console.warn("DataService.authorize() must be overridden by the implementing service",arguments),this.nullPromise}},logOut:{value:function(){return console.warn("DataService.logOut() must be overridden by the implementing service"),this.nullPromise}},objectDescriptorForObject:{value:function(e){var t,i,n,a,o,s=this.types,l=r.getInfoForObject(e),u=l.moduleId,c=l.objectName;for(a=0,o=s.length;a<o&&!n;a+=1)t=s[a].module,i=t&&s[a].exportName,t&&u===t.id&&c===i&&(n=s[a]);return n||this.parentService&&this.parentService.objectDescriptorForObject(e)}},_getObjectType:{value:function(e){for(var t=this._typeRegistry.get(e),i="string"==typeof e?e:this._getModuleIdForObject(e);!t&&e;)e.constructor.TYPE instanceof o?t=e.constructor.TYPE:this._moduleIdToObjectDescriptorMap[i]?t=this._moduleIdToObjectDescriptorMap[i]:e=Object.getPrototypeOf(e);return t}},_getModuleIdForObject:{value:function(e){var t=r.getInfoForObject(e);return[t.moduleId,t.objectName].join("/")}},_setObjectType:{value:function(e,t){this._getObjectType(e)!==t&&this._typeRegistry.set(e,t)}},_typeRegistry:{get:function(){return this.__typeRegistry||(this.__typeRegistry=new m),this.__typeRegistry}},_getPrototypeForType:{value:function(e){var t;return e=this._objectDescriptorForType(e),t=this._dataObjectPrototypes.get(e),e&&!t&&(t=Object.create(e.objectPrototype||r.prototype),this._dataObjectPrototypes.set(e,t),this._dataObjectTriggers.set(e,u.addTriggers(this,e,t))),t}},_getTriggersForObject:{value:function(e){var t=this._getObjectType(e);return t&&this._dataObjectTriggers.get(t)}},_dataObjectPrototypes:{get:function(){return this.__dataObjectPrototypes||(this.__dataObjectPrototypes=new c),this.__dataObjectPrototypes}},__dataObjectPrototypes:{value:void 0},_dataObjectTriggers:{get:function(){return this.__dataObjectTriggers||(this.__dataObjectTriggers=new c),this.__dataObjectTriggers}},__dataObjectTriggers:{value:void 0},decacheObjectProperties:{value:function(e,t){if(this.isRootService){var i,r,n,a=Array.isArray(t)?t:arguments,o=a===t?0:1,s=this._getTriggersForObject(e);for(r=o,n=a.length;r<n;r+=1)i=s&&s[a[r]],i&&i.decacheObjectProperty(e)}else this.rootService.decacheObjectProperties(e,t)}},getObjectProperties:{value:function(e,t){if(this.isRootService){var i=Array.isArray(t)?t:arguments,r=i===t?0:1;return this._getOrUpdateObjectProperties(e,i,r,!1)}return this.rootService.getObjectProperties(e,t)}},getObjectPropertyExpressions:{value:function(e,t){if(this.isRootService){var i=Array.isArray(t)?t:arguments,r=[],n=this;return i.forEach(function(t){var i=t.split(".");r.push(n._getPropertiesOnPath(e,i))}),h.all(r)}return this.rootService.getObjectPropertyExpressions(e,t)}},_getPropertiesOnPath:{value:function(e,t){var i=this,r=t.shift(),n=this.getObjectProperties(e,r);return n?n.then(function(){var n=null;return t.length&&e[r]&&(n=i._getPropertiesOnPath(e[r],t)),n}):this.nullPromise}},updateObjectProperties:{value:function(e,t){if(this.isRootService){var i=Array.isArray(t)?t:arguments,r=i===t?0:1;return this._getOrUpdateObjectProperties(e,i,r,!0)}return this.rootService.updateObjectProperties(e,t)}},fetchObjectProperty:{value:function(e,t){var i=this.parentService&&this.parentService._getChildServiceForObject(e)===this,r=i&&"function"==typeof this.fetchRawObjectProperty,n=!r&&i&&this._delegateFunctionForPropertyName(t),a=!r&&!n&&i&&this._propertyDescriptorForObjectAndName(e,t),o=!i&&this._getChildServiceForObject(e);return r?this.fetchRawObjectProperty(e,t):n?n.call(this,e):i&&a?this._fetchObjectPropertyWithPropertyDescriptor(e,t,a):o?o.fetchObjectProperty(e,t):this.nullPromise}},_delegateFunctionForPropertyName:{value:function(e){var t=e.charAt(0).toUpperCase()+e.slice(1),i="fetch"+t+"Property";return"function"==typeof this[i]&&this[i]}},_fetchObjectPropertyWithPropertyDescriptor:{value:function(e,t,i){var r=this,n=i.owner,a=n&&this.mappingWithType(n),o={};return a?(Object.assign(o,this.snapshotForObject(e)),a.mapObjectToCriteriaSourceForProperty(e,o,t).then(function(){return Object.assign(o,r.snapshotForObject(e)),a.mapRawDataToObjectProperty(o,e,t)})):this.nullPromise}},_getOrUpdateObjectProperties:{value:function(e,t,i,r){var n,a,o,s,l,u;for(n=this._getTriggersForObject(e),l=i,u=t.length;l<u;l+=1)a=n&&n[t[l]],s=a?r?a.updateObjectProperty(e):a.getObjectProperty(e):this.nullPromise,s!==this.nullPromise&&(o?o.set||o.array[0]===s?o.set&&!o.set.has(s)&&(o.set.add(s),o.array.push(s)):(o.set=new p,o.set.add(o.array[0]),o.set.add(s),o.array.push(s)):o={array:[s]});return o?o.set?h.all(o.array).then(this.nullFunction):o.array[0]:this.nullPromise}},getDataObject:{value:function(e,t,i,r){if(this.isRootService){var n;return this.isUniquing&&r&&(n=this.objectForDataIdentifier(r)),n||(n=this._createDataObject(e,r)),n}return this.rootService.getDataObject(e,t,i,r)}},isUniquing:{value:!1},_identifier:{value:void 0},identifier:{get:function(){return this._identifier||(this._identifier=r.getInfoForObject(this).moduleId)}},__dataIdentifierByObject:{value:null},_dataIdentifierByObject:{get:function(){return this.__objectsByDataIdentifier||(this.__objectsByDataIdentifier=new m)}},dataIdentifierForObject:{value:function(e){return this._dataIdentifierByObject.get(e)}},recordDataIdentifierForObject:{value:function(e,t){this._dataIdentifierByObject.set(t,e)}},removeDataIdentifierForObject:{value:function(e){this._dataIdentifierByObject["delete"](e)}},__objectByDataIdentifier:{value:null},_objectByDataIdentifier:{get:function(){return this.__objectByDataIdentifier||(this.__objectByDataIdentifier=new m)}},objectForDataIdentifier:{value:function(e){return this._objectByDataIdentifier.get(e)}},recordObjectForDataIdentifier:{value:function(e,t){this._objectByDataIdentifier.set(t,e)}},removeObjectForDataIdentifier:{value:function(e){this._objectByDataIdentifier["delete"](e)}},createDataObject:{value:function(e){if(this.isRootService){var t=this._createDataObject(e);
return this.createdDataObjects.add(t),t}this.rootService.createDataObject(e)}},_createDataObject:{value:function(e,t){var i=this._objectDescriptorForType(e),r=Object.create(this._getPrototypeForType(i));return r&&(this.registerUniqueObjectWithDataIdentifier(r,t),r=r.constructor.call(r)||r,r&&this._setObjectType(r,i)),r}},registerUniqueObjectWithDataIdentifier:{value:function(e,t){e&&t&&this.isRootService&&this.isUniquing&&(this.recordDataIdentifierForObject(t,e),this.recordObjectForDataIdentifier(e,t))}},createdDataObjects:{get:function(){return this.isRootService?(this._createdDataObjects||(this._createdDataObjects=new p),this._createdDataObjects):this.rootService.createdDataObjects}},changedDataObjects:{get:function(){return this.isRootService?(this._changedDataObjects=this._changedDataObjects||new p,this._changedDataObjects):this.rootService.changedDataObjects()}},_changedDataObjects:{value:void 0},fetchData:{value:function(e,t,i){var r=this,n=!(e instanceof s),a=n&&e,o=t instanceof l?void 0:t,u=a?s.withTypeAndCriteria(a,o):e,c=t instanceof l?t:i;return u.type=this._objectDescriptorForType(u.type),c=c||new l,c.query=u,c.dataExpression=u.selectExpression,this._dataServiceByDataStream.set(c,this._childServiceRegistrationPromise.then(function(){var e;if(r.parentService&&r.parentService.childServiceForType(u.type)===r&&"function"==typeof r.fetchRawData)e=r,e._fetchRawData(c);else try{if(e=r.childServiceForType(u.type),!e)throw new Error("Can't fetch data of unknown type - "+(u.type.typeName||u.type.name)+"/"+u.type.uuid);c=e.fetchData(u,c)||c,r._dataServiceByDataStream.set(c,e)}catch(t){c.dataError(t)}return e})),c}},_fetchRawData:{value:function(e){var i=this,r=this._childServiceForQuery(e.query);r?r._fetchRawData(e):(this.authorizationPolicy===a.ON_DEMAND&&"function"==typeof this.shouldAuthorizeForQuery&&this.shouldAuthorizeForQuery(e.query)&&!this.authorization&&(this.authorizationPromise=t.DataService.authorizationManager.authorizeService(this).then(function(e){return i.authorization=e,e})["catch"](function(e){console.log(e)})),this.authorizationPromise.then(function(t){var r=e.query;e.query=i.mapSelectorToRawDataQuery(r),i.fetchRawData(e),e.query=r}))}},_childServiceForQuery:{value:function(e){var t=this._serviceIdentifierForQuery(e),i=t&&this._childServicesByIdentifier.get(t);return!i&&this._childServicesByType.has(e.type)&&(i=this._childServicesByType.get(e.type),i=i&&i[0]),i||null}},_serviceIdentifierForQuery:{value:function(e){var t,i,r=e.criteria.parameters,n=r&&r.serviceIdentifier;return n||(t=this.mappingWithType(e.type),i=t&&r&&r.propertyName,n=i&&t.serviceIdentifierForProperty(i)),n}},__dataServiceByDataStream:{value:null},_dataServiceByDataStream:{get:function(){return this.__dataServiceByDataStream||(this.__dataServiceByDataStream=new m)}},dataServiceForDataStream:{get:function(e){return this._dataServiceByDataStream.get(e)}},cancelDataStream:{value:function(e,t){if(e){var i=this._dataServiceByDataStream.get(e),r=this;h.is(i)?i.then(function(i){r._cancelServiceDataStream(i,e,t)}):this._cancelServiceDataStream(i,e,t)}}},_cancelServiceDataStream:{value:function(e,t,i){e.cancelRawDataStream(t,i),this._dataServiceByDataStream["delete"](t)}},deleteDataObject:{value:function(e){var t=!this.createdDataObjects.has(e);return this._updateDataObject(e,t&&"deleteDataObject")}},saveDataObject:{value:function(e){var t,i,r=this,n=this.nullPromise;if(this.parentService&&this.parentService._getChildServiceForObject(e)===this){var a={};return i=this._mapObjectToRawData(e,a),i||(i=this.nullPromise),i.then(function(){return r.saveRawData(a,e).then(function(){return r.rootService.createdDataObjects["delete"](e),null})})}return t=this._getChildServiceForObject(e),t?t.saveDataObject(e):n}},_updateDataObject:{value:function(e,t){var i,r=this,n=this.nullPromise;if(this.parentService&&this.parentService._getChildServiceForObject(e)===this)i=t&&this;else if(i=t&&this._getChildServiceForObject(e))return i._updateDataObject(e,t);return t?i&&(n=i[t](e).then(function(){return r.createdDataObjects["delete"](e),null})):r.createdDataObjects["delete"](e),n}},_saveDataObject:{value:function(e){var t={};return this._mapObjectToRawData(e,t),this.saveRawData(t,e)}},_initializeOffline:{value:function(){var e=this;"function"!=typeof global.addEventListener||t.DataService.prototype._isOfflineInitialized||(t.DataService.prototype._isOfflineInitialized=!0,global.addEventListener("online",function(t){e.rootService.isOffline=!1}),global.addEventListener("offline",function(t){e.rootService.isOffline=!0}))}},_isOfflineInitialized:{value:!1},isOffline:{get:function(){return void 0===this._isOffline&&(this.isOffline=!navigator.onLine),this._isOffline},set:function(e){var t=this;null===this._willBeOffline?(this._isOffline=!!e,this._willBeOffline=void 0):void 0!==this._willBeOffline?this._willBeOffline=!!e:this._isOffline===!1?this._isOffline=!!e:e||(this._isOffline=!0,this._willBeOffline=!1,this._goOnline().then(function(){var e=t._willBeOffline;return t._willBeOffline=null,t.isOffline=e,null}))}},_isOffline:{value:!1},_willBeOffline:{value:void 0},_goOnline:{value:function(){var e=this;return this.readOfflineOperations().then(function(t){return t.sort(this._compareOfflineOperations),e.performOfflineOperations(t)})["catch"](function(e){console.error(e)})}},_compareOfflineOperations:{value:function(e,t){return e.lastModified<t.lastModified?-1:e.lastModified>t.lastModified?1:e.time<t.time?-1:e.time>t.time?1:e.index<t.index?-1:e.index>t.index?1:0}},readOfflineOperations:{value:function(){var e,t,i=this,r=new m,n=this._offlineOperationServices;return this.childServices.forEach(function(a){var o=a.readOfflineOperations(r);o!==i.emptyArrayPromise&&(e=e||[],t=t||[],t.push(o.then(function(t){var i,r;for(i=0,r=t&&t.length;i<r;i+=1)n.set(t[i],a),e.push(t[i]);return null})))}),t?h.all(t).then(function(){return e}):this.emptyArrayPromise}},_offlineOperationServices:{get:function(){return this.__offlineOperationServices||(this.__offlineOperationServices=new m),this.__offlineOperationServices}},__offlineOperationServices:{value:void 0},performOfflineOperations:{value:function(e){var t,i,r,n,a,o,s=this._offlineOperationServices,l=this.nullPromise;for(i=0,n=e.length;i<n;i=r){for(t=s.get(e[i]),r=i+1;r<n&&t&&(o=s.get(a=e[r]))===t;)++r;l=this._performOfflineOperationsBatch(l,t,e,i,r)}return l}},_performOfflineOperationsBatch:{value:function(e,t,i,r,n){var a=this;return e.then(function(){return t?t.performOfflineOperations(i.slice(r,n)):a._performAndDeleteOfflineOperation(i[r])})}},_performAndDeleteOfflineOperation:{value:function(e){var t,i,r,n,a,o,s=this,l=e.type;for(this.offlineService&&(t=this.offlineService.schema[l],i=t.foreignKeys),i||(i=t._computedForeignKeys||(t._computedForeignKeys=Object.keys(e.changes))),r=0,n=i.length;r<n;r++)o=i[r],(a=this.onlinePrimaryKeyForOfflinePrimaryKey(e.changes[o]))&&(e.changes[o]=a);return this._performTypedOfflineOperation(e).then(function(){return s.deleteOfflineOperations([e])})}},_performTypedOfflineOperation:{value:function(e){var t=e.dataType||e.type,i=t&&this[this._getOfflineOperationMethodName(t)];return"function"==typeof i?i.call(this,e):this.performOfflineOperation(e)}},_getOfflineOperationMethodName:{value:function(e){var t="string"==typeof e,i=t&&this._offlineOperationMethodNames.get(e);return t&&!i&&(i="perform",i+=e[0].toUpperCase(),i+=e.slice(1),i+="OfflineOperation",this._offlineOperationMethodNames.set(e,i)),i}},_offlineOperationMethodNames:{value:new c},performOfflineOperation:{value:function(e){return this.nullPromise}},onlinePrimaryKeyForOfflinePrimaryKey:{value:function(e){return this.offlineService?this.offlineService.onlinePrimaryKeyForOfflinePrimaryKey(e):null}},deleteOfflineOperations:{value:function(e){return this.nullPromise}},nullFunction:{value:function(){return null}},nullPromise:{get:function(){return t.DataService._nullPromise||(t.DataService._nullPromise=h.resolve(null)),t.DataService._nullPromise}},_nullPromise:{value:void 0},emptyArrayPromise:{get:function(){return t.DataService._emptyArrayPromise||(t.DataService._emptyArrayPromise=h.resolve([])),t.DataService._emptyArrayPromise}},_emptyArrayPromise:{value:void 0},eventLoopPromise:{get:function(){var e=this;return this._eventLoopPromise||(this._eventLoopPromise=new h(function(t,i){setTimeout(function(){e._eventLoopPromise=void 0,t()},0)})),this._eventLoopPromise}},spliceWithArray:{value:function(e,t,i,r){return i=i||0,r=r||0===r?r:1/0,t?e.splice.apply(e,[i,r].concat(t)):e.splice(i,r)}}},{mainService:{get:function(){return this._mainService&&this._mainService.parentService&&(this._mainService=this._mainService.rootService),this._mainService},set:function(e){this._mainService=e}},AuthorizationPolicyType:{value:v},AuthorizationPolicy:{value:a},authorizationManager:{value:n}})}}),montageDefine("b7b5e36","composer/translate-composer",{dependencies:["./composer","../core/event/event-manager"],factory:function(e,t,i){var r=e("./composer").Composer,n=e("../core/event/event-manager").defaultEventManager,a=t.TranslateComposer=r.specialize({_NATIVE_ELEMENTS:{value:["A","IFRAME","EMBED","OBJECT","VIDEO","AUDIO","CANVAS","LABEL","INPUT","BUTTON","SELECT","TEXTAREA","KEYGEN","DETAILS","COMMAND"]},_WHEEL_POINTER:{value:"wheel",writable:!1},_MOUSE_POINTER:{value:"mouse",writable:!1},_TOUCH_POINTER:{value:"touch",writable:!1},CLAIM_POINTER_POLICIES:{value:{DEFAULT:"default",MOVE:"move"}},enabled:{value:!0},_externalUpdate:{value:!0},isAnimating:{value:!1},isMoving:{value:!1},frame:{value:function(){this.isAnimating&&this._animationInterval(),this._externalUpdate=!1}},_pointerSpeedMultiplier:{value:1},pointerSpeedMultiplier:{get:function(){return this._pointerSpeedMultiplier},set:function(e){this._pointerSpeedMultiplier=e}},pointerStartEventPosition:{value:null},_shouldDispatchTranslate:{value:!1},_isSelfUpdate:{value:!1},_allowFloats:{value:!1},allowFloats:{get:function(){return this._allowFloats},set:function(e){this._allowFloats!==e&&(this._allowFloats=e,this.translateX=this._translateX,this.translateY=this._translateY)}},allowTranslateOuterExtreme:{value:!1},_translateX:{value:0},translateX:{get:function(){return this._translateX},set:function(e){if("vertical"===this._axis)this._translateX=this._minTranslateX||0;else{var t=isNaN(e)?0:this._allowFloats?parseFloat(e):e>>0;null!==this._minTranslateX&&t<this._minTranslateX&&(t=this._minTranslateX),null!==this._maxTranslateX&&t>this._maxTranslateX&&(t=this._maxTranslateX),this._isSelfUpdate||(this.isAnimating=!1),this._translateX=t}}},_translateY:{value:0},translateY:{get:function(){return this._translateY},set:function(e){if("horizontal"===this._axis)this._translateY=this._minTranslateY||0;else{var t=isNaN(e)?0:this._allowFloats?parseFloat(e):e>>0;null!==this._minTranslateY&&t<this._minTranslateY&&(t=this._minTranslateY),null!==this._maxTranslateY&&t>this._maxTranslateY&&(t=this._maxTranslateY),this._isSelfUpdate||(this.isAnimating=!1),this._translateY=t}}},_minTranslateX:{value:null},minTranslateX:{get:function(){return this._minTranslateX},set:function(e){null!==e&&(e=parseFloat(e)),this._minTranslateX!==e&&(null!==e&&this._translateX<e&&(this.translateX=e),this._minTranslateX=e)}},_maxTranslateX:{value:null},maxTranslateX:{get:function(){return this._maxTranslateX},set:function(e){null!==e&&(e=parseFloat(e)),this._maxTranslateX!==e&&(null!==e&&this._translateX>e&&(this.translateX=e),this._maxTranslateX=e)}},_minTranslateY:{value:null},minTranslateY:{get:function(){return this._minTranslateY},set:function(e){null!==e&&(e=parseFloat(e)),this._minTranslateY!==e&&(null!==e&&this._translateY<e&&(this.translateY=e),this._minTranslateY=e)}},_maxTranslateY:{value:null},maxTranslateY:{get:function(){return this._maxTranslateY},set:function(e){null!==e&&(e=parseFloat(e)),this._maxTranslateY!==e&&(null!==e&&this._translateY>e&&(this.translateY=e),this._maxTranslateY=e)}},_axis:{value:"both"},axis:{get:function(){return this._axis},set:function(e){switch(e){case"vertical":case"horizontal":this._axis=e,this.translateX=this._translateX,this.translateY=this._translateY;break;default:this._axis="both"}}},invertAxis:{depends:["invertXAxis","invertYAxis"],get:function(){return this._invertXAxis===this._invertYAxis?this._invertXAxis:null},set:function(e){this.invertXAxis=e,this.invertYAxis=e}},_invertXAxis:{value:!1},invertXAxis:{get:function(){return this._invertXAxis},set:function(e){this._invertXAxis=!!e}},_invertYAxis:{value:!1},invertYAxis:{get:function(){return this._invertYAxis},set:function(e){this._invertYAxis=!!e}},_hasMomentum:{value:!0},hasMomentum:{get:function(){return this._hasMomentum},set:function(e){this._hasMomentum=!!e}},__momentumDuration:{value:650},_momentumDuration:{get:function(){return this.__momentumDuration},set:function(e){this.__momentumDuration=isNaN(e)?1:e>>0,this.__momentumDuration<1&&(this.__momentumDuration=1)}},_pointerX:{value:null},_pointerY:{value:null},_touchIdentifier:{value:null},_isFirstMove:{value:!1},_observedPointer:{value:null},eventManager:{get:function(){return n}},_mouseRadiusThreshold:{value:2},_touchRadiusThreshold:{value:8},_listenToWheelEvent:{value:!1},listenToWheelEvent:{set:function(e){e=!!e,this._listenToWheelEvent!==e&&(this._listenToWheelEvent=e,this._isLoaded&&(e?this._addWheelEventListener():this._removeWheelEventListener()))},get:function(){return this._listenToWheelEvent}},_claimPointerPolicy:{value:null},load:{value:function(){window.PointerEvent?this._element.addEventListener("pointerdown",this,!0):window.MSPointerEvent&&window.navigator.msPointerEnabled?this._element.addEventListener("MSPointerDown",this,!0):(this._element.addEventListener("touchstart",this,!0),this._element.addEventListener("mousedown",this,!0)),this._listenToWheelEvent&&this._addWheelEventListener(),this.eventManager.isStoringPointerEvents=!0}},unload:{value:function(){window.PointerEvent?this._element.removeEventListener("pointerdown",this,!0):window.MSPointerEvent&&window.navigator.msPointerEnabled?this._element.removeEventListener("MSPointerDown",this,!0):(this._element.removeEventListener("touchstart",this,!0),this._element.removeEventListener("mousedown",this,!0)),this._listenToWheelEvent&&this._removeWheelEventListener()}},surrenderPointer:{value:function(e,t){var i=this.callDelegateMethod("surrenderPointer",e,t);return("undefined"==typeof i||i!==!1)&&(this._cancel(),!0)}},addEventListener:{value:function(e,t,i){r.prototype.addEventListener.call(this,e,t,i),"translate"===e&&(this._shouldDispatchTranslate=!0)}},capturePointerdown:{value:function(e){e.pointerType===this._MOUSE_POINTER||window.MSPointerEvent&&e.pointerType===window.MSPointerEvent.MSPOINTER_TYPE_MOUSE?this.captureMousedown(e):(e.pointerType===this._TOUCH_POINTER||window.MSPointerEvent&&e.pointerType===window.MSPointerEvent.MSPOINTER_TYPE_TOUCH)&&this.captureTouchstart(e)}},capturePointermove:{value:function(e){e.pointerType===this._MOUSE_POINTER||window.MSPointerEvent&&e.pointerType===window.MSPointerEvent.MSPOINTER_TYPE_MOUSE?this.captureMousemove(e):(e.pointerType===this._TOUCH_POINTER||window.MSPointerEvent&&e.pointerType===window.MSPointerEvent.MSPOINTER_TYPE_TOUCH)&&this.captureTouchmove(e)}},handlePointerup:{value:function(e){e.pointerType===this._MOUSE_POINTER||window.MSPointerEvent&&e.pointerType===window.MSPointerEvent.MSPOINTER_TYPE_MOUSE?this.handleMouseup(e):(e.pointerType===this._TOUCH_POINTER||window.MSPointerEvent&&e.pointerType===window.MSPointerEvent.MSPOINTER_TYPE_TOUCH)&&this.handleTouchend(e)}},handlePointercancel:{value:function(e){(e.pointerType===this._TOUCH_POINTER||window.MSPointerEvent&&e.pointerType===window.MSPointerEvent.MSPOINTER_TYPE_TOUCH)&&this.handleTouchcancel(e)}},captureMousedown:{value:function(e){this.enabled&&0===e.button&&(this._observedPointer=this._MOUSE_POINTER,this._start(e.clientX,e.clientY,e.target,e.timeStamp))}},captureMousemove:{value:function(e){this.enabled&&this._handleMove(e)}},handleMouseup:{value:function(e){this.enabled&&this._end(e)}},captureTouchstart:{value:function(e){if(this.enabled&&null===this._observedPointer)if(void 0!==e.pointerId)this._observedPointer=e.pointerId,this._start(e.clientX,e.clientY,e.target,e.timeStamp),this._preventDefaultIfNeeded(e);else{var t=e.targetTouches;if(t&&1===t.length){var i=t[0];this._preventDefaultIfNeeded(e),this._observedPointer=i.identifier,this._start(i.clientX,i.clientY,i.target,e.timeStamp)}}}},captureTouchmove:{value:function(e){if(this.enabled)if(void 0!==e.pointerId)this._handleMove(e);else{var t=this._findObservedTouch(e.changedTouches);t&&this._handleMove(e,t)}}},handleTouchend:{value:function(e){if(this.enabled)if(void 0!==e.pointerId)this._end(e);else{var t=this._findObservedTouch(e.changedTouches);t&&this._end(t)}}},handleTouchcancel:{value:function(e){if(this.enabled)if(void 0!==e.pointerId)this._cancel(e);else{var t=this._findObservedTouch(e.changedTouches);t&&this._cancel(t)}}},captureScroll:{value:function(e){e.target.contains(this.element)&&this._cancel(e)}},_shouldPreventDefault:{value:function(e){return!!e.target.tagName&&this._NATIVE_ELEMENTS.indexOf(e.target.tagName)===-1&&!e.target.isContentEditable}},_preventDefaultIfNeeded:{value:function(e){!e.defaultPrevented&&this._shouldPreventDefault(e)&&e.preventDefault()}},_addWheelEventListener:{value:function(){if(this._element){var e="undefined"!=typeof window.onwheel||"undefined"!=typeof window.WheelEvent?"wheel":"mousewheel";this._element.addEventListener(e,this,!1),this._element.addEventListener(e,this,!0)}}},_removeWheelEventListener:{value:function(){if(this._element){var e="undefined"!=typeof window.onwheel||"undefined"!=typeof window.WheelEvent?"wheel":"mousewheel";this._element.removeEventListener(e,this,!1),this._element.removeEventListener(e,this,!0)}}},_start:{value:function(e,t,i,r){this.pointerStartEventPosition={pageX:e,pageY:t,target:i,timeStamp:r},this._pointerX=e,this._pointerY=t,window.PointerEvent?(this._element.addEventListener("pointerdown",this,!1),document.addEventListener("pointermove",this,!0),document.addEventListener("pointerup",this,!1),document.addEventListener("pointercancel",this,!1)):window.MSPointerEvent&&window.navigator.msPointerEnabled?(this._element.addEventListener("MSPointerDown",this,!1),document.addEventListener("MSPointerMove",this,!0),document.addEventListener("MSPointerUp",this,!1),document.addEventListener("MSPointerCancel",this,!1)):this._observedPointer===this._MOUSE_POINTER?(this._element.addEventListener("mousedown",this,!1),document.addEventListener("mousemove",this,!0),document.addEventListener("mouseup",this,!1)):(this._element.addEventListener("touchstart",this,!1),this._element.addEventListener("touchmove",this,!0),this._element.addEventListener("touchend",this,!1),this._element.addEventListener("touchcancel",this,!1)),document.addEventListener("scroll",this,!0),this.isAnimating&&(this.isAnimating=!1,this._dispatchTranslateEnd()),this._isFirstMove=!0}},_handleStart:{value:function(e){this._claimPointerPolicy=this.eventManager.componentClaimingPointer(this._observedPointer)?this.CLAIM_POINTER_POLICIES.MOVE:this.CLAIM_POINTER_POLICIES.DEFAULT}},_findObservedTouch:{value:function(e){for(var t,i=null,r=0;(t=e[r])&&null===i;r++)t.identifier===this._observedPointer&&(i=t);return i}},_handleMove:{value:function(e,t){var i=this.eventManager,n=this.pointerStartEventPosition;if(t||(t=e),this._isFirstMove){var a=i.componentClaimingPointer(this._observedPointer);if(a){var o=!0;if(this._claimPointerPolicy===this.CLAIM_POINTER_POLICIES.MOVE){var s=this._observedPointer===this._MOUSE_POINTER?this._mouseRadiusThreshold:this._touchRadiusThreshold,l=n.pageX-t.clientX,u=n.pageY-t.clientY;o=r.isCoordinateOutsideRadius(l,u,s),o&&(n.pageX=t.clientX,n.pageY=t.clientY,n.target=t.target,n.timeStamp=e.timeStamp,this._pointerX=t.clientX,this._pointerY=t.clientY)}if(!o)return void this._preventDefaultIfNeeded(e)}i.claimPointer(this._observedPointer,this)}i.isPointerClaimedByComponent(this._observedPointer,this)?(this._preventDefaultIfNeeded(e),(this.allowTranslateOuterExtreme||this._shouldMove(e,t.clientX,t.clientY))&&(this._isFirstMove?this._firstMove():this._move(t.clientX,t.clientY))):this._releaseInterest()}},_shouldMove:{value:function(e,t,i){var r,n,a,o,s=this._translateY,l=this._translateX,u=this._minTranslateY,c=this._maxTranslateY,h=this._minTranslateX,d=this._maxTranslateX,p=!0;return"wheel"===e.type||"mousewheel"===e.type?("vertical"!==this._axis&&(a=20*(e.wheelDeltaX||-e.deltaX||0)/120),"horizontal"!==this._axis&&(o=20*(e.wheelDeltaY||-e.deltaY||0)/120),p=!("horizontal"===this._axis&&0===a||"vertical"===this._axis&&0===o||0===a&&0===o)):("vertical"!==this._axis&&(a=-(this._invertXAxis?this._pointerX-t:t-this._pointerX)),"horizontal"!==this._axis&&(o=-(this._invertYAxis?this._pointerY-i:i-this._pointerY))),p&&(o&&(r=this._isNegativeNumber(o),null!==u&&(p=s!==u||s===u&&r),null!==c&&p&&(p=s!==c||s===c&&!r)),a&&(n=this._isNegativeNumber(a),null!==h&&p&&(p=l!==h||l===h&&n),null!==d&&p&&(p=l!==d||l===d&&!n))),p}},_firstMove:{value:function(){this._isFirstMove&&(this._dispatchTranslateStart(this._translateX,this._translateY),this._isFirstMove=!1,this.isMoving=!0)}},_move:{value:function(e,t){var i;this._isSelfUpdate=!0,"vertical"!==this._axis&&(i=this._invertXAxis?this._pointerX-e:e-this._pointerX,this.translateX+=i*this._pointerSpeedMultiplier),"horizontal"!==this._axis&&(i=this._invertYAxis?this._pointerY-t:t-this._pointerY,this.translateY+=i*this._pointerSpeedMultiplier),this._isSelfUpdate=!1,this._pointerX=e,this._pointerY=t,this._shouldDispatchTranslate&&this._dispatchTranslate()}},_end:{value:function(e){this.startTime=Date.now(),this.endX=this.posX=this.startX=this._translateX,this.endY=this.posY=this.startY=this._translateY;var t=e.velocity;this._hasMomentum&&(t.speed>40||this.translateStrideX||this.translateStrideY)?("vertical"!==this._axis?this.momentumX=t.x*this._pointerSpeedMultiplier*(this._invertXAxis?1:-1):this.momentumX=0,"horizontal"!==this._axis?this.momentumY=t.y*this._pointerSpeedMultiplier*(this._invertYAxis?1:-1):this.momentumY=0,this.endX=this.startX-this.momentumX*this.__momentumDuration/2e3,this.endY=this.startY-this.momentumY*this.__momentumDuration/2e3,this.startStrideXTime=null,this.startStrideYTime=null,this.animateMomentum=!0):this.animateMomentum=!1,this.animateMomentum?this._animationInterval():this._isFirstMove||(this.isMoving=!1,this._dispatchTranslateEnd()),this._releaseInterest()}},_cancel:{value:function(e){this.startTime=Date.now(),this.endX=this.posX=this.startX=this._translateX,this.endY=this.posY=this.startY=this._translateY,this.animateMomentum=!1,this._isFirstMove||(this.isMoving=!1,this._dispatchTranslateCancel()),this._releaseInterest()}},_releaseInterest:{value:function(){window.PointerEvent?(this._element.removeEventListener("pointerdown",this,!1),document.removeEventListener("pointermove",this,!0),document.removeEventListener("pointerup",this,!1),document.removeEventListener("pointercancel",this,!1)):window.MSPointerEvent&&window.navigator.msPointerEnabled?(this._element.removeEventListener("MSPointerDown",this,!1),document.removeEventListener("MSPointerMove",this,!0),document.removeEventListener("MSPointerUp",this,!1),document.removeEventListener("MSPointerCancel",this,!1)):this._observedPointer===this._MOUSE_POINTER?(this._element.removeEventListener("mousedown",this,!1),document.removeEventListener("mousemove",this,!0),document.removeEventListener("mouseup",this,!1)):(this._element.removeEventListener("touchstart",this,!1),this._element.removeEventListener("touchmove",this,!0),this._element.removeEventListener("touchend",this,!1),this._element.removeEventListener("touchcancel",this,!1)),document.removeEventListener("scroll",this,!0),this.eventManager.isPointerClaimedByComponent(this._observedPointer,this)&&this.eventManager.forfeitPointer(this._observedPointer,this),this._observedPointer=null,this._isFirstMove=!1,this.isMoving=!1}},_isAxisMovement:{value:function(e){var t,i,r,n,a,o,s,l=e.velocity,u=.7853981633974483,c=2.356194490192345,h=-2.356194490192345,d=-.7853981633974483;if("both"===this.axis)return!0;if(!l||0===l.speed||isNaN(l.speed)?(o=this.pointerStartEventPosition.pageX-e.clientX,s=this.pointerStartEventPosition.pageY-e.clientY,a=Math.atan2(s,o)):a=l.angle,"horizontal"===this.axis){if(r=a<=u&&a>=d,n=a>=c||a<=h,r||n)return!0}else if("vertical"===this.axis&&(t=a<=d&&a>=h,i=a>=u&&a<=c,t||i))return!0;return!1}},_translateEndTimeout:{value:null},_handleWheelTimeout:{value:null},_isNegativeNumber:{value:function(e){return e=+e,isNaN(e)||(e=1/e),e<0}},captureWheel:{value:function(e){this._shouldMove(e)?this.eventManager.isPointerClaimedByComponent(this._WHEEL_POINTER,this)||this.eventManager.claimPointer(this._WHEEL_POINTER,this):this.eventManager.isPointerClaimedByComponent(this._WHEEL_POINTER,this)&&this.eventManager.forfeitPointer(this._WHEEL_POINTER,this)}},handleWheel:{value:function(e){if(this.enabled&&this.eventManager.isPointerClaimedByComponent(this._WHEEL_POINTER,this)){if(this._observedPointer=this._WHEEL_POINTER,this._translateEndTimeout?clearTimeout(this._translateEndTimeout):this._dispatchTranslateStart(),"vertical"!==this.axis&&(this.translateX=this._translateX-20*(e.wheelDeltaX||-e.deltaX||0)/120),"horizontal"!==this.axis&&(this.translateY=this._translateY-20*(e.wheelDeltaY||-e.deltaY||0)/120),this.isMoving=!0,this._dispatchTranslate(),"function"!=typeof this._handleWheelTimeout){var t=function(){this._translateEndTimeout=null,this._dispatchTranslateEnd(),this.isMoving=!1,this.eventManager.isPointerClaimedByComponent(this._WHEEL_POINTER,this)&&this.eventManager.forfeitPointer(this._WHEEL_POINTER,this)};this._handleWheelTimeout=t.bind(this)}this._translateEndTimeout=setTimeout(this._handleWheelTimeout,400),e.preventDefault()}}},_bezierTValue:{value:function(e,t,i,r,n){var a,o,s,l,u=1-3*r+3*t,c=3*r-6*t,h=3*t,d=.5;for(o=0;o<10;o++)l=d*d,a=3*u*l+2*c*d+h,s=1-d,d-=(3*(s*s*d*t+s*l*r)+l*d-e)/a;return l=d*d,s=1-d,3*(s*s*d*i+s*l*n)+l*d}},_dispatchTranslateStart:{value:function(e,t){var i=document.createEvent("CustomEvent");i.initCustomEvent("translateStart",!0,!0,null),i.translateX=e,i.translateY=t,i.scroll=0,i.pointer=this._observedPointer,this.dispatchEvent(i)}},_dispatchTranslateEnd:{value:function(){var e=document.createEvent("CustomEvent");e.initCustomEvent("translateEnd",!0,!0,null),e.translateX=this._translateX,e.translateY=this._translateY,e.scroll=0,e.pointer=this._observedPointer,this.dispatchEvent(e)}},_dispatchTranslateCancel:{value:function(){var e=document.createEvent("CustomEvent");e.initCustomEvent("translateCancel",!0,!0,null),e.translateX=this._translateX,e.translateY=this._translateY,e.scroll=0,e.pointer=this._observedPointer,this.dispatchEvent(e)}},_dispatchTranslate:{value:function(){var e=document.createEvent("CustomEvent");e.initCustomEvent("translate",!0,!0,null),e.translateX=this._translateX,e.translateY=this._translateY,e.scroll=0,e.pointer=this._observedPointer,this.dispatchEvent(e)}},animateBouncingX:{value:!1,enumerable:!1},startTimeBounceX:{value:!1,enumerable:!1},animateBouncingY:{value:!1,enumerable:!1},startTimeBounceY:{value:!1,enumerable:!1},animateMomentum:{value:!1,enumerable:!1},startTime:{value:null,enumerable:!1},startX:{value:null,enumerable:!1},posX:{value:null,enumerable:!1},endX:{value:null,enumerable:!1},startY:{value:null,enumerable:!1},posY:{value:null,enumerable:!1},endY:{value:null,enumerable:!1},translateStrideX:{value:null},translateStrideY:{value:null},translateStrideDuration:{value:330},_animationInterval:{value:function(){var e,t,i,r,n=Date.now(),a=!1;this.animateMomentum&&(e=n-this.startTime,e<this.__momentumDuration?(this.posX=this.startX-(this.momentumX+this.momentumX*(this.__momentumDuration-e)/this.__momentumDuration)*e/1e3/2,this.posY=this.startY-(this.momentumY+this.momentumY*(this.__momentumDuration-e)/this.__momentumDuration)*e/1e3/2,this.translateStrideX&&null===this.startStrideXTime&&(this.__momentumDuration-e<this.translateStrideDuration||Math.abs(this.posX-this.endX)<.75*this.translateStrideX)&&(this.startStrideXTime=n),this.translateStrideY&&null===this.startStrideYTime&&(this.__momentumDuration-e<this.translateStrideDuration||Math.abs(this.posY-this.endY)<.75*this.translateStrideY)&&(this.startStrideYTime=n)):this.animateMomentum=!1),t=Math.round(this.endX/this.translateStrideX),this.startStrideXTime&&n-this.startStrideXTime>0&&(n-this.startStrideXTime<this.translateStrideDuration?(e=this._bezierTValue((n-this.startStrideXTime)/this.translateStrideDuration,.275,0,.275,1),this.posX=this.posX*(1-e)+t*this.translateStrideX*e,a=!0):this.posX=t*this.translateStrideX),t=Math.round(this.endY/this.translateStrideY),this.startStrideYTime&&n-this.startStrideYTime>0&&(n-this.startStrideYTime<this.translateStrideDuration?(e=this._bezierTValue((n-this.startStrideYTime)/this.translateStrideDuration,.275,0,.275,1),this.posY=this.posY*(1-e)+t*this.translateStrideY*e,a=!0):this.posY=t*this.translateStrideY),i=this.posX,r=this.posY,this._isSelfUpdate=!0,this.translateX=i,this.translateY=r,this._shouldDispatchTranslate&&this._dispatchTranslate(),this._isSelfUpdate=!1,this.isAnimating=this.animateMomentum||a,this.isAnimating?this.needsFrame=!0:this._dispatchTranslateEnd()}}});a.prototype.captureMSPointerDown=a.prototype.capturePointerdown,a.prototype.captureMSPointerMove=a.prototype.capturePointermove,a.prototype.handleMSPointerUp=a.prototype.handlePointerup,a.prototype.handleMSPointerCancel=a.prototype.handlePointercancel,a.prototype.handleMousewheel=a.prototype.handleWheel,a.prototype.handleMSPointerDown=a.prototype._handleStart,a.prototype.handlePointerdown=a.prototype._handleStart,a.prototype.handleMousedown=a.prototype._handleStart,a.prototype.handleTouchstart=a.prototype._handleStart,void 0!==Math.sign&&(a.prototype._isNegativeNumber=function(e){return Math.sign(e)===-1})}}),montageDefine("b7b5e36","core/template",{dependencies:["./core","core/serialization/deserializer/montage-deserializer","./document-part","./document-resources","./serialization/serialization","./serialization/serializer/montage-labeler","./promise","./mini-url","./logger","./event/event-manager","./application"],factory:function(e,t,i){function r(e,t,i){var r,n,a=new p,o=e.documentElement.outerHTML,l=new s,u=e.documentElement;return r=a.createHtmlDocumentWithHtml(o,e.location.href),a.initWithDocument(r,t).then(function(){return a.setBaseUrl(e.location.href),n=a._createTemplateObjects(i),l.initWithTemplateAndFragment(a),a._instantiateObjects(n,u).then(function(e){return l.objects=e,a._invokeDelegates(l),l})})}var n,a=e("./core").Montage,o=e("core/serialization/deserializer/montage-deserializer").MontageDeserializer,s=e("./document-part").DocumentPart,l=e("./document-resources").DocumentResources,u=e("./serialization/serialization").Serialization,c=e("./serialization/serializer/montage-labeler").MontageLabeler,h=e("./promise").Promise,d=e("./mini-url"),p=(e("./logger").logger("template"),e("./event/event-manager").defaultEventManager,a.specialize({_SERIALIZATION_SCRIPT_TYPE:{value:"text/montage-serialization"},_ELEMENT_ID_ATTRIBUTE:{value:"data-montage-id"},PARAM_ATTRIBUTE:{value:"data-param"},_require:{value:null},_resources:{value:null},_baseUrl:{value:null},_instances:{value:null},_metadata:{value:null},_objectsString:{value:null},objectsString:{get:function(){return this._objectsString},set:function(e){this._objectsString=e,this._serialization&&this._serialization.initWithString(e),this.__deserializer=null}},__deserializer:{value:null},_deserializer:{get:function(){var e,t,i=this.__deserializer;if(!i){if(e=this._metadata){t=Object.create(null);for(var r in e)t[r]=e[r].require}i=(new o).init(this.objectsString,this._require,t),this.__deserializer=i}return i}},getDeserializer:{value:function(){return this._deserializer}},_serialization:{value:null},getSerialization:{value:function(){var e=this._serialization;return e||(e=this._serialization=new u,e.initWithString(this.objectsString)),e}},_isDirty:{value:!1},isDirty:{
get:function(){return this._isDirty},set:function(e){this._isDirty!==e&&(this._isDirty=e,this.clearTemplateFromElementContentsCache())}},refresher:{value:null},_document:{value:null},document:{get:function(){return this._isDirty&&this.refresh(),this._document},set:function(e){this._document=e}},initWithRequire:{value:function(e){return this._require=e,this.document=this.createHtmlDocumentWithHtml(""),this.objectsString="",this}},initWithDocument:{value:function(e,t){var i=this;return this._require=t,this.setDocument(e),this.getObjectsString(e).then(function(e){return i.objectsString=e,i})}},initWithHtml:{value:function(e,t){var i=this;return this._require=t,this.document=this.createHtmlDocumentWithHtml(e),this.getObjectsString(this.document).then(function(e){return i.objectsString=e,i})}},initWithObjectsAndDocumentFragment:{value:function(e,t,i){return this._require=i,this.document=this.createHtmlDocumentWithHtml(""),this.document.body.appendChild(this.document.importNode(t,!0)),this.setObjects(e),this}},initWithModuleId:{value:function(e,t){var i=this;return this._require=t,this.createHtmlDocumentWithModuleId(e,t).then(function(r){var n=t(e).directory;return i.document=r,i.setBaseUrl(n),i.getObjectsString(r).then(function(e){return i.objectsString=e,i})})}},clone:{value:function(){var e=new p;return e._require=this._require,e._baseUrl=this._baseUrl,e.setDocument(this.document),e.objectsString=this.objectsString,e._instances=Object.clone(this._instances,1),e}},instantiate:{value:function(e){return this.instantiateWithInstances(null,e)}},instantiateWithInstances:{value:function(e,t){var i,r,n,a=this,o=new s;return e=e||this._instances,i=this._createMarkupDocumentFragment(t),n=this._getParameters(i),o.initWithTemplateAndFragment(this,i),o.startActingAsTopComponent(),o.parameters=n,r=this._createTemplateObjects(e),this._instantiateObjects(r,i).then(function(i){var r=a.getResources();return!r.resourcesLoaded()&&r.hasResources()&&r.loadResources(t),o.objects=i,a._invokeDelegates(o,e),o.stopActingAsTopComponent(),o})}},_objectsInstantiationOptimized:{value:!1},_optimizeObjectsInstantiationPromise:{value:null},_optimizeObjectsInstantiation:{value:function(){var e,t=this;if(!this._objectsInstantiationOptimized)return this._optimizeObjectsInstantiationPromise||(e=this._deserializer.preloadModules(),e?this._optimizeObjectsInstantiationPromise=e.then(function(){t._objectsInstantiationOptimized=!0}):this._objectsInstantiationOptimized=!0),this._optimizeObjectsInstantiationPromise}},setBaseUrl:{value:function(e){this._baseUrl=e}},getBaseUrl:{value:function(){return this._baseUrl}},getResources:{value:function(){var e=this._resources;return e||(e=this._resources=new t.TemplateResources,e.initWithTemplate(this)),e}},_createTemplateObjects:{value:function(t){var i=Object.create(t||null);return"undefined"==typeof n&&(n=e("./application").application),i.application=n,i.template=this,i}},_instantiateObjects:{value:function(e,t){var i,r=this._deserializer;return h.is(r)?r:(i=this._optimizeObjectsInstantiation(),i?i.then(function(){return r.deserialize(e,t)}):r.deserialize(e,t))}},_createMarkupDocumentFragment:{value:function(e){for(var t=e.createDocumentFragment(),i=this.document.body.childNodes,r=0,n=i.length;r<n;r++)t.appendChild(e.importNode(i[r],!0));return t}},getParameterName:{value:function(e){return e.getAttribute(this.PARAM_ATTRIBUTE)}},getParameters:{value:function(){return this._getParameters(this.document.body)}},_getParameters:{value:function(e){for(var t,i,r=e.querySelectorAll("*["+this.PARAM_ATTRIBUTE+"]"),n=r.length,a={},o=0;o<n;o++){if(t=r[o],i=this.getParameterName(t),i in a)throw new Error('The parameter "'+i+'" is declared more than once in '+this.getBaseUrl()+".");a[i]=t}return a}},hasParameters:{value:function(){return!!this.document.querySelector("*["+this.PARAM_ATTRIBUTE+"]")}},_invokeDelegates:{value:function(e,t){var i,r,n,a=e.objects,o=a.owner||t&&t.owner;for(var s in a)t&&s in t||(i=a[s],r=this._getObjectOwner(s,o),n=this._getObjectLabel(s),i&&("function"==typeof i._deserializedFromTemplate&&i._deserializedFromTemplate(r,n,e),"function"==typeof i.deserializedFromTemplate&&i.deserializedFromTemplate(r,n,e)));if(o){var l=this.getSerialization();l.isExternalObject("owner")||("function"==typeof o._templateDidLoad&&o._templateDidLoad(e),"function"==typeof o.templateDidLoad&&o.templateDidLoad(e))}}},setInstances:{value:function(e){this._instances=e}},getInstances:{value:function(){return this._instances}},setObjects:{value:function(e){this.objectsString=JSON.stringify(e,null,4)}},setObjectMetadata:{value:function(e,t,i,r){var n=this._metadata;n||(this._metadata=n=Object.create(null)),n[e]={require:t,label:i,owner:r},this.__deserializer=null}},getObjectMetadata:{value:function(e){var t=this._metadata;return t&&e in t?t[e]:{require:this._require,label:e}}},_getObjectOwner:{value:function(e,t){var i,r=this._metadata;return i=r&&e in r?r[e].owner:t}},_getObjectLabel:{value:function(e){var t,i=this._metadata;return t=i&&e in i?i[e].label:e}},setDocument:{value:function(e){this.document=this.cloneHtmlDocument(e),this.clearTemplateFromElementContentsCache()}},getObjectsString:{value:function(e){var t;return t=this.getInlineObjectsString(e),null===t?this.getExternalObjectsString(e):h.resolve(t)}},getInlineObjectsString:{value:function(e){var t="script[type='"+this._SERIALIZATION_SCRIPT_TYPE+"']",i=e.querySelector(t);return i?i.textContent:null}},getExternalObjectsString:{value:function(e){var t,i=e.querySelector('link[rel="serialization"]');return i?t=new h(function(e,t){var r=new XMLHttpRequest,n=i.getAttribute("href");r.open("GET",n),r.addEventListener("load",function(i){var r=i.target;200===r.status?e(r.responseText):t(new Error("Unable to retrive '"+n+"', code status: "+r.status))},!1),r.addEventListener("error",function(e){t(new Error("Unable to retrive '"+n+"' with error: "+e.error+"."))},!1),r.send()}):h.resolve(null)}},createHtmlDocumentWithHtml:{value:function(e,t){var i=document.implementation.createHTMLDocument("");return e&&(i.documentElement.innerHTML=e,t&&this.normalizeRelativeUrls(i,t)),i}},cloneHtmlDocument:{value:function(e){var t=document.implementation.createHTMLDocument(""),i=e.baseURI||e.URL;return t.replaceChild(t.importNode(e.documentElement,!0),t.documentElement),this.normalizeRelativeUrls(t,i),t}},createHtmlDocumentWithModuleId:{value:function(e,t){var i=this;return"function"!=typeof t?h.reject(new Error("Missing 'require' function to load module '"+e+"'.")):t.async(e).then(function(e){return i.createHtmlDocumentWithHtml(e.content,e.directory)})}},_removeObjects:{value:function(e){var t="script[type='"+this._SERIALIZATION_SCRIPT_TYPE+"'], link[rel='serialization']";Array.prototype.forEach.call(e.querySelectorAll(t),function(e){e.parentNode.removeChild(e)})}},_addObjects:{value:function(e,t){if(t){var i=e.createElement("script");i.setAttribute("type",this._SERIALIZATION_SCRIPT_TYPE),i.textContent=JSON.stringify(JSON.parse(t),null,4),e.head.appendChild(i)}}},_templateFromElementContentsCache:{value:null},clearTemplateFromElementContentsCache:{value:function(){this._templateFromElementContentsCache=null}},createTemplateFromElementContents:{value:function(e){var t,i,r,n=this._templateFromElementContentsCache;return n||(n=Object.create(null),this._templateFromElementContentsCache=n),e in n?Object.create(n[e]):(t=this.getElementById(e),r=this.document.createRange(),r.selectNodeContents(t),i=this.createTemplateFromRange(r),n[e]=i,Object.create(i))}},createTemplateFromElement:{value:function(e){var t,i;return t=this.getElementById(e),i=this.document.createRange(),i.selectNode(t),this.createTemplateFromRange(i)}},createTemplateFromRange:{value:function(e){var t,i,r,n,a,o=new u;return t=e.cloneContents(),i=this._getChildrenElementIds(t),o.initWithString(this.objectsString),r=o.getSerializationLabelsWithElements(i),a=o.extractSerialization(r,["owner"]),n=new p,n.initWithObjectsAndDocumentFragment(null,t,this._require),n.objectsString=a.getSerializationString(),n._resources=this.getResources(),n}},_createSerializationWithElementIds:{value:function(e){var t,i,r=new u;return r.initWithString(this.objectsString),t=r.getSerializationLabelsWithElements(e),i=r.extractSerialization(t,["owner"])}},expandParameters:{value:function(e){var t,i,r,n,a,o,s,l=[],u={},c=this.getSerialization(),h={};t=this.getParameters();for(var d in t)if(t.hasOwnProperty(d)&&(n=t[d],a=e.getTemplateArgumentElement(d),l.push.apply(l,this._getElementIds(a)),i=this.replaceNode(a,n)))for(var p in i)u[p]=i[p];return h.elementIds=l,h.elementIdsCollisions=u,o=e.getTemplateArgumentSerialization(l),o.renameElementReferences(u),s=function(t){if(t.indexOf(":")>0)return e.resolveTemplateArgumentTemplateProperty(t)},r=c.mergeSerialization(o,{willMergeObjectWithLabel:s}),this.objectsString=c.getSerializationString(),h.labels=o.getSerializationLabels(),h.labelsCollisions=r,h}},_resolveElementIdCollisions:{value:function(e,t){var i,r,n,a,o,s;t=t||new c,a=this.getElementIds();for(var l=0;n=a[l];l++)t.addLabel(n);r=this._getElements(e);for(n in r)this.getElementById(n)&&(o=r[n],s=t.generateLabel(t.getLabelBaseName(n)),this.setElementId(o,s),i||(i=Object.create(null)),i[n]=s);return i}},replaceNode:{value:function(e,t,i){var r;return r=this._resolveElementIdCollisions(e,i),this.normalizeRelativeUrls(e,this.getBaseUrl()),t.parentNode.replaceChild(e,t),r}},insertNodeBefore:{value:function(e,t,i){var r;return r=this._resolveElementIdCollisions(e,i),this.normalizeRelativeUrls(e,this.getBaseUrl()),t.parentNode.insertBefore(e,t),r}},appendNode:{value:function(e,t,i){var r;return r=this._resolveElementIdCollisions(e,i),this.normalizeRelativeUrls(e,this.getBaseUrl()),t.appendChild(e),r}},getElementId:{value:function(e){if(e.getAttribute)return e.getAttribute(this._ELEMENT_ID_ATTRIBUTE)}},setElementId:{value:function(e,t){e.setAttribute(this._ELEMENT_ID_ATTRIBUTE,t)}},getElementIds:{value:function(){return this._getElementIds(this.document.body)}},_getElements:{value:function(e){var t,i,r="*["+this._ELEMENT_ID_ATTRIBUTE+"]",n={};t=e.querySelectorAll(r);for(var a,o=0;a=t[o];o++)i=this.getElementId(a),n[i]=a;return i=this.getElementId(e),i&&(n[i]=e),n}},_getChildrenElementIds:{value:function(e){var t,i="*["+this._ELEMENT_ID_ATTRIBUTE+"]",r=[];t=e.querySelectorAll(i);for(var n,a=0;n=t[a];a++)r.push(this.getElementId(n));return r}},_getElementIds:{value:function(e){var t,i=this._getChildrenElementIds(e);return t=this.getElementId(e),t&&i.push(t),i}},getElementById:{value:function(e){var t="*["+this._ELEMENT_ID_ATTRIBUTE+"='"+e+"']";return this.document.querySelector(t)}},html:{get:function(){var e=this.document;return this._removeObjects(e),this._addObjects(e,this.objectsString),this._getDoctypeString(e.doctype)+"\n"+e.documentElement.outerHTML}},_getDoctypeString:{value:function(e){return"<!DOCTYPE "+e.name+(e.publicId?' PUBLIC "'+e.publicId+'"':"")+(!e.publicId&&e.systemId?" SYSTEM":"")+(e.systemId?' "'+e.systemId+'"':"")+">"}},normalizeRelativeUrls:{value:function(e,t){if("string"==typeof t&&""!==t&&"about:blank"!==t)for(var i="http://www.w3.org/1999/xlink",r=/^[\w\-]+:|^\//,n=p._NORMALIZED_TAG_NAMES.indexOf(e.tagName)!==-1?[e]:e.querySelectorAll(p._NORMALIZED_TAG_NAMES_SELECTOR),a=0,o=n.length;a<o;a++){var s,l=n[a];"image"===l.tagName?(s=l.getAttributeNS(i,"href"),r.test(s)||l.setAttributeNS(i,"href",d.resolve(t,s))):l.hasAttribute("src")?(s=l.getAttribute("src"),""===s||r.test(s)||l.setAttribute("src",d.resolve(t,s))):l.hasAttribute("href")&&(s=l.getAttribute("href"),""===s||r.test(s)||l.setAttribute("href",d.resolve(t,s)))}}},replaceContentsWithTemplate:{value:function(e){this._require=e._require,this._baseUrl=e._baseUrl,this._document=e._document,this.objectsString=e.objectsString,this._instances=e._instances,this._templateFromElementContentsCache=e._templateFromElementContentsCache,this._metadata=e._metadata}},refresh:{value:function(){this.isDirty&&(this.refresher&&"function"==typeof this.refresher.refreshTemplate?(this.refresher.refreshTemplate(this),this.isDirty=!1):console.warn("Not able to refresh without a refresher.refreshTemplate."))}}},{_templateCache:{value:{moduleId:Object.create(null)}},_getTemplateCacheKey:{value:function(e,t){return e=t.resolve(e),t.location+"#"+e}},getTemplateWithModuleId:{value:function(e,t){var i,r;return i=this._getTemplateCacheKey(e,t),r=this._templateCache.moduleId[i],r||(r=(new p).initWithModuleId(e,t),this._templateCache.moduleId[i]=r),r}},_NORMALIZED_TAG_NAMES:{value:["IMG","image","IFRAME","link","script"]},__NORMALIZED_TAG_NAMES_SELECTOR:{value:null},_NORMALIZED_TAG_NAMES_SELECTOR:{get:function(){return this.__NORMALIZED_TAG_NAMES_SELECTOR||(this.__NORMALIZED_TAG_NAMES_SELECTOR=this._NORMALIZED_TAG_NAMES.join(",")),this.__NORMALIZED_TAG_NAMES_SELECTOR}}})),m=a.specialize({_resources:{value:null},_resourcesLoaded:{value:!1},template:{value:null},rootUrl:{value:""},constructor:{value:function(){this._resources=Object.create(null)}},initWithTemplate:{value:function(e){this.template=e}},hasResources:{value:function(){return this.getStyles().length>0||this.getScripts().length>0}},resourcesLoaded:{value:function(){return this._resourcesLoaded}},loadResources:{value:function(e){return this._resourcesLoaded=!0,h.all([this.loadScripts(e),this.loadStyles(e)])}},getScripts:{value:function(){var e,t,i,r=this._resources.scripts;if(!r){t=this.template,r=this._resources.scripts=[],i=t.document.querySelectorAll("script");for(var n=0,a=i.length;n<a;n++)e=i[n],e.type!==this.template._SERIALIZATION_SCRIPT_TYPE&&r.push(e)}return r}},loadScripts:{value:function(e){var t=this.getScripts(),i=t.length;if(i){for(var r=[],n=0;n<i;n++)r.push(this.loadScript(t[n],e));return h.all(r)}return h.resolve()}},loadScript:{value:function(e,t){var i,r;return i=l.getInstanceForDocument(t),r=this._cloneScriptElement(e,t),i.addScript(r)}},_cloneScriptElement:{value:function(e,t){for(var i,r=t.createElement("script"),n=e.attributes,a=0,o=n.length;a<o;a++)i=n[a],r.setAttribute(i.name,i.value);return r.textContent=e.textContent,r}},getStyles:{value:function(){var e,t,i,r=this._resources.styles;return r||(i='link[rel="stylesheet"], style',e=this.template,t=e.document.querySelectorAll(i),r=Array.prototype.slice.call(t,0),this._resources.styles=r),r}},loadStyles:{value:function(e){var t,i=[];t=this.getStyles();for(var r=0,n=t.length;r<n;r++)i.push(this.loadStyle(t[r],e));return h.all(i)}},loadStyle:{value:function(e,t){var i,r;return i=e.getAttribute("href"),i?(r=l.getInstanceForDocument(t),r.preloadResource(i)):h.resolve()}},createStylesForDocument:{value:function(e){for(var t,i,r=this.getStyles(),n=[],a=0;i=r[a];a++)t=e.importNode(i,!0),n.push(t);return n}}}),v=a.specialize({getTemplateArgumentElement:{value:Function.noop},getTemplateArgumentSerialization:{value:Function.noop},resolveTemplateArgumentTemplateProperty:{value:Function.noop}});t.Template=p,t.TemplateArgumentProvider=v,t.TemplateResources=m,t.instantiateDocument=r}}),montageDefine("b7b5e36","composer/press-composer",{dependencies:["../core/core","./composer","../core/event/mutable-event"],factory:function(e,t,i){var r=e("../core/core").Montage,n=e("./composer").Composer,a=e("../core/event/mutable-event").MutableEvent,o=function(){function e(e){return{get:function(){return this._event[e]}}}function t(e){return{get:function(){return this._touch?this._touch[e]:this._event[e]}}}var i=a.specialize({type:{value:"press"},_event:{enumerable:!1,value:null},event:{get:function(){return this._event},set:function(e){this._event=e}},_touch:{enumerable:!1,value:null},touch:{get:function(){return this._touch},set:function(e){this._touch=e}}});return["altKey","ctrlKey","metaKey","shiftKey","cancelBubble","currentTarget","defaultPrevented","eventPhase","timeStamp","preventDefault","stopImmediatePropagation","stopPropagation"].forEach(function(t){r.defineProperty(i,t,e(t))}),["clientX","clientY","pageX","pageY","screenX","screenY","target"].forEach(function(e){r.defineProperty(i,e,t(e))}),i}(),s=t.PressComposer=n.specialize({load:{value:function(){window.PointerEvent?this._element.addEventListener("pointerdown",this,!0):window.MSPointerEvent&&window.navigator.msPointerEnabled?this._element.addEventListener("MSPointerDown",this,!0):(this._element.addEventListener("touchstart",this,!0),this._element.addEventListener("mousedown",this,!0))}},unload:{value:function(){window.PointerEvent?this._element.removeEventListener("pointerdown",this,!0):window.MSPointerEvent&&window.navigator.msPointerEnabled?this._element.removeEventListener("MSPointerDown",this,!0):(this._element.removeEventListener("touchstart",this,!0),this._element.removeEventListener("mousedown",this,!0))}},delegate:{value:null},cancelPress:{value:function(){return this._state===s.PRESSED&&(this._cancelPress(),!0)}},_cancelPress:{value:function(e){this._dispatchPressCancel(e),this._endInteraction()}},addEventListener:{value:function(e,t,i){n.prototype.addEventListener.call(this,e,t,i),"longPress"===e&&(this._shouldDispatchLongPress=!0)}},_state:{value:0},state:{get:function(){return this._state}},_shouldDispatchLongPress:{value:!1},_longPressThreshold:{value:1e3},longPressThreshold:{get:function(){return this._longPressThreshold},set:function(e){this._longPressThreshold!==e&&(this._longPressThreshold=e)}},_needDispatchSafePress:{value:!1},_longPressTimeout:{value:null},_observedPointer:{value:null},_initialCenterPositionX:{value:0},_initialCenterPositionY:{value:0},_shouldSaveInitialCenterPosition:{value:!1},_targetElementOnLastTouchMove:{value:null},_endInteraction:{value:function(){this._element&&(this._removeEventListeners(),this.component.eventManager.isPointerClaimedByComponent(this._observedPointer,this)&&this.component.eventManager.forfeitPointer(this._observedPointer,this),this._observedPointer=null,this._targetElementOnLastTouchMove=null,this._state=s.UNPRESSED,this._initialCenterPositionX=0,this._initialCenterPositionY=0,this._shouldSaveInitialCenterPosition=!1)}},_changedTouchisObserved:{value:function(e){if(null===this._observedPointer)return!1;for(var t=0,i=e.length;t<i;t++)if(e[t].identifier===this._observedPointer)return t;return!1}},surrenderPointer:{value:function(e,t){var i=this.callDelegateMethod("shouldComposerSurrenderPointerToComponent",this,e,t);return("undefined"==typeof i||i!==!1)&&(this.cancelPress(),!0)}},_shouldPerformPress:{value:function(){return!(this.component.disabled||null!==this._observedPointer)}},capturePointerdown:{value:function(e){"touch"===e.pointerType||window.MSPointerEvent&&e.pointerType===window.MSPointerEvent.MSPOINTER_TYPE_TOUCH?this.captureTouchstart(e):("mouse"===e.pointerType||window.MSPointerEvent&&e.pointerType===window.MSPointerEvent.MSPOINTER_TYPE_MOUSE)&&this.captureMousedown(e)}},handlePointerup:{value:function(e){"touch"===e.pointerType||window.MSPointerEvent&&e.pointerType===window.MSPointerEvent.MSPOINTER_TYPE_TOUCH?this.handleTouchend(e):("mouse"===e.pointerType||window.MSPointerEvent&&e.pointerType===window.MSPointerEvent.MSPOINTER_TYPE_MOUSE)&&this.handleMouseup(e)}},handlePointercancel:{value:function(e){("touch"===e.pointerType||window.MSPointerEvent&&e.pointerType===window.MSPointerEvent.MSPOINTER_TYPE_TOUCH)&&this.handleTouchcancel(e)}},captureTouchstart:{value:function(e){this._shouldPerformPress()&&(void 0!==e.pointerId?this._observedPointer=e.pointerId:e.changedTouches&&1===e.changedTouches.length&&(this._observedPointer=e.changedTouches[0].identifier),null!==this._observedPointer&&this.component.eventManager.claimPointer(this._observedPointer,this)?this._addPointerDownListener():this._observedPointer=null)}},handleTouchend:{value:function(e){if(null===this._observedPointer)return void this._endInteraction(e);var t;e.pointerId===this._observedPointer?t=e.target:this._changedTouchisObserved(e.changedTouches)!==!1&&(t=this._targetElementOnLastTouchMove||e.target),t&&this.component.eventManager.isPointerClaimedByComponent(this._observedPointer,this)&&(this.element===t||this.element.contains(t)?this._dispatchPress(e,"undefined"==typeof e.pointerId?t:null):this._dispatchPressCancel(e),this._endInteraction(e))}},_saveInitialCenterPositionIfNeeded:{value:function(){this._shouldSaveInitialCenterPosition&&(this._saveInitialCenterPosition(),this._shouldSaveInitialCenterPosition=!1)}},_cancelPressIfCenterPositionChange:{value:function(e){return this._saveInitialCenterPositionIfNeeded(),!!this._isPositionChanged(e)&&(this._cancelPress(e),!0)}},_handleMove:{value:function(e){if(null===this._observedPointer)return void this._endInteraction(e);if(this._needDispatchSafePress=!1,("mouse"===this._observedPointer||e.pointerId===this._observedPointer||e.changedTouches&&this._changedTouchisObserved(e.changedTouches)!==!1)&&this.component.eventManager.isPointerClaimedByComponent(this._observedPointer,this)&&!this._cancelPressIfCenterPositionChange(e)&&"touchmove"===e.type){var t=e.changedTouches[0];this._targetElementOnLastTouchMove=document.elementFromPoint(t.clientX,t.clientY)}}},captureWheel:{value:function(e){return null===this._observedPointer?void this._endInteraction(e):void((e.target===this.element||e.target===window||"function"==typeof e.target.contains&&e.target.contains(this.element)||this.element.contains(e.target))&&this._cancelPressIfCenterPositionChange(e))}},handleTouchcancel:{value:function(e){null!==this._observedPointer&&e.pointerId!==this._observedPointer&&this._changedTouchisObserved(e.changedTouches)===!1||(this.component.eventManager.isPointerClaimedByComponent(this._observedPointer,this)&&this._dispatchPressCancel(e),this._endInteraction(e))}},captureMousedown:{value:function(e){0===e.button&&this._shouldPerformPress()&&(this._observedPointer="mouse",this.component.eventManager.claimPointer(this._observedPointer,this),this.component.eventManager.isPointerClaimedByComponent(this._observedPointer,this)?this._addPointerDownListener():this._observedPointer=null)}},_handlePointerDown:{value:function(e){if(this._removePointerDownListener(),this.component.eventManager.isPointerClaimedByComponent(this._observedPointer,this)){if(this._needDispatchSafePress=!1,"touchstart"===e.type){var t=this;window.nativeAddEventListener("touchstart",function i(e){window.nativeRemoveEventListener("touchstart",i,!1),t._needDispatchSafePress=!e.defaultPrevented},!1)}this._shouldSaveInitialCenterPosition=!0,this._addEventListeners(),this._dispatchPressStart(e)}else this._observedPointer=null}},captureScroll:{value:function(e){(e.target===this.element||e.target===window||"function"==typeof e.target.contains&&e.target.contains(this.element)||this.element.contains(e.target))&&this._cancelPressIfCenterPositionChange(e)}},handleMouseup:{value:function(e){if(null===this._observedPointer)return void this._endInteraction(e);if(this.component.eventManager.isPointerClaimedByComponent(this._observedPointer,this)){for(var t=e.target;t!==this._element&&t&&t.parentNode;)t=t.parentNode;if(t===this._element)return this._dispatchPress(e),void this._endInteraction(e)}this._cancelPress(e)}},handleDragstart:{value:function(e){this._cancelPress(e)}},_saveInitialCenterPosition:{value:function(){if(this.element instanceof HTMLElement){var e=this.element.getBoundingClientRect();this._initialCenterPositionX=e.left+e.width/2,this._initialCenterPositionY=e.top+e.height/2}}},_isPositionChanged:{value:function(e){if(this.element instanceof HTMLElement){var t=this.element.getBoundingClientRect(),i=t.left+t.width/2,r=t.top+t.height/2;if(this._initialCenterPositionX!==i||this._initialCenterPositionY!==r){var a=e.type,o=Math.abs(this._initialCenterPositionX-i),s=Math.abs(this._initialCenterPositionY-r),l="mouse"===this._observedPointer||"wheel"===a||"mousewheel"===a||"scroll"===a?this._mouseRadiusThreshold:this._touchRadiusThreshold;return n.isCoordinateOutsideRadius(o,s,l)}}return!1}},_mouseRadiusThreshold:{value:2},_touchRadiusThreshold:{value:4},_addPointerDownListener:{value:function(){window.PointerEvent?this._element.addEventListener("pointerdown",this,!1):window.MSPointerEvent&&window.navigator.msPointerEnabled?this._element.addEventListener("MSPointerDown",this,!1):"mouse"===this._observedPointer?this._element.addEventListener("mousedown",this,!1):this._element.addEventListener("touchstart",this,!1)}},_removePointerDownListener:{value:function(){window.PointerEvent?this._element.removeEventListener("pointerdown",this,!1):window.MSPointerEvent&&window.navigator.msPointerEnabled?this._element.removeEventListener("MSPointerDown",this,!1):"mouse"===this._observedPointer?this._element.removeEventListener("mousedown",this,!1):this._element.removeEventListener("touchstart",this,!1)}},_addEventListeners:{value:function(){window.PointerEvent?(this.shawdowRoot&&(this.shawdowRoot.addEventListener("pointerup",this,!1),this.shawdowRoot.addEventListener("pointermove",this,!1),this.shawdowRoot.addEventListener("pointercancel",this,!1)),document.addEventListener("pointerup",this,!1),document.addEventListener("pointermove",this,!1),document.addEventListener("pointercancel",this,!1)):window.MSPointerEvent&&window.navigator.msPointerEnabled?(this.shawdowRoot&&(this.shawdowRoot.addEventListener("MSPointerUp",this,!1),this.shawdowRoot.addEventListener("MSPointerMove",this,!1),this.shawdowRoot.addEventListener("MSPointerCancel",this,!1)),document.addEventListener("MSPointerUp",this,!1),document.addEventListener("MSPointerMove",this,!1),document.addEventListener("MSPointerCancel",this,!1)):"mouse"===this._observedPointer?(this.shawdowRoot&&(this.shawdowRoot.addEventListener("mouseup",this,!1),this.shawdowRoot.addEventListener("mousemove",this,!1),this.shawdowRoot.addEventListener("dragstart",this,!1)),document.addEventListener("mouseup",this,!1),document.addEventListener("mousemove",this,!1),this._element.addEventListener("dragstart",this,!1)):(this.shawdowRoot&&(this.shawdowRoot.addEventListener("touchend",this,!1),this.shawdowRoot.addEventListener("touchcancel",this,!1),this.shawdowRoot.addEventListener("touchmove",this,!1)),document.addEventListener("touchend",this,!1),document.addEventListener("touchcancel",this,!1),document.addEventListener("touchmove",this,!1));var e="undefined"!=typeof window.onwheel||"undefined"!=typeof window.WheelEvent?"wheel":"mousewheel";this.shawdowRoot&&(this.shawdowRoot.addEventListener(e,this,!0),this.shawdowRoot.addEventListener("scroll",this,!0)),document.addEventListener(e,this,!0),document.addEventListener("scroll",this,!0)}},_removeEventListeners:{value:function(){window.PointerEvent?(this.shawdowRoot&&(this.shawdowRoot.removeEventListener("pointerup",this,!1),this.shawdowRoot.removeEventListener("pointermove",this,!1),this.shawdowRoot.removeEventListener("pointercancel",this,!1)),document.removeEventListener("pointerup",this,!1),document.removeEventListener("pointermove",this,!1),document.removeEventListener("pointercancel",this,!1)):window.MSPointerEvent&&window.navigator.msPointerEnabled?(this.shawdowRoot&&(this.shawdowRoot.removeEventListener("MSPointerUp",this,!1),this.shawdowRoot.removeEventListener("MSPointerMove",this,!1),this.shawdowRoot.removeEventListener("MSPointerCancel",this,!1)),document.removeEventListener("MSPointerUp",this,!1),document.removeEventListener("MSPointerMove",this,!1),document.removeEventListener("MSPointerCancel",this,!1)):"mouse"===this._observedPointer?(this.shawdowRoot&&(this.shawdowRoot.removeEventListener("mouseup",this,!1),this.shawdowRoot.removeEventListener("mousemove",this,!1),this.shawdowRoot.removeEventListener("dragstart",this,!1)),document.removeEventListener("mouseup",this,!1),document.removeEventListener("mousemove",this,!1),this._element.removeEventListener("dragstart",this,!1)):(this.shawdowRoot&&(this.shawdowRoot.removeEventListener("touchend",this,!1),this.shawdowRoot.removeEventListener("touchcancel",this,!1),this.shawdowRoot.removeEventListener("touchmove",this,!1)),document.removeEventListener("touchend",this,!1),document.removeEventListener("touchcancel",this,!1),document.removeEventListener("touchmove",this,!1));var e="undefined"!=typeof window.onwheel||"undefined"!=typeof window.WheelEvent?"wheel":"mousewheel";this.shawdowRoot&&(this.shawdowRoot.removeEventListener(e,this,!0),this.shawdowRoot.removeEventListener("scroll",this,!0)),document.removeEventListener(e,this,!0),document.removeEventListener("scroll",this,!0)}},_createPressEvent:{enumerable:!1,value:function(e,t){var i,r,n=t;return t||(t=document.createEvent("CustomEvent"),t.initCustomEvent(e,!0,!0,null)),i=new o,i.event=t,i.type=e,i.pointer=this._observedPointer,i.targetElement=t.target,t.changedTouches&&(r=this._changedTouchisObserved(t.changedTouches))!==!1&&(n=i.touch=t.changedTouches[r]),n&&(i.clientX=n.clientX,i.clientY=n.clientY,i.pageX=n.pageX,i.pageY=n.pageY),i}},_dispatchPressStart:{enumerable:!1,value:function(e){if(this._state=s.PRESSED,this.dispatchEvent(this._createPressEvent("pressStart",e)),this._shouldDispatchLongPress){var t=this;this._longPressTimeout=setTimeout(function(){t._dispatchLongPress(e.target)},this._longPressThreshold)}}},_dispatchPress:{enumerable:!1,value:function(e,t){this._shouldDispatchLongPress&&(clearTimeout(this._longPressTimeout),this._longPressTimeout=null);var i=this._createPressEvent("press",e);if(t&&(i.targetElement=t,this._needDispatchSafePress||e.defaultPrevented)){var r=this,n=document.defaultView.defaultEventManager,a=function(o){(t===o.target||n._couldEmulatedEventHaveWrongTarget(e.changedTouches[0],o,n._emulatedEventRadiusThreshold,n._emulatedEventTimestampThreshold))&&r._dispatchSafePress(i,a)};return window.nativeAddEventListener("mousedown",a,!0),void(a.timeoutID=setTimeout(function(){r._dispatchSafePress(i,a)},300))}this.dispatchEvent(i),this._state=s.UNPRESSED}},_dispatchSafePress:{value:function(e,t){clearTimeout(t.timeoutID),t.timeoutID=null,window.nativeRemoveEventListener("mousedown",t,!0),this.dispatchEvent(e),this._state=s.UNPRESSED}},_dispatchLongPress:{enumerable:!1,value:function(e){var t;this._shouldDispatchLongPress&&(t=this._createPressEvent("longPress"),t.targetElement=e,this.dispatchEvent(t),this._longPressTimeout=null)}},_dispatchPressCancel:{enumerable:!1,value:function(e){this._shouldDispatchLongPress&&(clearTimeout(this._longPressTimeout),this._longPressTimeout=null),this._state=s.CANCELLED,this.dispatchEvent(this._createPressEvent("pressCancel",e))}}},{UNPRESSED:{value:0},PRESSED:{value:1},CANCELLED:{value:2}});s.prototype.captureMSPointerDown=s.prototype.capturePointerdown,s.prototype.handleMSPointerUp=s.prototype.handlePointerup,s.prototype.handleMSPointerCancel=s.prototype.handlePointercancel,s.prototype.handleMSPointerMove=s.prototype._handleMove,s.prototype.handlePointermove=s.prototype._handleMove,s.prototype.handleTouchmove=s.prototype._handleMove,s.prototype.handleMousemove=s.prototype._handleMove,s.prototype.handleMousewheel=s.prototype.handleWheel,s.prototype.handleMSPointerDown=s.prototype._handlePointerDown,s.prototype.handlePointerdown=s.prototype._handlePointerDown,s.prototype.handleMousedown=s.prototype._handlePointerDown,s.prototype.handleTouchstart=s.prototype._handlePointerDown}}),montageDefine("b7b5e36","core/meta/object-descriptor",{dependencies:["../core","./derived-descriptor","./event-descriptor","./model","../promise","./property-descriptor","./validation-rule","../deprecate","../core","../core","../core","../core"],factory:function(e,t,i){var r=e("../core").Montage,n=e("./derived-descriptor").DerivedDescriptor,a=e("./event-descriptor").EventDescriptor,o=e("./model"),s=e("../promise").Promise,l=e("./property-descriptor").PropertyDescriptor,u=e("./validation-rule").PropertyValidationRule,c=e("../deprecate"),h={name:"default",customPrototype:!1},d=t.ObjectDescriptor=r.specialize({FileExtension:{value:".mjson"},constructor:{value:function(){this._eventDescriptors=[],this._propertyDescriptors=[],this.addRangeAtPathChangeListener("_propertyDescriptors",this,"_handlePropertyDescriptorsRangeChange"),this._propertyDescriptorGroups={},Object.defineProperty(this,"_propertyDescriptorsTable",{value:{},
writable:!1}),Object.defineProperty(this,"_eventPropertyDescriptorsTable",{value:{},writable:!1}),this.defineBinding("eventDescriptors",{"<-":"_eventDescriptors.concat(parent.eventDescriptors)"})}},initWithName:{value:function(e){return this._name=null!==e?e:"default",this.customPrototype=!1,this}},serializeSelf:{value:function(e){e.setProperty("name",this.name),this._model&&!this.model.isDefault&&e.setProperty("model",this._model,"reference"),this.objectDescriptorInstanceModule&&e.setProperty("objectDescriptorModule",this.objectDescriptorInstanceModule),this._parent&&e.setProperty("parent",this._parent),this._setPropertyWithDefaults(e,"customPrototype",this.customPrototype),this._propertyDescriptors.length>0&&e.setProperty("propertyDescriptors",this._propertyDescriptors),Object.getOwnPropertyNames(this._propertyDescriptorGroups).length>0&&e.setProperty("propertyDescriptorGroups",this._propertyDescriptorGroups),this._eventDescriptors.length>0&&e.setProperty("eventDescriptors",this._eventDescriptors),this._propertyValidationRules.length>0&&e.setProperty("propertyValidationRules",this._propertyValidationRules),"number"==typeof this.maxAge&&e.setProperty("maxAge",this.maxAge)}},deserializeSelf:{value:function(e){var t,i;t=e.getProperty("name"),void 0!==t&&(this._name=t),t=e.getProperty("model")||e.getProperty("binder"),t&&(this._model=t),t=e.getProperty("objectDescriptorModule")||e.getProperty("blueprintModule"),void 0!==t&&(this.objectDescriptorInstanceModule=t),i=e.getProperty("parent"),i&&(i.promise&&i.valueFromReference?(c.deprecationWarningOnce("parent reference via ObjectDescriptorReference","direct reference with object syntax"),this._parentReference=i):this._parent=i),this.customPrototype=this._getPropertyWithDefaults(e,"customPrototype"),t=e.getProperty("propertyDescriptors")||e.getProperty("propertyBlueprints"),t&&(this._propertyDescriptors=t),t=e.getProperty("propertyDescriptorGroups")||e.getProperty("propertyBlueprintGroups"),t&&(this._propertyDescriptorGroups=t),t=e.getProperty("eventDescriptors")||e.getProperty("eventBlueprints"),t&&(this._eventDescriptors=t),t=e.getProperty("propertyValidationRules"),t&&(this._propertyValidationRules=t),t=e.getProperty("maxAge"),t&&(this.maxAge=t)}},_setPropertyWithDefaults:{value:function(e,t,i){i!==h[t]&&e.setProperty(t,i)}},_getPropertyWithDefaults:{value:function(e,t){var i=e.getProperty(t);return i||this[t]||h[t]}},_name:{value:null},name:{get:function(){return this._name}},create:{value:function(e,t,i){var r;if("undefined"==typeof e||d.prototype.isPrototypeOf(e)){var n=Object.getPrototypeOf(d).create;return n.call(this,"undefined"==typeof e?this:e,t,i)}return r="function"==typeof e.specialize||t?e.specialize(t,i):new e,this.ObjectProperty.applyWithObjectDescriptor(r.prototype,this),this.customPrototype=!0,r}},newInstance:{value:function(){var e=this.newInstancePrototype();return e?new e:null}},newInstancePrototype:{value:function(){if(this.customPrototype)throw new Error("Already has customPrototype");var e=this.parent?this.parent.newInstancePrototype():r,t=e.specialize({init:{value:function(){return this}}});return this.ObjectProperty.applyWithObjectDescriptor(t.prototype,this),t?t:null}},ObjectProperty:{serializable:!1,enumerable:!0,get:function(){return this.model?this.model.ObjectProperty:o.Model.group.defaultObjectDescriptorObjectProperty}},objectDescriptorInstanceModule:{serializable:!1,value:null},identifier:{get:function(){return["objectDescriptor",(this.name||"unnamed").toLowerCase()].join("_")}},_model:{value:null},model:{serializable:!1,get:function(){return this._model||(this._model=o.Model.group.defaultModel,this._model.addObjectDescriptor(this)),this._model},set:function(e){this._model=e}},_parentReference:{value:null},_parent:{value:null},parent:{serializable:!1,get:function(){return this._parent},set:function(e){this._parent=e}},customPrototype:{value:!1},_propertyDescriptors:{value:null},_handlePropertyDescriptorsRangeChange:{value:function(e,t,i){var r,n;for(r=0,n=t.length;r<n;++r)t[r]._owner=null;for(r=0,n=e.length;r<n;++r)e[r]._owner=e[r]._owner||this}},propertyDescriptors:{get:function(){var e=[];return e=e.concat(this._propertyDescriptors),this.parent&&(e=e.concat(this.parent.propertyDescriptors)),e}},serializablePropertyDescriptors:{get:function(){return this.propertyDescriptors.filter(function(e){return e.serializable!==!1})}},_propertyDescriptorsTable:{value:null},addPropertyDescriptor:{value:function(e){if(null!==e&&null!==e.name){var t=this._propertyDescriptors.indexOf(e);t<0&&(null!==e.owner&&e.owner!==this&&e.owner.removePropertyDescriptor(e),this._propertyDescriptors.push(e),this._propertyDescriptorsTable[e.name]=e,e._owner=this)}return e}},removePropertyDescriptor:{value:function(e){if(null!==e&&null!==e.name){var t=this._propertyDescriptors.indexOf(e);t>=0&&(this._propertyDescriptors.splice(t,1),delete this._propertyDescriptorsTable[e.name],e._owner=null)}return e}},newPropertyDescriptor:{value:function(e,t){return(new l).initWithNameObjectDescriptorAndCardinality(e,this,t)}},addToOnePropertyDescriptorNamed:{value:function(e){return this.addPropertyDescriptor(this.newPropertyDescriptor(e,1))}},addToManyPropertyDescriptorNamed:{value:function(e){return this.addPropertyDescriptor(this.newPropertyDescriptor(e,1/0))}},addToOneAssociationBlueprintNamed:{value:function(e,t){var i=this.addPropertyDescriptor(this.addToOnePropertyDescriptorNamed(e));return t&&(i.valueDescriptor=t.owner,t.valueDescriptor=this),i}},addToManyAssociationBlueprintNamed:{value:function(e,t){var i=this.addPropertyDescriptor(this.addToManyPropertyDescriptorNamed(e));return t&&(i.valueDescriptor=t.owner,t.valueDescriptor=this),i}},propertyDescriptorForName:{value:function(e){var i=this._propertyDescriptorsTable[e];if(void 0===i){i=t.UnknownPropertyDescriptor;var r,n;for(n=0;"undefined"!=typeof(r=this._propertyDescriptors[n]);n++)if(r.name===e){i=r;break}this._propertyDescriptorsTable[e]=i}return i===t.UnknownPropertyDescriptor&&(i=null),!i&&this.parent&&(i=this.parent.propertyDescriptorForName(e)),i}},_propertyDescriptorGroups:{value:null},propertyDescriptorGroups:{get:function(){var e,t=[];for(e in this._propertyDescriptorGroups)this._propertyDescriptorGroups.hasOwnProperty(e)&&t.push(e);return this.parent&&(t=t.concat(this.parent.propertyDescriptorGroups)),t}},propertyDescriptorGroupForName:{value:function(e){var t=this._propertyDescriptorGroups[e];return!t&&this.parent&&(t=this.parent.propertyDescriptorGroupForName(e)),t}},addPropertyDescriptorGroupNamed:{value:function(e){var t=this._propertyDescriptorGroups[e];return t||(t=[],this._propertyDescriptorGroups[e]=t),t}},removePropertyDescriptorGroupNamed:{value:function(e){var t=this._propertyDescriptorGroups[e];return t||delete this._propertyDescriptorGroups[e],t}},addPropertyDescriptorToGroupNamed:{value:function(e,t){var i,r=this._propertyDescriptorGroups[t];return r||(r=this.addPropertyDescriptorGroupNamed(t)),i=r.indexOf(e),i<0&&r.push(e),r}},removePropertyDescriptorFromGroupNamed:{value:function(e,t){var i=this._propertyDescriptorGroups[t];if(i&&e){var r=i.indexOf(e);r>=0&&i.splice(r,1)}return i||[]}},_eventDescriptors:{value:null},eventDescriptors:{value:null},_eventPropertyDescriptorsTable:{value:null},addEventDescriptor:{value:function(e){if(e&&e.name){var t=this._eventDescriptors.indexOf(e);t<0&&(e.owner&&e.owner!==this&&e.owner.removeEventDescriptor(e),this._eventDescriptors.push(e),this._eventPropertyDescriptorsTable[e.name]=e,e._owner=this)}return e}},removeEventDescriptor:{value:function(e){if(e&&e.name){var t=this._eventDescriptors.indexOf(e);t>=0&&(this._eventDescriptors.splice(t,1),delete this._eventPropertyDescriptorsTable[e.name],e._owner=null)}return e}},newEventDescriptor:{value:function(e){return(new a).initWithNameAndObjectDescriptor(e,this)}},addEventDescriptorNamed:{value:function(e){return this.addEventDescriptor(this.newEventDescriptor(e))}},eventDescriptorForName:{value:function(e){var i=this._eventPropertyDescriptorsTable[e];if("undefined"==typeof i){i=t.UnknownEventDescriptor;var r,n;for(n=0;"undefined"!=typeof(r=this._eventDescriptors[n]);n++)if(r.name===e){i=r;break}this._eventPropertyDescriptorsTable[e]=i}return i===t.UnknownEventDescriptor&&(i=null),!i&&this.parent&&(i=this.parent.eventDescriptorForName(e)),i}},_propertyValidationRules:{value:{}},propertyValidationRules:{get:function(){var e,t=[];for(e in this._propertyValidationRules)this._propertyValidationRules.hasOwnProperty(e)&&t.push(this._propertyValidationRules[e]);return this.parent&&(t=t.concat(this.parent.propertyValidationRules)),t}},propertyValidationRuleForName:{value:function(e){var t=this._propertyValidationRules[e];return!t&&this.parent&&(t=this.parent.propertyValidationRuleForName(e)),t}},addPropertyValidationRule:{value:function(e){var t=this._propertyValidationRules[e];return t||(t=(new u).initWithNameAndObjectDescriptor(e,this),this._propertyValidationRules[e]=t),t}},removePropertyValidationRule:{value:function(e){var t=this._propertyValidationRules[e];return t&&delete this._propertyValidationRules[e],t}},evaluateRules:{value:function(e){var t,i,r=[];for(t in this._propertyValidationRules)this._propertyValidationRules.hasOwnProperty(t)&&(i=this._propertyValidationRules[t],i.evaluateRule(e)&&r.push(i.messageKey));return r}},objectDescriptorModuleId:e("../core")._objectDescriptorModuleIdDescriptor,objectDescriptor:e("../core")._objectDescriptorDescriptor,addEventBlueprint:{value:c.deprecateMethod(void 0,function(e){return this.addEventDescriptor(e)},"addEventBlueprint","addEventDescriptor")},addEventBlueprintNamed:{value:c.deprecateMethod(void 0,function(e){return this.addEventDescriptorNamed(e)},"addEventBlueprintNamed","addEventDescriptorNamed")},addPropertyBlueprint:{value:c.deprecateMethod(void 0,function(e){this.addPropertyDescriptor(e)},"addPropertyBlueprint","addPropertyDescriptor")},addPropertyBlueprintGroupNamed:{value:c.deprecateMethod(void 0,function(e){this.addPropertyDescriptorGroupNamed(e)},"addPropertyBlueprintGroupNamed","addPropertyDescriptorGroupNamed")},addPropertyBlueprintToGroupNamed:{value:c.deprecateMethod(void 0,function(e,t){this.addPropertyDescriptorToGroupNamed(e,t)},"addPropertyBlueprintToGroupNamed","addPropertyDescriptorToGroupNamed")},addToOnePropertyBlueprintNamed:{value:c.deprecateMethod(void 0,function(e){return this.addToOnePropertyDescriptorNamed(e)},"addToOnePropertyBlueprintNamed","addToOnePropertyDescriptorNamed")},addToManyPropertyBlueprintNamed:{value:c.deprecateMethod(void 0,function(e){return this.addToManyPropertyDescriptorNamed(e)},"addToManyPropertyBlueprintNamed","addToManyPropertyDescriptorNamed")},blueprintInstanceModule:{serializable:!1,get:c.deprecateMethod(void 0,function(){return this.objectDescriptorInstanceModule},"blueprintInstanceModule.get","objectDescriptorInstanceModule.get"),set:c.deprecateMethod(void 0,function(e){this.objectDescriptorInstanceModule=e},"blueprintInstanceModule.set","objectDescriptorInstanceModule.set")},binder:{serializable:!1,get:c.deprecateMethod(void 0,function(){return this.model},"binder.get","model.get"),set:c.deprecateMethod(void 0,function(e){this.model=e},"binder.set","model.set")},eventBlueprintForName:{value:c.deprecateMethod(void 0,function(e){return this.eventDescriptorForName(e)},"eventBlueprintForName","eventDescriptorForName")},eventBlueprints:{get:c.deprecateMethod(void 0,function(){return this.eventDescriptors},"eventBlueprints.get","eventDescriptors.get"),set:c.deprecateMethod(void 0,function(e){this.eventDescriptors=e},"eventBlueprints.set","eventDescriptors.set")},newAssociationBlueprint:{value:function(e,t){return 1===t?this.addToOnePropertyDescriptorNamed(e):this.addToManyPropertyDescriptorNamed(e)}},newDerivedPropertyBlueprint:{value:c.deprecateMethod(void 0,function(e,t){return this.newDerivedDescriptor(e,t)},"newDerivedPropertyBlueprint","newDerivedDescriptor")},newDerivedDescriptor:{value:function(e,t){return(new n).initWithNameObjectDescriptorAndCardinality(e,this,t)}},newEventBlueprint:{value:c.deprecateMethod(void 0,function(e){return this.newEventDescriptor(e)},"newEventBlueprint","newEventDescriptor")},newPropertyBlueprint:{value:c.deprecateMethod(void 0,function(e,t){return this.newPropertyDescriptor(e,t)},"newPropertyBlueprint","newPropertyDescriptor")},propertyBlueprintForName:{value:c.deprecateMethod(void 0,function(e){return this.propertyDescriptorForName(e)},"propertyBlueprintForName","propertyDescriptorForName")},propertyBlueprintGroups:{get:c.deprecateMethod(void 0,function(){return this.propertyDescriptorGroups},"propertyBlueprintGroups","propertyDescriptorGroups")},propertyBlueprintGroupForName:{value:c.deprecateMethod(void 0,function(e){return this.propertyDescriptorGroupForName(e)},"propertyBlueprintGroupForName","propertyDescriptorForName")},propertyBlueprints:{get:c.deprecateMethod(void 0,function(){return this.propertyDescriptors},"propertyBlueprints","propertyDescriptors")},removeEventBlueprint:{value:c.deprecateMethod(void 0,function(e){this.removeEventDescriptor(e)},"removeEventBlueprint","removeEventDescriptor")},removePropertyBlueprint:{value:c.deprecateMethod(void 0,function(e){this.removePropertyDescriptor(e)},"removePropertyBlueprint","removePropertyDescriptor")},removePropertyBlueprintFromGroupNamed:{value:c.deprecateMethod(void 0,function(e,t){this.removePropertyDescriptorFromGroupNamed(e,t)},"removePropertyBlueprintFromGroupNamed","removePropertyDescriptorGroupNamed")},removePropertyBlueprintGroupNamed:{value:c.deprecateMethod(void 0,function(e){this.removePropertyDescriptorGroupNamed(e)},"removePropertyBlueprintGroupNamed","removePropertyDescriptorGroupNamed")},maxAge:{value:240},blueprintModuleId:e("../core")._objectDescriptorModuleIdDescriptor,blueprint:e("../core")._objectDescriptorDescriptor},{createDefaultBlueprintForObject:{value:c.deprecateMethod(void 0,function(e){return d.createDefaultObjectDescriptorForObject(e)},"Blueprint.createDefaultBlueprintForObject","ObjectDescriptor.createDefaultObjectDescriptorForObject")},createDefaultObjectDescriptorForObject:{value:function(e){if(e){var i=r.getInfoForObject(e).isInstance?Object.getPrototypeOf(e):e.prototype,n=r.getInfoForObject(i),a=new this;for(var o in i)if("_"!==o[0]&&i.hasOwnProperty(o)){var l,u=i[o];l=Array.isArray(u)?a.addToManyPropertyDescriptorNamed(o):a.addToOnePropertyDescriptorNamed(o),a.addPropertyDescriptorGroupNamed(l,n.objectName)}var c=Object.getPrototypeOf(i);return c&&"objectDescriptor"in c?c.objectDescriptor.then(function(e){return a.parent=e,a}):s.resolve(a)}return s.resolve(t.UnknownObjectDescriptor)}}});t.UnknownObjectDescriptor=Object.freeze((new d).initWithName("Unknown")),t.UnknownPropertyDescriptor=Object.freeze((new l).initWithNameObjectDescriptorAndCardinality("Unknown",null,1)),t.UnknownEventDescriptor=Object.freeze((new a).initWithNameAndObjectDescriptor("Unknown",null))}}),montageDefine("b7b5e36","core/serialization/serialization",{dependencies:["../core","./serializer/montage-labeler","./deserializer/montage-reviver","frb/parse","frb/stringify"],factory:function(e,t,i){var r=e("../core").Montage,n=e("./serializer/montage-labeler").MontageLabeler,a=e("./deserializer/montage-reviver").MontageReviver,o=e("frb/parse"),s=e("frb/stringify"),l=r.specialize({_serializationString:{value:null},_serializationObject:{value:null},_serializationLabels:{value:null},initWithString:{value:function(e){return this._serializationString=e,this._serializationObject=null,this._serializationLabels=null,this}},initWithObject:{value:function(e){return this._serializationString=null,this._serializationObject=e,this._serializationLabels=null,this}},clone:{value:function(){var e=new l;return e.initWithString(this.getSerializationString()),e}},getSerializationObject:{value:function(){return this._serializationObject||(this._serializationObject=JSON.parse(this._serializationString)),this._serializationObject}},getSerializationString:{value:function(){return this._serializationString||(this._serializationString=JSON.stringify(this._serializationObject)),this._serializationString}},getSerializationLabels:{value:function(){var e;return this._serializationLabels||(e=this.getSerializationObject())&&(this._serializationLabels=Object.keys(e)),this._serializationLabels}},getExternalObjectLabels:{value:function(){var e=this.getSerializationObject(),t=[];for(var i in e)0===Object.keys(e[i]).length&&t.push(i);return t}},hasSerializationLabel:{value:function(e){return e in this.getSerializationObject()}},isExternalObject:{value:function(e){var t=this.getSerializationObject();return!!(t&&e in t)&&0===Object.keys(t[e]).length}},isAlias:{value:function(e){var t=this.getSerializationObject();return!!(t&&e in t)&&"alias"in t[e]}},getElementId:{value:function(e){var t=this.getSerializationObject(),i=r.getPath.call(t,e+".values.element");if(i||(i=r.getPath.call(t,e+".properties.element")),i)return i["#"]}},getSerializationLabelsWithElements:{value:function(e){var i=new t.SerializationInspector,r=[];return i.initWithSerialization(this),i.visitSerialization(function(t){"Element"===t.type&&e.indexOf(t.data)>=0&&(t=t.parent,!t||"values"!==t.name&&"properties"!==t.name||(t=t.parent,t&&"montageObject"===t.type&&r.push(t.label)))}),r}},renameElementReferences:{value:function(e){var i=new t.SerializationInspector;i.initWithSerialization(this),i.visitSerialization(function(t){"Element"===t.type&&t.data in e&&(t.data=e[t.data])})}},renameSerializationLabels:{value:function(e){var i=new t.SerializationInspector;i.initWithSerialization(this),i.visitSerialization(function(t){if(t.label){var i=t.label;i in e&&(t.label=e[i])}if("reference"===t.type){var r=t.data;r in e&&(t.data=e[r])}})}},mergeSerialization:{value:function(e,i){return t.SerializationMerger.mergeSerializations(this,e,i)}},extractSerialization:{value:function(e,i){var r=new t.SerializationExtractor;return r.initWithSerialization(this),r.extractSerialization(e,i)}}}),u=r.specialize(null,{mergeSerializations:{value:function(e,t,i){var r,n,a,o,s,l,u={};a=e.getSerializationLabels(),o=t.getSerializationLabels(),s=this._createCollisionTable(a,o,u,i&&i.labeler),i&&i.willMergeObjectWithLabel&&(l=this._willMergeObjectWithLabel(i,e,t,u),s=s||l),s&&(t=t.clone(),t.renameSerializationLabels(u),o=t.getSerializationLabels()),r=e.getSerializationObject(),n=t.getSerializationObject();for(var c,h=0;c=o[h];h++)a.indexOf(c)===-1&&(r[c]=n[c]);return e.initWithObject(r),u}},_willMergeObjectWithLabel:{value:function(e,t,i,r){var n,a,o,s,l,u=!1,c=i.getSerializationLabels();r&&(o=[],Object.keys(r).forEach(function(e){o.push(r[e])}));for(var h,d=0;h=c[d];d++)if(a=r&&r[h],n=e.willMergeObjectWithLabel(h,a),"string"==typeof n){if(s=this._isLabelValidInSerialization(n,t),s||(l=!this._isLabelValidInSerialization(n,i)&&o.indexOf(n)===-1),!s&&!l)throw new Error("willMergeObjectWithLabel either needs to return a label that exists in the destination serialization to indicate it's the same object or return a completely new label to rename the object being merged. \""+n+'"  destination: '+t.getSerializationString()+"\n source: "+i.getSerializationString()+"\n collision table: "+JSON.stringify(r,null,4));u=!0,r[h]=n}return u}},_isLabelValidInSerialization:{value:function(e,t){var i,r;return!!t.hasSerializationLabel(e)||(r=e.indexOf(":"),!!(r>0&&(i=e.slice(0,r),t.hasSerializationLabel(i))))}},_createCollisionTable:{value:function(e,t,i,r){r=r||new n;var a,o,s,l,u,c=!1,h=Object.create(null);for(u=0;u<e.length;u++)s=e[u],l=s.indexOf(":"),l>0&&(a=s.slice(0,l),r.addLabel(a),h[a]=1),r.addLabel(s),h[s]=1;for(u=0;s=t[u];u++)l=s.indexOf(":"),l>0?(a=s.slice(0,l),o=i[a],o?(i[s]=o+":"+s.slice(l+1),c=!0):a in h?(o=r.generateLabel(r.getLabelBaseName(a)),t.indexOf(a)>=0&&(i[a]=o),i[s]=o+s.slice(l),c=!0):r.addLabel(a)):s in h&&!(s in i)?(i[s]=r.generateLabel(r.getLabelBaseName(s)),c=!0):r.addLabel(s);return c}}}),c=r.specialize({initWithSerialization:{value:function(e){this._serialization=e}},visitSerialization:{value:function(e){var t=this._serialization.getSerializationObject();this._walkRootObjects(e,t),this._serialization.initWithObject(t)}},visitSerializationObject:{value:function(e,t){var i=this._serialization.getSerializationObject();if(!(e in i))throw new Error('Object "'+e+'" does not exist in '+this._serialization.getSerializationString());this._walkRootObject(t,i,e),this._serialization.initWithObject(i)}},changeLabel:{value:function(e,t){var i,r=this._serialization.getSerializationObject();i=r[e],delete r[e],r[t]=i}},_walkRootObjects:{value:function(e,t){for(var i in t)this._walkRootObject(e,t,i)}},_walkRootObject:{value:function(e,t,i){var r=t[i];"value"in r?this._walkObject(e,r,"value",i):this._walkCustomObject(e,t,i)}},_walkObject:{value:function(e,t,i,r,n){var o,s=t[i],l=a.getTypeOf(s);if(o={type:l},r?o.label=r:o.name=i,n&&(o.parent=n),"number"===l||"string"===l||"null"===l)o.data=s,e(o),t[i]=o.data;else if("regexp"===l)o.data=s["/"],e(o),s["/"]=o.data;else if("reference"===l)o.data=s["@"],e(o),s["@"]=o.data;else if("Element"===l)o.data=s["#"],e(o),s["#"]=o.data;else if("array"===l){o.data=s,e(o),t[i]=s=o.data;for(var u=0,c=s.length;u<c;u++)this._walkObject(e,s,""+u,null,o)}else if("binding"===l)this._walkBinding(e,t,i,o);else if("object"===l){o.data=s,e(o),t[i]=s=o.data;for(var h in s)this._walkObject(e,s,h,null,o)}null!==r&&void 0!==r&&r!==o&&o.label!==r&&this.changeLabel(r,o.label)}},_walkCustomObject:{value:function(e,t,i){var r,n=t[i];r={type:"montageObject",label:i,data:n},e(r),t[i]=n=r.data,r.label!==i&&this.changeLabel(i,r.label),n.values?this._walkObject(e,n,"values",null,r):n.properties&&this._walkObject(e,n,"properties",null,r),n.bindings&&this._walkBindings(e,n,null,r),n.listeners&&this._walkObject(e,n,"listeners",null,r),n.localizations&&this._walkLocalizations(e,n,null,r)}},_walkBindings:{value:function(e,t,i){var r,n=t.bindings;r={type:"bindings",data:n,parent:i},e(r),t.bindings=n=r.data;for(var a in n)this._walkBinding(e,n,a,r)}},_walkBinding:{value:function(e,t,i,r){var n,a=t[i];n={type:"binding",name:i,data:a,parent:r},e(n),t[i]=a=n.data,this._walkBindingData(e,a,n)}},_walkBindingData:{value:function(e,t,i){var r,n,a=!1;r=t["<-"]||t["<->"],n=Object.clone(o(r)),this._walksBindingReferences(n,function(t){var i={type:"reference",data:t.label};e(i),t.label!==i.data&&(t.label=i.data,a=!0)}),a&&("<-"in t?t["<-"]=s(n):t["<->"]=s(n)),t.converter&&this._walkObject(e,t,"converter",null,i)}},_walkLocalizations:{value:function(e,t,i){var r,n=t.localizations;r={type:"localizations",data:n,parent:i},e(r),t.localizations=n=r.data;for(var a in n)this._walkLocalization(e,n,a,r)}},_walkLocalization:{value:function(e,t,i,r){var n,a,o=t[i];if(n={type:"localization",name:i,data:o,parent:r},e(n),t[i]=o=n.data,"object"==typeof o.key&&this._walkBindingData(e,o.key,n),"object"==typeof o["default"]&&this._walkBindingData(e,o["default"],n),"object"==typeof o.data){a=o.data;for(var s in a)this._walkBindingData(e,a[s],n)}}},_walksBindingReferences:{value:function(e,t){var i=e.args;if("component"===e.type&&t(e),i)for(var r=0,n=i.length;r<n;r++)this._walksBindingReferences(i[r],t)}}}),h=r.specialize({_serialization:{value:null},initWithSerialization:{value:function(e){this._serialization=e}},extractSerialization:{value:function(e,i){var r,n,a,o=new t.SerializationInspector,s={},u=[];for(a=this._serialization.getSerializationObject(),o.initWithSerialization(this._serialization),r=0,n;n=e[r];r++)s[n]=a[n],o.visitSerializationObject(n,function(t){var i;"reference"===t.type&&(i=t.data,u.indexOf(i)===-1&&e.indexOf(i)===-1&&u.push(i))});if(i)for(r=0,n;n=i[r];r++)n in a&&!(n in s)&&(s[n]={});for(r=0,n;n=u[r];r++)s[n]={};return(new l).initWithObject(s)}}});t.Serialization=l,t.SerializationMerger=u,t.SerializationInspector=c,t.SerializationExtractor=h}}),montageDefine("b7b5e36","core/mini-url",{dependencies:[],factory:function(e,t,i){"use strict";function r(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}function n(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function a(e,t,i,r){t=t||"&",i=i||"=";var a={};if("string"!=typeof e||0===e.length)return a;var o=/\+/g;e=e.split(t);var s=1e3;r&&"number"==typeof r.maxKeys&&(s=r.maxKeys);var l=e.length;s>0&&l>s&&(l=s);for(var u=0;u<l;++u){var c,h,d,p,m=e[u].replace(o,"%20"),v=m.indexOf(i);v>=0?(c=m.substr(0,v),h=m.substr(v+1)):(c=m,h=""),d=decodeURIComponent(c),p=decodeURIComponent(h),n(a,d)?Array.isArray(a[d])?a[d].push(p):a[d]=[a[d],p]:a[d]=p}return a}function o(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}}function s(e,t,i,r){return t=t||"&",i=i||"=",null===e&&(e=void 0),"object"==typeof e?Object.keys(e).map(function(r){var n=encodeURIComponent(o(r))+i;return Array.isArray(e[r])?e[r].map(function(e){return n+encodeURIComponent(o(e))}).join(t):n+encodeURIComponent(o(e[r]))}).join(t):void 0===r||null===r?"":encodeURIComponent(o(r))+i+encodeURIComponent(o(e))}function l(e){return null===e}function u(e){return null===e||void 0===e}function c(e){return"string"==typeof e}function h(e){return"object"==typeof e}function d(e,t,i){if(e&&h(e)&&e instanceof r)return e;var n=new r;return n.parse(e,t,i),n}var p=/^([a-z0-9.+-]+:)/i,m=/:[0-9]*$/,v=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,f=["<",">",'"',"`"," ","\r","\n","\t"],_=["{","}","|","\\","^","`"].concat(f),g=["'"].concat(_),b=["%","/","?",";","#"].concat(g),y=["/","?","#"],D=255,w=/^[+a-z0-9A-Z_-]{0,63}$/,P=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,T={javascript:!0,"javascript:":!0},O={javascript:!0,"javascript:":!0},E={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0};r.prototype.parse=function(e,t,i){if(!c(e))throw new TypeError("Parameter 'url' must be a string, not "+typeof e);var r=e.indexOf("?"),n=r!==-1&&r<e.indexOf("#")?"?":"#",o=e.split(n),s=/\\/g;o[0]=o[0].replace(s,"/"),e=o.join(n);var l=e;if(l=l.trim(),!i&&1===e.split("#").length){var u=v.exec(l);if(u)return this.path=l,this.href=l,this.pathname=u[1],u[2]?(this.search=u[2],t?this.query=a(this.search.substr(1)):this.query=this.search.substr(1)):t&&(this.search="",this.query={}),this}var h,d=p.exec(l);d&&(d=d[0],h=d.toLowerCase(),this.protocol=h,l=l.substr(d.length));var m;(i||d||l.match(/^\/\/[^@\/]+@[^@\/]+/))&&(m="//"===l.substr(0,2),!m||d&&O[d]||(l=l.substr(2),this.slashes=!0));var f,_,S,C;if(!O[d]&&(m||d&&!E[d])){var j=-1;for(f=0;f<y.length;f++)C=l.indexOf(y[f]),C!==-1&&(j===-1||C<j)&&(j=C);var M,A;for(A=j===-1?l.lastIndexOf("@"):l.lastIndexOf("@",j),A!==-1&&(M=l.slice(0,A),l=l.slice(A+1),this.auth=decodeURIComponent(M)),j=-1,f=0;f<b.length;f++)C=l.indexOf(b[f]),C!==-1&&(j===-1||C<j)&&(j=C);j===-1&&(j=l.length),this.host=l.slice(0,j),l=l.slice(j),this.parseHost(),this.hostname=this.hostname||"";var x="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!x){var L=this.hostname.split(/\./);for(f=0,_=L.length;f<_;f++){var z=L[f];if(z&&!z.match(w)){for(var N="",I=0,F=z.length;I<F;I++)N+=z.charCodeAt(I)>127?"x":z[I];if(!N.match(w)){var R=L.slice(0,f),B=L.slice(f+1),k=z.match(P);k&&(R.push(k[1]),B.unshift(k[2])),B.length&&(l="/"+B.join(".")+l),this.hostname=R.join(".");break}}}}this.hostname.length>D?this.hostname="":this.hostname=this.hostname.toLowerCase(),S=this.port?":"+this.port:"";var W=this.hostname||"";this.host=W+S,this.href+=this.host,x&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==l[0]&&(l="/"+l))}if(!T[h])for(f=0,_=g.length;f<_;f++){var U=g[f];if(l.indexOf(U)!==-1){var Y=encodeURIComponent(U);Y===U&&(Y=escape(U)),l=l.split(U).join(Y)}}var V=l.indexOf("#");V!==-1&&(this.hash=l.substr(V),l=l.slice(0,V));var q=l.indexOf("?");if(q!==-1?(this.search=l.substr(q),this.query=l.substr(q+1),t&&(this.query=a(this.query)),l=l.slice(0,q)):t&&(this.search="",this.query={}),l&&(this.pathname=l),E[h]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){S=this.pathname||"";var G=this.search||"";this.path=S+G}return this.href=this.format(),this},r.prototype.format=function(){var e=this.auth||"";e&&(e=encodeURIComponent(e),e=e.replace(/%3A/i,":"),e+="@");var t=this.protocol||"",i=this.pathname||"",r=this.hash||"",n=!1,a="";this.host?n=e+this.host:this.hostname&&(n=e+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]"),this.port&&(n+=":"+this.port)),this.query&&h(this.query)&&Object.keys(this.query).length&&(a=s(this.query));var o=this.search||a&&"?"+a||"";return t&&":"!==t.substr(-1)&&(t+=":"),this.slashes||(!t||E[t])&&n!==!1?(n="//"+(n||""),i&&"/"!==i.charAt(0)&&(i="/"+i)):n||(n=""),r&&"#"!==r.charAt(0)&&(r="#"+r),o&&"?"!==o.charAt(0)&&(o="?"+o),i=i.replace(/[?#]/g,function(e){return encodeURIComponent(e)}),o=o.replace("#","%23"),t+n+i+o+r},r.prototype.resolve=function(e){return this.resolveObject(d(e,!1,!0)).format()},r.prototype.resolveObject=function(e){if(c(e)){var t=new r;t.parse(e,!1,!0),e=t}for(var i=new r,n=Object.keys(this),a=0;a<n.length;a++){var o=n[a];i[o]=this[o]}if(i.hash=e.hash,""===e.href)return i.href=i.format(),i;if(e.slashes&&!e.protocol){for(var s=Object.keys(e),h=0;h<s.length;h++){var d=s[h];"protocol"!==d&&(i[d]=e[d])}return E[i.protocol]&&i.hostname&&!i.pathname&&(i.path=i.pathname="/"),i.href=i.format(),i}var p,m;if(e.protocol&&e.protocol!==i.protocol){if(!E[e.protocol]){for(var v=Object.keys(e),f=0;f<v.length;f++){var _=v[f];i[_]=e[_]}return i.href=i.format(),i}if(i.protocol=e.protocol,e.host||O[e.protocol])i.pathname=e.pathname;else{p=(e.pathname||"").split("/");do e.host=p.shift();while(!e.host&&p.length);e.host||(e.host=""),e.hostname||(e.hostname=""),""!==p[0]&&p.unshift(""),p.length<2&&p.unshift(""),i.pathname=p.join("/")}if(i.search=e.search,i.query=e.query,i.host=e.host||"",i.auth=e.auth,i.hostname=e.hostname||e.host,i.port=e.port,i.pathname||i.search){var g=i.pathname||"",b=i.search||"";i.path=g+b}return i.slashes=i.slashes||e.slashes,i.href=i.format(),i}var y=i.pathname&&"/"===i.pathname.charAt(0),D=e.host||e.pathname&&"/"===e.pathname.charAt(0),w=D||y||i.host&&e.pathname,P=w,T=i.protocol&&!E[i.protocol];m=i.pathname&&i.pathname.split("/")||[],p=e.pathname&&e.pathname.split("/")||[],T&&(i.hostname="",i.port=null,i.host&&(""===m[0]?m[0]=i.host:m.unshift(i.host)),i.host="",e.protocol&&(e.hostname=null,e.port=null,e.host&&(""===p[0]?p[0]=e.host:p.unshift(e.host)),e.host=null),w=w&&(""===p[0]||""===m[0]));var S;if(D)i.host=e.host||""===e.host?e.host:i.host,i.hostname=e.hostname||""===e.hostname?e.hostname:i.hostname,i.search=e.search,i.query=e.query,m=p;else if(p.length)m||(m=[]),m.pop(),m=m.concat(p),i.search=e.search,i.query=e.query;else if(!u(e.search))return T&&(i.hostname=i.host=m.shift(),S=!!(i.host&&i.host.indexOf("@")>0)&&i.host.split("@"),S&&(i.auth=S.shift(),i.host=i.hostname=S.shift())),i.search=e.search,i.query=e.query,l(i.pathname)&&l(i.search)||(i.path=(i.pathname?i.pathname:"")+(i.search?i.search:"")),i.href=i.format(),i;if(!m.length)return i.pathname=null,i.search?i.path="/"+i.search:i.path=null,i.href=i.format(),i;for(var C=m.slice(-1)[0],j=(i.host||e.host||m.length>1)&&("."===C||".."===C)||""===C,M=0,A=m.length;A>=0;A--)C=m[A],"."===C?m.splice(A,1):".."===C?(m.splice(A,1),M++):M&&(m.splice(A,1),M--);if(!w&&!P)for(;M--;M)m.unshift("..");!w||""===m[0]||m[0]&&"/"===m[0].charAt(0)||m.unshift(""),j&&"/"!==m.join("/").substr(-1)&&m.push("");var x=""===m[0]||m[0]&&"/"===m[0].charAt(0);return T&&(i.hostname=i.host=x?"":m.length?m.shift():"",S=!!(i.host&&i.host.indexOf("@")>0)&&i.host.split("@"),S&&(i.auth=S.shift(),i.host=i.hostname=S.shift())),w=w||i.host&&m.length,w&&!x&&m.unshift(""),m.length?i.pathname=m.join("/"):(i.pathname=null,i.path=null),l(i.pathname)&&l(i.search)||(i.path=(i.pathname?i.pathname:"")+(i.search?i.search:"")),i.auth=e.auth||i.auth,i.slashes=i.slashes||e.slashes,i.href=i.format(),i},r.prototype.parseHost=function(){var e=this.host,t=m.exec(e);t&&(t=t[0],
":"!==t&&(this.port=t.substr(1)),e=e.substr(0,e.length-t.length)),e&&(this.hostname=e)},t.resolve=function(e,t){return d(e,!1,!0).resolve(t)}}}),montageDefine("b7b5e36","ui/base/abstract-slider",{dependencies:["./abstract-control","../../composer/translate-composer","../../composer/key-composer"],factory:function(e,t,i){var r=e("./abstract-control").AbstractControl,n=e("../../composer/translate-composer").TranslateComposer,a=e("../../composer/key-composer").KeyComposer;t.AbstractSlider=r.specialize({constructor:{value:function o(){if(this.constructor===o)throw new Error("AbstractSlider cannot be instantiated.");this._propertyNamesUsed={},this.addOwnPropertyChangeListener("_sliderMagnitude",this),this.addOwnPropertyChangeListener("_min",this),this.addOwnPropertyChangeListener("_max",this),this.addOwnPropertyChangeListener("_value",this),this.addOwnPropertyChangeListener("_step",this),this.addOwnPropertyChangeListener("axis",this),this.axis="horizontal",this.defineBinding("classList.has('montage--disabled')",{"<-":"!enabled"}),this.defineBinding("classList.has('montage-Slider--active')",{"<-":"active"})}},enterDocument:{value:function(e){if(e){this._translateComposer=new n,this._translateComposer.identifier="thumb",this._translateComposer.axis=this.axis,this._translateComposer.hasMomentum=!1,this.addComposerForElement(this._translateComposer,this._sliderThumbElement),"webkitTransform"in this.element.style?this._transform="webkitTransform":"MozTransform"in this.element.style?this._transform="MozTransform":"oTransform"in this.element.style?this._transform="oTransform":this._transform="transform";var t=this._propertyNamesUsed;t._min||(this.min=this.element.getAttribute("min")||this._min),t._max||(this.max=this.element.getAttribute("max")||this._max),t._step||(this.step=this.element.getAttribute("step")||this._step),t._value||(this.value=this.element.getAttribute("value")||this._value),delete this._propertyNamesUsed,this.element.setAttribute("role","slider"),this.element.tabIndex="-1",this._upKeyComposer=a.createKey(this,"up","increase"),this._downKeyComposer=a.createKey(this,"down","decrease"),this._rightKeyComposer=a.createKey(this,"right","increase"),this._leftKeyComposer=a.createKey(this,"left","decrease")}}},prepareForActivationEvents:{value:function(){this._translateComposer.addEventListener("translateStart",this,!1),this._translateComposer.addEventListener("translate",this,!1),this._translateComposer.addEventListener("translateEnd",this,!1),this._sliderThumbElement.addEventListener("touchstart",this,!1),document.addEventListener("touchend",this,!1),this._sliderThumbElement.addEventListener("mousedown",this,!1),document.addEventListener("mouseup",this,!1),this._upKeyComposer.addEventListener("keyPress",this,!1),this._downKeyComposer.addEventListener("keyPress",this,!1),this._leftKeyComposer.addEventListener("keyPress",this,!1),this._rightKeyComposer.addEventListener("keyPress",this,!1)}},willDraw:{value:function(){this._sliderMagnitude=this._calculateSliderMagnitude()}},_previousPercentage:{value:null},draw:{value:function(){"vertical"===this.axis?this._isUpdatingTranslate?(this._sliderThumbElement.style[this._transform]="translate3d(0,"+(this._previousPercentage-this._valuePercentage)*this._sliderMagnitude*.01+"px,0)",this._isUpdatingTranslate=!1):(this._sliderThumbElement.style.top=100-this._valuePercentage+"%",this._sliderThumbElement.style.left=0,this._sliderThumbElement.style[this._transform]="translate3d(0,0,0)",this._previousPercentage=this._valuePercentage):this._isUpdatingTranslate?(this._sliderThumbElement.style[this._transform]="translate3d("+(this._valuePercentage-this._previousPercentage)*this._sliderMagnitude*.01+"px,0,0)",this._isUpdatingTranslate=!1):(this._sliderThumbElement.style.left=this._valuePercentage+"%",this._sliderThumbElement.style.top=0,this._sliderThumbElement.style[this._transform]="translate3d(0,0,0)",this._previousPercentage=this._valuePercentage),this.element.setAttribute("aria-valuemax",this.max),this.element.setAttribute("aria-valuemin",this.min),this.element.setAttribute("aria-valuenow",this.value)}},acceptsActiveTarget:{value:!0},handleTouchstart:{value:function(e){this.active=!0,this.element.focus(),this._isUpdatingTranslate=!0}},handleTouchend:{value:function(e){this.active=!1}},handleMousedown:{value:function(e){this.active=!0,this.element.focus(),e.preventDefault(),this._isUpdatingTranslate=!0}},handleMouseup:{value:function(e){this.active=!1}},_isUpdatingTranslate:{value:!1},handleThumbTranslateStart:{value:function(e){"vertical"===this.axis?this._startTranslate=e.translateY:this._startTranslate=e.translateX,this._startValue=this.value}},handleThumbTranslate:{value:function(e){"vertical"===this.axis?this.value=this._startValue+(this._startTranslate-e.translateY)/this._sliderMagnitude*(this._max-this._min):this.value=this._startValue+(e.translateX-this._startTranslate)/this._sliderMagnitude*(this._max-this._min),this._isUpdatingTranslate=!0}},handleThumbTranslateEnd:{value:function(e){this.active=!1,this._isUpdatingTranslate=!1}},_increase:{value:function(){var e="number"==typeof this.min?this.min:0,t=this.value-e,i=this.step|(this.max-this.min)/100;t%i?t<0?t-=t%i:t+=i-t%i:t+=i,this.value=t+e}},_decrease:{value:function(){var e="number"==typeof this.min?this.min:0,t=this.value-e,i=this.step|(this.max-this.min)/100;t-=t%i?t>0?t%i:i+t%i:i,this.value=t+e}},handleKeyPress:{value:function(e){this.enabled&&("increase"===e.identifier?this._increase():"decrease"===e.identifier&&this._decrease())}},surrenderPointer:{value:function(e,t){return!1}},active:{value:!1},_min:{value:0},_max:{value:100},_step:{value:"any"},min:{get:function(){return this._min},set:function(e){isNaN(e=parseFloat(e))||this._min!==e&&(this._min=e)}},max:{get:function(){return this._max},set:function(e){isNaN(e=parseFloat(e))||this._max!==e&&(this._max=e)}},step:{get:function(){return this._step},set:function(e){!isNaN(e=parseFloat(e))&&e>=0&&this._step!==e&&(this._step=e)}},_value:{value:50},value:{get:function(){return this._value},set:function(e){isNaN(e=parseFloat(e))||(e>this._max?e=this._max:e<this._min&&(e=this._min),this._value!==e&&(this._value=e))}},enabled:{value:!0},axis:{value:null},_sliderThumbElement:{value:null},_translateComposer:{value:null},_transform:{value:null},_transition:{value:null},_sliderMagnitude:{value:null},_startTranslate:{value:null},_startValue:{value:null},_valuePercentage:{value:null},_calculateSliderMagnitude:{value:function(){var e=window.getComputedStyle(this._element);return"vertical"===this.axis?this._element.clientHeight-parseFloat(e.getPropertyValue("padding-top"))-parseFloat(e.getPropertyValue("padding-bottom")):this._element.clientWidth-parseFloat(e.getPropertyValue("padding-left"))-parseFloat(e.getPropertyValue("padding-right"))}},handleAxisChange:{value:function(){this._translateComposer&&(this._translateComposer.axis=this.axis),"vertical"===this.axis?(this.classList.add("montage-Slider--vertical"),this.classList.remove("montage-Slider--horizontal")):(this.classList.remove("montage-Slider--vertical"),this.classList.add("montage-Slider--horizontal"))}},_propertyRegex:{value:/_sliderMagnitude|_min|_max|_value|_step/},handlePropertyChange:{value:function(e,t,i){if(null!==t.match(this._propertyRegex)){if(this._propertyNamesUsed&&(this._propertyNamesUsed[t]=!0),this._value<=this._min)this._value=this._min;else{var r=this._value-this._min,n=r%this._step;if(n){var a=n>=.5*this._step&&this._value-n+this._step<=this._max;a?this._value=this._value-n+this._step:this._value=this._value-n}}this._value>this._max&&(this._value=this._max),this._valuePercentage=100*(this._value-this._min)/(this._max-this._min),this.needsDraw=!0}}}})}}),montageDefine("b7b5e36","data/service/raw-data-service",{dependencies:["data/service/data-service","data/service/data-mapping","data/model/data-identifier","core/serialization/deserializer/montage-deserializer","collections/map","montage","collections/weak-map","core/deprecate"],factory:function(e,t,i){var r=e("data/service/data-service").DataService,n=e("data/service/data-mapping").DataMapping,a=e("data/model/data-identifier").DataIdentifier,o=e("core/serialization/deserializer/montage-deserializer").MontageDeserializer,s=e("collections/map"),l=e("montage").Montage,u=e("collections/weak-map"),c=e("core/deprecate");t.RawDataService=r.specialize({constructor:{value:function(){r.call(this),this._typeIdentifierMap=new s}},initWithModel:{value:function(t){var i=this;return e.async(t).then(function(t){var i=(new o).init(JSON.stringify(t),e);return i.deserializeObject()}).then(function(e){return i.model=e,i})}},deserializeSelf:{value:function(e){this["super"](e)}},connectionDescriptor:{value:void 0},connection:{value:void 0},_propertyDescriptorForObjectAndName:{value:function(e,t){var i=this.objectDescriptorForObject(e);return i&&i.propertyDescriptorForName(t)}},_objectDescriptorForObject:{value:function(e){var t,i,r,n,a,o=this.types,s=l.getInfoForObject(e),u=s.moduleId,c=s.objectName;for(n=0,a=o.length;n<a&&!r;n+=1)t=o[n].module,i=t&&o[n].exportName,t&&u===t.id&&c===i&&(r=o[n]);return r}},_mapObjectPropertyValue:{value:function(e,t,i){var r=t.name;if(t.cardinality===1/0?this.spliceWithArray(e[r],i):e[r]=i[0],t.inversePropertyName&&i&&i[0]){var n=this._propertyDescriptorForObjectAndName(i[0],t.inversePropertyName);n&&1===n.cardinality&&i.forEach(function(i){i[t.inversePropertyName]=e})}return i}},_objectDescriptorTypeForValueDescriptor:{value:function(e){return e.then(function(e){return e.module.require.async(e.module.id)})}},_fetchRawData:{value:function(e){var t=this,i=this._childServiceForQuery(e.query),n=e.query;i?i._fetchRawData(e):n.authorization?(e.query=t.mapSelectorToRawDataQuery(n),t.fetchRawData(e),e.query=n):this.authorizationPolicy===r.AuthorizationPolicy.NONE?(e.query=t.mapSelectorToRawDataQuery(n),t.fetchRawData(e),e.query=n):r.authorizationManager.authorizeService(this).then(function(e){return t.authorization=e,e})["catch"](function(e){console.log(e)}).then(function(i){e.query=t.mapSelectorToRawDataQuery(n),t.fetchRawData(e),e.query=n})}},fetchRawData:{value:function(e){this.rawDataDone(e)}},cancelRawDataStream:{value:function(e,t){}},deleteDataObject:{value:function(e){var t={};return this._mapObjectToRawData(e,t),this.deleteRawData(t,e)}},deleteRawData:{value:function(e,t){return this.nullPromise}},saveRawData:{value:function(e,t){return this.nullPromise}},isOffline:{get:function(){return this===this.rootService?this.superForGet("isOffline")():this.rootService.isOffline}},writeOfflineData:{value:function(e,t,i){return this.nullPromise}},addRawData:{value:function(e,t,i){var r,n,a,o,s=e.query.type;for(r=t&&!this.isOffline&&this._streamRawData.get(e),r?r.push.apply(r,t):t&&!this.isOffline&&this._streamRawData.set(e,t.slice()),n=0,a=t&&t.length;n<a;n+=1)o=t[n],this.addOneRawData(e,o,i,s).then(function(t){e.addData([t])})}},addOneRawData:{value:function(e,t,i){var r,n=this.objectForTypeRawData(e.query.type,t,i);return r=this._mapRawDataToObject(t,n,i),r=r&&r instanceof Promise?r.then(function(){return n}):Promise.resolve(n),this._addMapDataPromiseForStream(r,e),n&&this.callDelegateMethod("rawDataServiceDidAddOneRawData",this,e,t,n),r}},_addMapDataPromiseForStream:{value:function(e,t){this._streamMapDataPromises.has(t)?this._streamMapDataPromises.get(t).push(e):this._streamMapDataPromises.set(t,[e])}},_streamMapDataPromises:{get:function(){return this.__streamMapDataPromises||(this.__streamMapDataPromises=new s),this.__streamMapDataPromises}},objectForTypeRawData:{value:function(e,t,i){var r=this.dataIdentifierForTypeRawData(e,t);return this.recordSnapshot(r,t),this.getDataObject(e,t,i,r)}},_typeIdentifierMap:{value:void 0},dataIdentifierForTypeRawData:{value:function(e,t){var i,r,n,o,l=this.mappingWithType(e),u=l?l.rawDataPrimaryKeys:null;if(u&&u.length){n=this._typeIdentifierMap.get(e),n||this._typeIdentifierMap.set(e,n=new s);for(var c,h=0;c=u[h];h++)i=i||[],i[h]=t[c];return i&&(o=i.join("/"),r=n.get(o)),r||(e.typeName||e.name,r=new a,r.objectDescriptor=e,r.dataService=this,r.typeName=e.name,r._identifier=r.primaryKey=o,n.set(o,r)),r}}},__snapshot:{value:null},_snapshot:{get:function(){return this.__snapshot||(this.__snapshot=new s)}},recordSnapshot:{value:function(e,t){this._snapshot.set(e,t)}},removeSnapshot:{value:function(e){this._snapshot["delete"](e)}},snapshotForDataIdentifier:{value:function(e){return this._snapshot.get(e)}},snapshotForObject:{value:function(e){return this.snapshotForDataIdentifier(this.dataIdentifierForObject(e))}},rawDataDone:{value:function(e,t){var i=this,r=this._streamRawData.get(e),n=this._streamMapDataPromises.get(e),a=n?Promise.all(n):this.nullPromise;n&&this._streamMapDataPromises["delete"](e),r&&this._streamRawData["delete"](e),a.then(function(n){return r?i.writeOfflineData(r,e.query,t):null}).then(function(){return e.dataDone(),null})["catch"](function(e){console.error(e)})}},_streamRawData:{get:function(){return this.__streamRawData||(this.__streamRawData=new u),this.__streamRawData}},__streamRawData:{value:void 0},mapSelectorToRawDataQuery:{value:function(e){return e}},mapSelectorToRawDataSelector:{value:c.deprecateMethod(void 0,function(e){return this.mapSelectorToRawDataQuery(e)},"mapSelectorToRawDataSelector","mapSelectorToRawDataQuery")},mappingForObject:{value:function(e){var t=this.objectDescriptorForObject(e),i=t&&this.mappingWithType(t);return!i&&t&&(i=this._objectDescriptorMappings.get(t),i||(i=n.withObjectDescriptor(t),this._objectDescriptorMappings.set(t,i))),i}},mapRawDataToObject:{value:function(e,t,i){}},_mapRawDataToObject:{value:function(e,t,i){var r,n=this,a=this.mappingForObject(t);return a?(r=a.mapRawDataToObject(e,t,i),r=r?r.then(function(){return n.mapRawDataToObject(e,t,i)}):this.mapRawDataToObject(e,t,i)):r=this.mapRawDataToObject(e,t,i),r}},mapObjectToRawData:{value:function(e,t,i){}},_mapObjectToRawData:{value:function(e,t,i){var r,n=this.mappingForObject(e);if(n&&(r=n.mapObjectToRawData(e,t,i)),t)if(r){var a=this.mapObjectToRawData(e,t,i);r instanceof Promise&&a instanceof Promise?r=Promise.all([r,a]):a instanceof Promise&&(r=a)}else r=this.mapObjectToRawData(e,t,i);return r}},_mappingsPromise:{get:function(){return this.__mappingsPromise||(this.__mappingsPromise=Promise.all(this.mappings.map(function(e){return e.objectDescriptor})).then(function(e){})),this.__mappingsPromise}},_objectDescriptorMappings:{get:function(){return this.__objectDescriptorMappings||(this.__objectDescriptorMappings=new s),this.__objectDescriptorMappings}},mapFromRawData:{value:function(e,t,i){}},mapToRawData:{value:function(e,t){}},offlineService:{value:void 0}})}}),montageDefine("b7b5e36","data/service/http-service",{dependencies:["data/service/raw-data-service","data/model/data-query","data/model/enumeration","collections/map","montage","frb/parse","frb/compile-evaluator","frb/evaluate","frb/scope","core/promise"],factory:function(e,t,i){var r=e("data/service/raw-data-service").RawDataService,n=e("data/model/data-query").DataQuery,a=e("data/model/enumeration").Enumeration,o=e("collections/map"),s=e("montage").Montage,l=e("frb/parse"),u=e("frb/compile-evaluator"),c=(e("frb/evaluate"),e("frb/scope")),h=e("core/promise").Promise,d=t.HttpError=s.specialize({constructor:{value:function(){this.stack=(new Error).stack}},isAuthorizationError:{get:function(){return this._isAuthorizationError||401===this.statusCode||403===this.statusCode},set:function(e){this._isAuthorizationError=e}},message:{get:function(){return this._message||(this._message="Status "+this.statusCode+" received for url: "+this.url),this._message}},name:{value:"HttpError"},url:{value:void 0},statusCode:{value:void 0}},{withMessage:{value:function(e){var t=new this;return t._message=e,t}},withRequestAndURL:{value:function(e,t){var i=new this;return i.statusCode=e.status,i.url=t,i}}});t.HttpService=r.specialize({FORM_URL_ENCODED:{value:{"Content-Type":"application/x-www-form-urlencoded"}},FORM_URL_ENCODED_CONTENT_TYPE_HEADER:{get:function(){return console.warn("HttpService.FORM_URL_ENCODED_CONTENT_TYPE_HEADER is deprecated - use HttpService.FORM_URL_ENCODED instead"),this.FORM_URL_ENCODED}},setHeadersForQuery:{value:function(e,t){var i,r,n=t&&t.authorization&&t.authorization[0];n&&n.headerValueExpression&&this.authorizationHeaderName?(r=new c(n),i=u(l(n.headerValueExpression)),e[this.authorizationHeaderName]=i(r)):t&&this.authorizationHeaderName&&this.authorizationHeaderValueExpression?(r=new c(t),i=u(l(this.authorizationHeaderValueExpression)),e[this.authorizationHeaderName]=i(r)):this.authorizationHeaderName&&this.authorizationHeaderValue&&(e[this.authorizationHeaderName]=this.authorizationHeaderValue)}},authorizationHeaderName:{value:"Authorization"},authorizationHeaderValue:{value:void 0},authorizationHeaderValueExpression:{value:void 0},fetchHttpObjectProperty:{value:function(e,t,i,r,a){var o,s,l,u;return this._getCachedFetchPromise(t,i)||(s=arguments.length>=4?n.withTypeAndCriteria(e,arguments[arguments.length-1]):n.withTypeAndCriteria(e),l=arguments.length<5||!r?[]:Array.isArray(r)?r:Array.prototype.slice.call(arguments,3,-1),o=this,this._setCachedFetchPromise(t,i,this.nullPromise.then(function(){return o.rootService.getObjectProperties(t,l)}).then(function(){return u=o.rootService.fetchData(s)}).then(function(){return o.eventLoopPromise}).then(function(){return o._setCachedFetchPromise(t,i,null),u.data}))),this._getCachedFetchPromise(t,i)}},_getCachedFetchPromise:{value:function(e,t){return this._cachedFetchPromises=this._cachedFetchPromises||{},this._cachedFetchPromises[t]=this._cachedFetchPromises[t]||new o,this._cachedFetchPromises[t].get(e)}},_setCachedFetchPromise:{value:function(e,t,i){this._cachedFetchPromises=this._cachedFetchPromises||{},this._cachedFetchPromises[t]=this._cachedFetchPromises[t]||new o,this._cachedFetchPromises[t].set(e,i)}},_authRegexp:{value:new RegExp(/error=\"([^&]*)\"/)},_fetchHttpRawDataWithParsedArguments:{value:function(e){var t,i,r=this;return e?e.url||(t=new Error("No URL provided to fetchHttpRawData()")):t=new Error("Invalid arguments to fetchHttpRawData()"),new h(function(n,a){var o,s,l;if((new Date).getTime(),t)console.warn(t),a(t);else{for(i=new XMLHttpRequest,i.onreadystatechange=function(){4===i.readyState&&n(i)},i.onerror=function(){t=d.withRequestAndURL(i,e.url),a(t)},i.open(e.body?"POST":"GET",e.url,!0),r.setHeadersForQuery(e.headers,e.query,e.url),s=Object.keys(e.headers),o=0;l=s[o];++o)i.setRequestHeader(l,e.headers[l]);i.withCredentials=e.credentials,i.send(e.body)}}).then(function(){return r.eventLoopPromise}).then(function(){if(r._isRequestUnauthorized(i)&&"function"==typeof r.authorize)return r.authorize().then(function(){return r._fetchHttpRawDataWithParsedArguments(e)});if(!t&&(i.status>=300||0===i.status))throw d.withRequestAndURL(i,e.url);return e.types[0].parseResponse(i,e.url)})}},_isRequestUnauthorized:{value:function(e){return 401===e.status||"function"==typeof this.didAuthorizationFail&&this.didAuthorizationFail(e)}},fetchHttpRawData:{value:function(e,t,i,r,n,a){var o=this._parseFetchHttpRawDataArguments.apply(this,arguments);return this._fetchHttpRawDataWithParsedArguments(o)}},_parseFetchHttpRawDataArguments:{value:function(){var e,i,r,a;e={url:arguments[0]},i="string"==typeof e.url?arguments.length-1:-1,i<0&&console.warn(new Error("Invalid URL for fetchHttpRawData()")),e.credentials=i<1||arguments[i],e.credentials instanceof Boolean?e.credentials=e.credentials.valueOf():"boolean"!=typeof e.credentials&&(e.credentials=!0,i+=1);var o=i>1&&arguments[1]||{};if(e.headers={},"object"==typeof o&&Object.assign(e.headers,o),this._isBoolean(o)&&(console.warn(new Error("Invalid headers for fetchHttpRawData()")),i=-1),i>2&&arguments[2]&&(e.body=arguments[2],this._isBoolean(e.body)&&(console.warn(new Error("Invalid body for fetchHttpRawData()")),i=-1)),4===i&&Array.isArray(arguments[3]))e.types=arguments[3];else if(i<4||!(arguments[3]instanceof t.HttpService.DataType))e.types=[t.HttpService.DataType.JSON];else{for(r=3,a=i;r<a&&arguments[r]instanceof t.HttpService.DataType;)++r;e.types=Array.prototype.slice.call(arguments,3,r),r<a&&(console.warn(new Error("Invalid types for fetchHttpRawData()")),i=-1)}return 5===i&&arguments[4]instanceof n?e.query=arguments[4]:4===i&&arguments[3]instanceof n&&(e.query=arguments[3]),i>=0?e:void 0}},_isBoolean:{value:function(e){return"boolean"==typeof e||e instanceof Boolean}},formUrlEncode:{value:function(e){return encodeURIComponent(e).replace(/ /g,"+").replace(/[!'()*]/g,function(e){return"%"+e.charCodeAt(0).toString(16)})}}},{DataType:{get:a.getterFor("_DataType",{BINARY:[{}],JSON:[{parseResponse:{value:function(e,t){var i=e&&e.responseText,r=null;if(i)try{r=JSON.parse(i)}catch(n){console.warn(new Error("Can't parse JSON received from "+t))}else e&&console.warn(new Error("No JSON response received from "+t));return r}}}],JSONP:[{parseResponse:{value:function(e,t){var i=e&&e.responseText,r=i&&i.indexOf("(")+1,n=i&&Math.max(i.lastIndexOf(")"),0),a=null;if(r&&n)try{a=i&&JSON.parse(i.slice(r,n))}catch(o){console.warn(new Error("Can't parse JSONP received from "+t)),console.warn("Response text:",i)}else i?(console.warn(new Error("Can't parse JSONP received from "+t)),console.warn("Response text:",i)):e&&console.warn(new Error("No JSONP response received from "+t));return a}}}],TEXT:[{parseResponse:{value:function(e,t){var i=e&&e.responseText;return!i&&e&&console.warn(new Error("No text response received from "+t)),i}}}],XML:[{}]})}})}}),montageDefine("b7b5e36","core/meta/object-property",{dependencies:["../core","../exception","./model","../deprecate","../logger"],factory:function(e,t,i){var r=e("../core").Montage,n=e("../exception").Exception,a=e("./model").Model,o=e("../deprecate"),s=e("../logger").logger("object-property");t.ObjectProperty=r.specialize({init:{serializable:!1,enumerable:!1,value:function(){return this}},apply:{value:function(e,t){var i;e.hasOwnProperty("objectDescriptor")||(i=r.getInfoForObject(e),null!==i&&i.isInstance===!1&&(void 0===t?t=a.group.objectDescriptorForPrototype(i.objectName,i.moduleId):t.prototypeName===i.objectName&&t.moduleId===i.moduleId||(t=null),this.applyWithObjectDescriptor(e,t)))}},applyWithBlueprint:{value:o.deprecateMethod(void 0,function(e,t){return this.applyWithObjectDescriptor(e,t)},"applyWithBlueprint","applyWithObjectDescriptor")},applyWithObjectDescriptor:{value:function(e,t){null!==t&&(this.addProperties(e,t),null!==t.parent&&this.apply(Object.getPrototypeOf(e),t))}},addProperties:{value:function(e,t){for(var i,n=0;i=t.propertyDescriptors[n++];)i.isDerived?this.addDerivedProperty(e,i):i.isAssociation?this.addAssociation(e,i):this.addProperty(e,i);r.defineProperty(e,"blueprint",{enumerable:!1,serializable:!1,get:function(){return this._objectDescriptor}}),r.defineProperty(e,"_objectDescriptor",{serializable:!1,enumerable:!1,value:t}),r.defineProperty(e,"objectDescriptor",{enumerable:!1,serializable:!1,get:function(){return this._objectDescriptor}}),r.defineProperty(e,"blueprintGet",{serializable:!1,enumerable:!1,value:this.objectDescriptorGet}),r.defineProperty(e,"blueprintSet",{serializable:!1,enumerable:!1,value:this.objectDescriptorSet}),r.defineProperty(e,"objectDescriptorGet",{serializable:!1,enumerable:!1,value:this.objectDescriptorGet}),r.defineProperty(e,"objectDescriptorSet",{serializable:!1,enumerable:!1,value:this.objectDescriptorSet})}},addProperty:{value:function(e,t){this.addPropertyStorage(e,t),this.addPropertyDefinition(e,t),this.addPropertyStoredValue(e,t)}},addPropertyStorage:{value:function(e,t){var i="_"+t.name,n="_"+i,a=null;e.hasOwnProperty(i)?s.isError&&s.error("We have an issue here. The developer should not override the storage value for "+i+"."):(t.isToMany?(r.defineProperty(e,n,{value:null,enumerable:!1,serializable:!1}),a={get:function(){return this[n]||(this[n]=[])},enumerable:!1,serializable:!0}):a={value:null,enumerable:!1,serializable:!0},r.defineProperty(e,i,a))}},addPropertyDefinition:{value:function(e,t){var i=t.name,n=null;e.hasOwnProperty(i)?s.isDebug&&s.debug("The developer has already created the property "+i+" method do nothing."):(n={get:function(){return this.objectDescriptorGet(i)},enumerable:!0,serializable:!1},t.readOnly||(n.set=function(e){return this.objectDescriptorSet(i,e)}),r.defineProperty(e,i,n))}},blueprintGet:{value:o.deprecateMethod(void 0,function(e){return this.objectDescriptorGet(e)},"blueprintGet","objectDescriptorGet"),enumerable:!1,serializable:!1},objectDescriptorGet:{value:function(e){var t=this.objectDescriptor.propertyDescriptorForName(e),i="_"+t.name;return this[i]},enumerable:!1,serializable:!1},blueprintSet:{value:o.deprecateMethod(void 0,function(e,t){return this.objectDescriptorSet(e,t)},"blueprintSet","objectDescriptorSet"),enumerable:!1,serializable:!1},objectDescriptorSet:{value:function(e,t){var i=this.objectDescriptor.propertyDescriptorForName(e),r="_"+i.name;if(null===t&&i.denyDelete)throw(new n).initWithMessageTargetAndMethod("Deny Delete",this,i.name);this[r]=t},enumerable:!1,serializable:!1},addPropertyStoredValue:{value:function(e,t){var i=t.name+"$Storage",n="_"+i,a=null;e.hasOwnProperty(i)?s.isError&&s.error("We have an issue here. The developer should not override the stored value for "+i+"."):(t.isToMany?(r.defineProperty(e,n,{value:null,enumerable:!1,serializable:!1}),a={get:function(){return this[n]||(this[n]=[])},enumerable:!1,serializable:!1}):a={value:null,enumerable:!1,serializable:!1},r.defineProperty(e,i,a))}},addAssociation:{value:function(e,t){this.addPropertyStorage(e,t),this.addAssociationDefinition(e,t),this.addPropertyStoredValue(e,t)}},addAssociationDefinition:{value:function(e,t){t.isToMany?this.addToManyAssociationDefinition(e,t):this.addToOneAssociationDefinition(e,t)}},addToOneAssociationDefinition:{value:function(e,t){var i=t.name.toCapitalized(),n="addTo"+i;e.hasOwnProperty(n)?s.isError&&s.error("We have an issue here. The developer should not override the method "+n+"."):r.defineProperty(e,n,{serializable:!1,enumerable:!1,value:function(){return null}}),n="removeFrom"+i,e.hasOwnProperty(n)?s.isError&&s.error("We have an issue here. The developer should not override the method "+n+"."):r.defineProperty(e,n,{serializable:!1,enumerable:!1,value:function(){return null}}),n="clear"+i,e.hasOwnProperty(n)?s.isError&&s.error("We have an issue here. The developer should not override the method "+n+"."):r.defineProperty(e,n,{serializable:!1,enumerable:!1,value:function(){return null}})}},addToManyAssociationDefinition:{value:function(e,t){var i=t.name.toCapitalized(),n="addTo"+i;e.hasOwnProperty(n)?s.isError&&s.error("We have an issue here. The developer should not override the method "+n+"."):r.defineProperty(e,n,{serializable:!1,enumerable:!1,value:function(){return null}}),n="removeFrom"+i,e.hasOwnProperty(n)?s.isError&&s.error("We have an issue here. The developer should not override the method "+n+"."):r.defineProperty(e,n,{serializable:!1,enumerable:!1,value:function(){return null}}),n="clear"+i,e.hasOwnProperty(n)?s.isError&&s.error("We have an issue here. The developer should not override the method "+n+"."):r.defineProperty(e,n,{serializable:!1,enumerable:!1,value:function(){return null}})}},addDerivedProperty:{value:function(e,t){}}})}}),montageDefine("b7b5e36","core/meta/property-descriptor",{dependencies:["../core","../promise","../deprecate","../logger","../core","../core","../core","../core"],factory:function(e,t,i){var r=e("../core").Montage,n=e("../promise").Promise,a=e("../deprecate"),o=(e("../logger").logger("objectDescriptor"),{name:"default",cardinality:1,mandatory:!1,readOnly:!1,denyDelete:!1,valueType:"string",collectionValueType:"list",valueObjectPrototypeName:"",valueObjectModuleId:"",valueDescriptor:void 0,enumValues:[],defaultValue:void 0,helpKey:""});t.PropertyDescriptor=r.specialize({initWithNameObjectDescriptorAndCardinality:{value:function(e,t,i){return this._name=null!==e?e:o.name,this._owner=t,this.cardinality=i>0?i:o.cardinality,this}},initWithNameBlueprintAndCardinality:{value:a.deprecateMethod(void 0,function(e,t,i){return this.initWithNameObjectDescriptorAndCardinality(e,t,i)},"new PropertyBlueprint().initWithNameBlueprintAndCardinality","new PropertyDescriptor().initWithNameObjectDescriptorAndCardinality")},serializeSelf:{value:function(e){e.setProperty("name",this.name),e.setProperty("objectDescriptor",this._owner,"reference"),this.cardinality===1/0?e.setProperty("cardinality",-1):this._setPropertyWithDefaults(e,"cardinality",this.cardinality),this._setPropertyWithDefaults(e,"mandatory",this.mandatory),this._setPropertyWithDefaults(e,"readOnly",this.readOnly),this._setPropertyWithDefaults(e,"denyDelete",this.denyDelete),this._setPropertyWithDefaults(e,"valueType",this.valueType),this._setPropertyWithDefaults(e,"collectionValueType",this.collectionValueType),this._setPropertyWithDefaults(e,"valueObjectPrototypeName",this.valueObjectPrototypeName),this._setPropertyWithDefaults(e,"valueObjectModuleId",this.valueObjectModuleId),this._setPropertyWithDefaults(e,"valueDescriptor",this._valueDescriptorReference),this.enumValues.length>0&&this._setPropertyWithDefaults(e,"enumValues",this.enumValues),this._setPropertyWithDefaults(e,"defaultValue",this.defaultValue),this._setPropertyWithDefaults(e,"helpKey",this.helpKey),this._setPropertyWithDefaults(e,"definition",this.definition)}},deserializeSelf:{value:function(e){var t;t=e.getProperty("name"),void 0!==t&&(this._name=t),t=e.getProperty("objectDescriptor")||e.getProperty("blueprint"),void 0!==t&&(this._owner=t),this._overridePropertyWithDefaults(e,"cardinality"),this.cardinality===-1&&(this.cardinality=1/0),this._overridePropertyWithDefaults(e,"mandatory"),this._overridePropertyWithDefaults(e,"readOnly"),this._overridePropertyWithDefaults(e,"denyDelete"),this._overridePropertyWithDefaults(e,"valueType"),this._overridePropertyWithDefaults(e,"collectionValueType"),this._overridePropertyWithDefaults(e,"valueObjectPrototypeName"),this._overridePropertyWithDefaults(e,"valueObjectModuleId"),this._overridePropertyWithDefaults(e,"_valueDescriptorReference","valueDescriptor","targetBlueprint"),this._overridePropertyWithDefaults(e,"enumValues"),this._overridePropertyWithDefaults(e,"defaultValue"),this._overridePropertyWithDefaults(e,"helpKey"),this._overridePropertyWithDefaults(e,"definition")}},_setPropertyWithDefaults:{value:function(e,t,i){null!==i&&i!==o[t]&&e.setProperty(t,i)}},_getPropertyWithDefaults:{value:function(e){var t,i,r,n=Array.prototype.slice.call(arguments).slice(1,1/0);for(i=0,r=n.length;i<r&&!t;i+=1)t=e.getProperty(n[i]);return t||o[n[0]]}},_overridePropertyWithDefaults:{value:function(e,t){var i,r,n,a;for(i=arguments.length>2?Array.prototype.slice.call(arguments,2,1/0):[t],n=0,a=i.length;n<a&&!r;n++)r=e.getProperty(i[n]);this[t]=void 0===r?o[i[0]]:r}},_owner:{value:null},owner:{get:function(){return this._owner}},_name:{value:null},name:{serializable:!1,get:function(){return this._name}},identifier:{get:function(){return[this.owner.identifier,this.name].join("_")}},cardinality:{value:o.cardinality},mandatory:{value:o.mandatory},denyDelete:{value:o.denyDelete},readOnly:{value:o.readOnly},isToMany:{get:function(){return this.cardinality===1/0||this.cardinality>1}},isDerived:{get:function(){return!1}},definition:{value:null},valueType:{value:o.valueType},collectionValueType:{value:o.collectionValueType},valueObjectPrototypeName:{value:o.valueObjectPrototypeName},valueObjectModuleId:{value:o.valueObjectModuleId},valueDescriptor:{serializable:!1,get:function(){return this._valueDescriptorReference&&"function"==typeof this._valueDescriptorReference.promise?(a.deprecationWarningOnce("valueDescriptor reference via ObjectDescriptorReference","direct reference via object syntax"),this._valueDescriptorReference.promise(this.require)):n.resolve(this._valueDescriptorReference)},set:function(e){this._valueDescriptorReference=e}},_targetObjectDescriptorReference:{value:null},_enumValues:{value:null},enumValues:{
get:function(){return this._enumValues?this._enumValues:[]},set:function(e){Array.isArray(e)&&(this._enumValues=e)}},defaultValue:{value:o.defaultValue},helpKey:{value:o.helpKey},objectDescriptorModuleId:e("../core")._objectDescriptorModuleIdDescriptor,objectDescriptor:e("../core")._objectDescriptorDescriptor,serializable:{value:!0},isAssociationBlueprint:{get:a.deprecateMethod(void 0,function(){return!!this._valueDescriptorReference},"isAssociationBlueprint","No analog")},targetBlueprint:{get:a.deprecateMethod(void 0,function(){return this.valueDescriptor},"targetBlueprint.get","valueDescriptor.get"),set:a.deprecateMethod(void 0,function(e){this.valueDescriptor=e},"targetBlueprint.get","valueDescriptor.set")},blueprintDescriptorModuleId:e("../core")._objectDescriptorModuleIdDescriptor,blueprint:e("../core")._objectDescriptorDescriptor})}}),montageDefine("b7b5e36","core/application",{dependencies:["./target","./template","../window-loader/montage-window","./dom"],factory:function(e,t,i){var r,n=e("./target").Target,a=e("./template"),o=e("../window-loader/montage-window").MontageWindow;e("./dom");var s="-is-first-load";t.Application=n.specialize({eventManager:{value:null},parentApplication:{value:null},name:{value:null},_isFirstLoad:{value:null},isFirstLoad:{get:function(){return this._isFirstLoad}},mainApplication:{get:function(){for(var e=this;e.parentApplication;)e=e.parentApplication;return e}},_windowsSortOrder:{value:"reverse-z-order"},windowsSortOrder:{get:function(){return null===this.parentApplication?this._windowsSortOrder:this.mainApplication.windowsSortOrder},set:function(e){null===this.parentApplication?["z-order","reverse-z-order","z-order","reverse-open-order"].indexOf(e)!==-1&&(this._windowsSortOrder=e):this.mainApplication.windowsSortOrder=e}},windows:{get:function(){if(null===this.parentApplication){if(!this._windows){var e=new o;e.application=this,e.window=window,this.window=e,this._windows=[this.window],this._multipleWindow=!0}return this._windows}return this.mainApplication.windows}},_window:{value:null},window:{get:function(){if(!this._window&&this===this.mainApplication){var e=new o;e.application=this,e.window=window,this._window=e}return this._window},set:function(e){this._window||(this._window=e)}},attachedWindows:{value:[]},eventManagerForWindow:{value:function(e){return e.defaultEventMananger}},focusWindow:{get:function(){var e=this.windows,t=this.windowsSortOrder;if("z-order"===t)return e[0];if("reverse-z-order"===t)return e[e.length-1];for(var i in e)if(e[i].focused)return e[i]}},delegate:{value:null},nextTarget:{get:function(){return this.delegate}},openWindow:{value:function(e,t,i){var r,n,a=this,s=new o,l={location:!1,menubar:!1,resizable:!0,scrollbars:!0,status:!1,titlebar:!0,toolbar:!1},u={module:e,name:t,parent:window,callback:function(e,t){var i;r=e.document.application,s.window=e,s.application=r,s.component=t,r.window=s,a.attachedWindows.push(s),i=a.mainApplication.windowsSortOrder,"z-order"===i||"reverse-open-order"===i?a.windows.unshift(s):a.windows.push(s),n=document.createEvent("CustomEvent"),n.initCustomEvent("load",!0,!0,null),s.dispatchEvent(n)}};this!==this.mainApplication||this._multipleWindow||this.window;var c,h,d="",p="";if("object"==typeof i)for(c in i)i.hasOwnProperty(c)&&(l[c]=i[c]);var m=["name"];for(c in l)m.indexOf(c)===-1&&(h=l[c],"boolean"==typeof h?h=h?"yes":"no":(h=String(h),h.match(/[ ,"]/)&&(h='"'+h.replace(/"/g,'\\"')+'"')),p+=d+c+"="+h,d=",");return global.require.loadPackage({name:"montage"}).then(function(e){var t=window.open(e.location+"window-loader/index.html","_blank",p);t.loadInfo=u}),s}},attachWindow:{value:function(e){var t,i=e.application.parentApplication;return i!==this&&(i&&i.detachWindow(e),e.parentApplication=this,this.attachedWindows.push(e),t=this.mainApplication.windowsSortOrder,"z-order"===t||"reverse-open-order"===t?this.windows.unshift(e):this.windows.push(e),e.focus()),e}},detachWindow:{value:function(e){var t,i,r=this.windows;return void 0===e&&(e=this.window),i=e.application.parentApplication,i===this?(t=this.attachedWindows.indexOf(e),t!==-1&&this.attachedWindows.splice(t,1),t=r.indexOf(e),t!==-1&&r.splice(t,1),e.application.parentApplication=null):i&&i.detachWindow(e),e}},constructor:{value:function(){"undefined"!=typeof window&&window.loadInfo&&!this.parentApplication&&(this.parentApplication=window.loadInfo.parent.document.application)}},_load:{value:function(i,r){var n,o=this;return this.name=i.packageDescription.name,this._loadApplicationContext(),t.application=o,e.async("ui/component").then(function(e){if(n=e.__root__,"undefined"!=typeof document)return n.element=document,a.instantiateDocument(document,i)}).then(function(e){return o.callDelegateMethod("willFinishLoading",o),n.needsDraw=!0,r&&r(o),o})}},_loadApplicationContext:{value:function(){if(null===this._isFirstLoad){var e,t=this.name+s;if("undefined"!=typeof localStorage&&(localStorage.getItem(t),null===e))try{localStorage.setItem(t,!0)}catch(i){}this._isFirstLoad=!e}}},_alertPopup:{value:null,enumerable:!1},_confirmPopup:{value:null,enumerable:!1},_notifyPopup:{value:null,enumerable:!1},_zIndex:{value:null},_isSystemPopup:{value:function(e){return"alert"===e||"confirm"===e||"notify"===e}},_createPopupSlot:{value:function(e){var t=document.createElement("div");document.body.appendChild(t),t.style.zIndex=e,t.style.position="absolute";var i=new r;return i.element=t,i.attachToParentComponent(),i}},getPopupSlot:{value:function(t,i,n){var a=this;e.async("ui/slot.reel/slot").then(function(e){r=r||e.Slot,t=t||"custom";var o,s,l=a._isSystemPopup(t);if(a.popupSlots=a.popupSlots||{},l)switch(t){case"alert":o=19004;break;case"confirm":o=19003;break;case"notify":o=19002}else a._zIndex?a._zIndex=a._zIndex+1:a._zIndex=17e3,o=a._zIndex;s=a.popupSlots[t],s||(s=a.popupSlots[t]=a._createPopupSlot(o)),l||(s.element.style.zIndex=o),s.content=i,n.call(this,s)})}},returnPopupSlot:{value:function(e){var t=this;if(t.popupSlots&&t.popupSlots[e]){var i=t.popupSlots[e];i.content=null}}},_getActivePopupSlots:{value:function(){var e=[];if(this.popupSlots){var t=Object.keys(this.popupSlots);if(t&&t.length>0){var i,r,n=t.length;for(i=0;i<n;i++)r=this.popupSlots[t[i]],r&&null!==r.content&&e.push(r)}}return e}}})}}),montageDefine("b7b5e36","data/service/data-trigger",{dependencies:["core/core","data/model/data-object-descriptor","data/model/object-descriptor","collections/weak-map"],factory:function(e,t,i){var r,n=e("core/core").Montage,a=e("data/model/data-object-descriptor").DataObjectDescriptor,o=e("data/model/object-descriptor").ObjectDescriptor,s=e("collections/weak-map");r=t.DataTrigger=function(){},t.DataTrigger.prototype=Object.create({},{constructor:{configurable:!0,writable:!0,value:t.DataTrigger},_service:{configurable:!0,writable:!0,value:void 0},_objectPrototype:{configurable:!0,writable:!0,value:void 0},_propertyName:{configurable:!0,writable:!0,value:void 0},_privatePropertyName:{configurable:!0,get:function(){return!this.__privatePropertyName&&this._propertyName&&(this.__privatePropertyName="_"+this._propertyName),this.__privatePropertyName}},_isGlobal:{configurable:!0,get:function(){return!(this._valueStatus instanceof s)},set:function(e){e=!!e,e!==this._isGlobal&&(this._valueStatus=e?void 0:new s)}},_valueStatus:{configurable:!0,writable:!0,value:void 0},_getValueStatus:{configurable:!0,value:function(e){return this._isGlobal?this._valueStatus:this._valueStatus.get(e)}},_setValueStatus:{configurable:!0,value:function(e,t){this._isGlobal?this._valueStatus=t:void 0!==t?this._valueStatus.set(e,t):this._valueStatus["delete"](e)}},_getValue:{configurable:!0,writable:!0,value:function(e){var t,i,r;for(this.getObjectProperty(e),t=Object.getPrototypeOf(this._objectPrototype);t;)i=Object.getOwnPropertyDescriptor(t,this._propertyName),r=i&&i.get,t=!r&&Object.getPrototypeOf(t);return r?r.call(e):e[this._privatePropertyName]}},_setValue:{configurable:!0,writable:!0,value:function(e,t){var i,r,n,a,o,s;for(i=this._getValueStatus(e),this._setValueStatus(e,null),r=Object.getPrototypeOf(this._objectPrototype);r;)n=Object.getOwnPropertyDescriptor(r,this._propertyName),a=n&&n.get,o=a&&n.set,s=!n||o||n.writable,r=s&&!o&&Object.getPrototypeOf(r);o?o.call(e,t):s&&(e[this._privatePropertyName]=t),i&&i.resolve(null)}},decacheObjectProperty:{value:function(e){this._setValueStatus(e,void 0)}},getObjectProperty:{value:function(e){var t=this._getValueStatus(e);return t?t.promise:null===t?this._service.nullPromise:this.updateObjectProperty(e)}},updateObjectProperty:{value:function(e){var t=this,i=this._getValueStatus(e)||{};return i.promise||(this._setValueStatus(e,i),i.promise=new Promise(function(r,n){i.resolve=r,i.reject=n,t._fetchObjectProperty(e)})),i.promise}},_fetchObjectProperty:{value:function(e){var t=this;this._service.fetchObjectProperty(e,this._propertyName).then(function(){return t._fulfillObjectPropertyFetch(e)})["catch"](function(i){return console.error(i),t._fulfillObjectPropertyFetch(e,i)})}},_fulfillObjectPropertyFetch:{value:function(e,t){var i=this._getValueStatus(e);return this._setValueStatus(e,null),i&&!t?i.resolve(null):i&&t&&(console.error(t),i.reject(t)),null}}}),Object.defineProperties(t.DataTrigger,{addTriggers:{value:function(e,t,i,r){var n=t instanceof a||t instanceof o;return n?this._addTriggersForMontageDataType(e,t,i,name):this._addTriggers(e,t,i,r)}},_addTriggersForMontageDataType:{value:function(e,t,i){var r,n,a,o={},s=Object.keys(t.propertyDescriptors);for(a=0;n=s[a];++a)r=this.addTrigger(e,t,i,n),r&&(o[n]=r);return o}},_addTriggers:{value:function(e,t,i,r){var n,a,o,s,l,u={};for(s=0,l=t.propertyDescriptors.length;s<l;s+=1)n=t.propertyDescriptors[s],r.has(n.name)||(o=n.name,a=this.addTrigger(e,t,i,o),a&&(u[o]=a));return u}},addTrigger:{value:function(e,t,i,r){var n=t instanceof a||t instanceof o;return n?this._addTriggerForMontageDataType(e,t,i,r):this._addTrigger(e,t,i,r)}},_addTriggerForMontageDataType:{value:function(e,t,i,r){var a,o=t.propertyDescriptors[r];return o&&o.isRelationship&&(a=Object.create(this._getTriggerPrototype(e)),a._objectPrototype=i,a._propertyName=r,a._isGlobal=o.isGlobal,n.defineProperty(i,r,{get:function(){return a._getValue(this)},set:function(e){a._setValue(this,e)}})),a}},_createTrigger:{value:function(e,t,i,r,n){var a=Object.create(this._getTriggerPrototype(e)),o=e._dataObjectTriggers.get(t);return a._objectPrototype=i,a._propertyName=r,a._isGlobal=n.isGlobal,o||(o={},e._dataObjectTriggers.set(t,o)),o[r]=a,a}},_addTrigger:{value:function(e,t,i,r){var a,o=t.propertyDescriptorForName(r);return o&&(a=Object.create(this._getTriggerPrototype(e)),a._objectPrototype=i,a._propertyName=r,a._isGlobal=o.isGlobal,o.definition?n.defineProperty(i,r,{get:function(){return this.getBinding(r)||this.defineBinding(r,{"<-":o.definition}),a._getValue(this)},set:function(e){a._setValue(this,e)}}):n.defineProperty(i,r,{get:function(){return a._getValue(this)},set:function(e){a._setValue(this,e)}}),a=Object.create(this._getTriggerPrototype(e)),a._objectPrototype=i,a._propertyName=r,a._isGlobal=o.isGlobal),a}},_getTriggerPrototype:{value:function(e){var t=this._triggerPrototypes&&this._triggerPrototypes.get(e);return t||(t=new this,t._service=e,this._triggerPrototypes=this._triggerPrototypes||new s,this._triggerPrototypes.set(e,t)),t}},removeTriggers:{value:function(e,t){var i,r,n=Object.keys(e);for(r=0;i=n[r];++r)this.removeTrigger(e[i],t,i)}},removeTrigger:{value:function(e,t){e&&delete t[e.name]}}})}}),montageDefine("b7b5e36","data/service/authorization-manager",{dependencies:["core/core","core/promise","collections/map","core/application","data/service/authorization-policy"],factory:function(e,t,i){var r=e("core/core").Montage,n=e("core/promise").Promise,a=e("collections/map"),o=e("core/application").application,s=e("data/service/authorization-policy").AuthorizationPolicy,l="ui/authorization-manager-panel.reel",u=r.specialize({constructor:{value:function(){return this._providersByModuleID=new a,this._panelsByModuleID=new a,this._authorizationsByProviderModuleID=new a,this.defineBinding("hasPendingServices",{"<-":"_pendingServicesCount != 0"}),this}},_authorizationsByProviderModuleID:{value:void 0},_panelsByModuleID:{value:void 0},_providersByModuleID:{value:void 0},_managerPanel:{value:function(){var t,i=this;return!this._managerPanelPromise&&this.authorizationManagerPanel?(this.authorizationManagerPanel.authorizationManager=this,this._managerPanelPromise=n.resolve(this.authorizationManagerPanel)):this._managerPanelPromise||(t=this.callDelegateMethod("authorizationManagerWillLoadAuthorizationManagerPanel",this,l)||l,this._managerPanelPromise=e.async(t).bind(this).then(function(e){var t=new e.AuthorizationManagerPanel;return i.authorizationManagerPanel=t,t.authorizationManager=i,t})["catch"](function(e){console.log(e)})),this._managerPanelPromise}},_panelForProvider:{value:function(e){var t=this._panelModuleIDForProvider(e),i=this._panelsByModuleID.get(t);return i?n.resolve(i):this._makePanelForProvider(t,e)}},_panelModuleIDForProvider:{value:function(e){var t=e.authorizationPanel;return this.callDelegateMethod("authorizationManagerWillAuthorizeServiceWithPanelModuleId",this,e,t)||t}},_makePanelForProvider:{value:function(e,t){var i,n=this,a=r.getInfoForObject(t);return e&&(i=a.require.async(e).then(function(i){var r,a,o,s=Object.keys(i);for(a=0,o=s.length;a<o&&!r;++a)r=n._panelForConstructorAndProvider(i[s[a]],t);return r.service=t,n._panelsByModuleID.set(e,r),r})),i}},_panelForConstructorAndProvider:{value:function(e,t){return this.callDelegateMethod("authorizationManagerWillInstantiateAuthorizationPanelForService",this,e,t)||new e}},_canNotifyDataService:{value:function(e){return e.authorizationManagerWillAuthorizeWithService&&"function"==typeof e.authorizationManagerWillAuthorizeWithService}},_providersForDataService:{value:function(e){var t,i,a,o=[],s=r.getInfoForObject(e),l=e.authorizationServices;for(i=0,a=l.length;i<a;++i)t=this._providerWithModuleID(l[i],s.require),o.push(t);return n.all(o)}},_providerWithModuleID:{value:function(e,t){var i=this._providersByModuleID.get(e);return i?n.resolve(i):this._makeProviderWithModuleID(e,t)}},_authorizationWithProvider:{value:function(e,t){var i,r=this;return this._providerWithModuleID(e,t).then(function(e){return i=e,i.authorize()}).then(function(e){return e||r._authorizeProviderWithManagerPanel(i)})}},_authorizeProviderWithManagerPanel:{value:function(e){var t,i=this;return i._pendingServicesCount++,this._managerPanel().then(function(r){return t=r,i._panelForProvider(e)}).then(function(e){return t.authorizeWithPanel(e)}).then(function(e){return i._pendingServicesCount--,e})}},_makeProviderWithModuleID:{value:function(e,t){var i=this;return t.async(e).then(function(e){var t,r,n,a=Object.keys(e);for(r=0;n=a[r];++r)t=t||new e[n];return i.registerAuthorizationService(t),t})}},_notifyDataService:{value:function(e){var t,i;return this._canNotifyDataService(e)?this._providersForDataService(e).then(function(r){for(t=0,i=r.length;t<i;t++)e.authorizationManagerWillAuthorizeWithService(this,r[t])}):n.resolve(null)}},authorizationManagerPanel:{value:void 0},authorizeService:{value:function(e,t){var i=this,r=[];return e.authorizationPolicy===s.NONE?n.resolve(null):(r=this._authorizationsForDataService(e),r.length?n.all(r):e.authorizationPolicy!==s.ON_DEMAND||t?(r=this._authorizationsForDataService(e,!0),i._notifyDataService(e).then(function(){var e=o.applicationModal&&i.authorizationManagerPanel.runModal;return e?i.authorizationManagerPanel.runModal():n.all(r)}).then(function(t){return i.callDelegateMethod("authorizationManagerDidAuthorizeService",i,e),t})["catch"](function(){i.hasPendingServices=!1})):n.resolve(null))}},_authorizationsForDataService:{value:function(e,t){var i,n,a,o,s=[],l=r.getInfoForObject(e);for(a=0,o=e.authorizationServices.length;a<o;a++)n=e.authorizationServices[a],i=this._authorizationForServiceFromProvider(n,l.require,t),i&&s.push(i);return s}},_authorizationForServiceFromProvider:{value:function(e,t,i){var r=null;return this._authorizationsByProviderModuleID.has(e)?r=this._authorizationsByProviderModuleID.get(e):i&&(r=this._authorizationWithProvider(e,t),this._authorizationsByProviderModuleID.set(e,r)),r}},_pendingServicesCount:{value:0},delegate:{value:null},hasPendingServices:{value:!1},registerAuthorizationService:{value:function(e){var t=r.getInfoForObject(e);this._providersByModuleID.set(t.moduleId,e)}}});t.AuthorizationManager=new u}}),montageDefine("b7b5e36","ui/base/abstract-number-field",{dependencies:["./abstract-control","../../composer/key-composer"],factory:function(e,t,i){var r=e("./abstract-control").AbstractControl,n=e("../../composer/key-composer").KeyComposer;t.AbstractNumberField=r.specialize({constructor:{value:function a(){if(this.constructor===a)throw new Error("AbstractNumberField cannot be instantiated.");this._propertyNamesUsed={},this.defineBinding("classList.has('montage--disabled')",{"<-":"!enabled"})}},enterDocument:{value:function(e){if(e){var t=this._propertyNamesUsed;t.min||(this.min=this.element.getAttribute("min")||this._min),t.max||(this.max=this.element.getAttribute("max")||this._max),t.step||(this.step=this.element.getAttribute("step")||this._step),t.value||(this.value=this.element.getAttribute("value")||this._value),delete this._propertyNamesUsed,this._numberFieldTextFieldComponent.addEventListener("action",this,!1),this._numberFieldMinusComponent.addEventListener("action",this,!1),this._numberFieldPlusComponent.addEventListener("action",this,!1),this._numberFieldTextFieldComponent.delegate=this,this.element.addEventListener("mousedown",this,!1),this.element.tabIndex="-1",this._upKeyComposer=n.createKey(this,"up","increase"),this._downKeyComposer=n.createKey(this,"down","decrease"),this._rightKeyComposer=n.createKey(this,"right","increase"),this._leftKeyComposer=n.createKey(this,"left","decrease")}}},textFieldShouldBeginEditing:{value:function(){return this.enabled}},textFieldDidChange:{value:function(){}},textFieldDidEndEditing:{value:function(){this.value=this._numberFieldTextFieldComponent.value}},textFieldShouldAcceptValue:{value:function(e,t){if(this._activeValueChange===!0)return!0}},prepareForActivationEvents:{value:function(){this._upKeyComposer.addEventListener("keyPress",this,!1),this._downKeyComposer.addEventListener("keyPress",this,!1),this._leftKeyComposer.addEventListener("keyPress",this,!1),this._rightKeyComposer.addEventListener("keyPress",this,!1)}},draw:{value:function(){this.element.setAttribute("aria-valuemax",this.max),this.element.setAttribute("aria-valuemin",this.min),this.element.setAttribute("aria-valuenow",this.value)}},acceptsActiveTarget:{value:!0},handleMousedown:{value:function(){this.element.focus()}},handlePlusAction:{value:function(){this._activeValueChange=!0;var e=this.step*this._stepDecimal,t="number"==typeof this.min?this.min*this._stepDecimal:0,i=this.value*this._stepDecimal-t;i%e?i<0?i-=i%e:i+=e-i%e:i+=e,this.value=(i+t)/this._stepDecimal,this._activeValueChange=!1}},handleMinusAction:{value:function(){this._activeValueChange=!0;var e=this.step*this._stepDecimal,t="number"==typeof this.min?this.min*this._stepDecimal:0,i=this.value*this._stepDecimal-t;i-=i%e?i>0?i%e:e+i%e:e,this.value=(i+t)/this._stepDecimal,this._activeValueChange=!1}},handleKeyPress:{value:function(e){this.enabled&&("increase"===e.identifier?this.handlePlusAction():"decrease"===e.identifier&&this.handleMinusAction())}},handleAction:{value:function(e){e.target!==this._numberFieldTextFieldComponent&&e.target!==this._numberFieldMinusComponent&&e.target!==this._numberFieldPlusComponent||(e.stopPropagation(),this.dispatchActionEvent())}},_value:{value:0},_required:{value:!1},_min:{value:"any"},_max:{value:"any"},_step:{value:1},min:{get:function(){return this._min},set:function(e){return("any"===e||!isNaN(e=parseFloat(e)))&&void(this._min!==e&&(this._propertyNamesUsed&&(this._propertyNamesUsed.min=!0),this._min=e,this.needsDraw=!0,"number"==typeof e&&this.value<e&&(this.value=e)))}},max:{get:function(){return this._max},set:function(e){return("any"===e||!isNaN(e=parseFloat(e)))&&void(this._max!==e&&(this._propertyNamesUsed&&(this._propertyNamesUsed.max=!0),this._max=e,this.needsDraw=!0,"number"==typeof e&&this.value>e&&(this.value=e)))}},_stepDecimal:{value:1},step:{get:function(){return this._step},set:function(e){if(isNaN(e=parseFloat(e))||e<=0)return!1;if(this._step!==e){this._propertyNamesUsed&&(this._propertyNamesUsed.step=!0),this._step=e;var t=String(e).match(/\.(\d+)$/);t?this._stepDecimal=Math.pow(10,t[1].length):this._stepDecimal=1}}},value:{get:function(){return this._value},set:function(e){null===e||void 0===e||"undefined"==typeof e.valueOf?this._value="":isNaN(e=parseFloat(e))||("number"==typeof this.min&&e<this.min&&(e=this.min),"number"==typeof this.max&&e>this.max&&(e=this.max),this._value!==e&&(this._propertyNamesUsed&&(this._propertyNamesUsed.value=!0),this._value=e,this.needsDraw=!0)),this._numberFieldTextFieldComponent&&this._value!==this._numberFieldTextFieldComponent.value&&(this._numberFieldTextFieldComponent.value=this._value)}},enabled:{value:!0},_numberFieldTextFieldComponent:{value:null},_numberFieldMinusComponent:{value:null},_numberFieldPlusComponent:{value:null},_activeValueChange:{value:!1}})}}),montageDefine("b7b5e36","core/document-resources",{dependencies:["./core","./promise","./mini-url"],factory:function(e,t,i){var r=e("./core").Montage,n=e("./promise").Promise,a=e("./mini-url"),o=r.specialize({_SCRIPT_TIMEOUT:{value:5e3},_document:{value:null},_resources:{value:null},_preloaded:{value:null},_expectedStyles:{value:null},constructor:{value:function(){this._expectedStyles=[],this._isPollingDocumentStyleSheets=!this._isLinkLoadEventAvailable()}},_webkitVersion:{value:function(){var e=/AppleWebKit\/([\d.]+)/.exec(navigator.userAgent);return e?parseInt(e[1]):null}},_isLinkLoadEventAvailable:{value:function(){var e=document.createElement("link"),t=this._webkitVersion();return"onload"in e&&!(null!==t&&t<535)}},initWithDocument:{value:function(e){return this.clear(),this._document=e,this._populateWithDocument(e),this}},_populateWithDocument:{value:function(e){var t=e.querySelectorAll("script"),i=Array.prototype.forEach;i.call(t,function(e){e.src&&this._addResource(this.normalizeUrl(e.src))},this);var r=e.querySelectorAll("link");i.call(r,function(e){"stylesheet"===e.rel&&this._addResource(this.normalizeUrl(e.href))},this)}},clear:{value:function(){this._resources=Object.create(null),this._preloaded=Object.create(null)}},_addResource:{value:function(e){this._resources[e]=!0}},hasResource:{value:function(e){return e in this._resources}},isResourcePreloaded:{value:function(e){return this._preloaded[e]===!0}},isResourcePreloading:{value:function(e){return n.is(this._preloaded[e])}},setResourcePreloadedPromise:{value:function(e,t){this._preloaded[e]=t}},setResourcePreloaded:{value:function(e){this._preloaded[e]=!0}},getResourcePreloadedPromise:{value:function(e){return this._preloaded[e]}},addScript:{value:function(e){var t=this.normalizeUrl(e.src);return t?this.isResourcePreloaded(t)?n.resolve():this.isResourcePreloading(t)?this.getResourcePreloadedPromise(t):this._importScript(e):this._importScript(e)}},_importScript:{value:function(e){var t,i=this,r=this._document,a=r.head,o=e.src;return o?(i._addResource(o),t=new n(function(t,r){var n,a=function s(r){i.setResourcePreloaded(o),e.removeEventListener("load",s,!1),e.removeEventListener("error",s,!1),clearTimeout(n),t(r)};e.addEventListener("load",a,!1),e.addEventListener("error",a,!1),n=setTimeout(function(){i.setResourcePreloaded(o),t()},i._SCRIPT_TIMEOUT)}),this.setResourcePreloadedPromise(o,t)):t=new n(function(e,t){e()}),a.appendChild(r.createComment("Inserted from FIXME")),a.appendChild(e),t}},handleEvent:{value:function(e){var t,i=e.target;"LINK"===i.tagName&&(t=this._expectedStyles.indexOf(i.href),t>=0&&this._expectedStyles.splice(t,1),i.removeEventListener("load",this,!1),i.removeEventListener("error",this,!1))}},addStyle:{value:function(e,t){var i,r=e.getAttribute("href");if(r){if(r=this.normalizeUrl(r),this.hasResource(r))return;this._addResource(r),this._expectedStyles.push(r),this._isPollingDocumentStyleSheets||(e.setAttribute("href",r),e.addEventListener("load",this,!1),e.addEventListener("error",this,!1))}i=t||this._document.head,i.insertBefore(e,i.firstChild)}},normalizeUrl:{value:function(e,t){return t||(t=this._document.location.href),a.resolve(t,e)}},domain:{value:global.location?global.location.protocol+"//"+global.location.host:""},isCrossDomain:{value:function(e){return 0!==e.indexOf(this.domain+"/")||0===e.indexOf("file://")}},preloadResource:{value:function(e,t){var i;return e=this.normalizeUrl(e),!t&&this.isCrossDomain(e)&&(i=!0),i||this.isResourcePreloaded(e)?n.resolve():this.isResourcePreloading(e)?this.getResourcePreloadedPromise(e):this._preloadResource(e)}},_preloadResource:{value:function(e){var t=this,i=new n(function(i,r){var n=new XMLHttpRequest;n.open("GET",e),n.addEventListener("load",i,!1),n.addEventListener("error",i,!1),n.addEventListener("timeout",i,!1),n.timeout=t._SCRIPT_TIMEOUT,n.send(),n.listener=i}).bind(this).then(function(t){this.setResourcePreloaded(e),t.target.removeEventListener("load",t.target.listener),t.target.removeEventListener("error",t.target.listener),t.target.removeEventListener("timeout",t.target.listener)});return this.setResourcePreloadedPromise(e,i),i}},areStylesLoaded:{get:function(){var e,t;if(this._isPollingDocumentStyleSheets&&this._expectedStyles.length>0){e=this._document.styleSheets;for(var i,r=0;i=e[r];r++)t=this._expectedStyles.indexOf(i.href),t>=0&&this._expectedStyles.splice(t,1)}return 0===this._expectedStyles.length}}},{getInstanceForDocument:{value:function(e){var t=e.__montage_resources__;return t||(t=e.__montage_resources__=(new o).initWithDocument(e)),t}}});t.DocumentResources=o}}),montageDefine("b7b5e36","core/meta/model",{dependencies:["../core","./model-group","./object-descriptor","../deprecate","../application","../core","../core","../core","../core"],factory:function(e,t,i){var r=e("../core").Montage,n=e("./model-group").ModelGroup,a=e("./object-descriptor"),o=e("../deprecate"),s=e("../application").application,l=null,u=t.Model=r.specialize({constructor:{value:function(){return this._name=null,this.modelModuleId=null,this.isDefault=!1,this._objectDescriptorForPrototypeTable={},this}},initWithNameAndRequire:{value:function(e,t){if(!e)throw new Error("name is required");if(!t)throw new Error("require is required");return this._name=e,this._require=t,u.group.addModel(this),this}},serializeSelf:{value:function(e){this.version>1&&e.setProperty("version",this.version),e.setProperty("name",this.name),this.objectDescriptors.length>0&&e.setProperty("objectDescriptors",this.objectDescriptors),e.setProperty("objectModelModuleId",this.modelInstanceModuleId)}},deserializeSelf:{value:function(e){var t=e.getProperty("version");void 0!==t&&(this.version=t),t=e.getProperty("name"),void 0!==t&&(this._name=t),t=e.getProperty("objectDescriptors")||e.getProperty("blueprints"),t&&(this._objectDescriptors=t),t=e.getProperty("objectModelModuleId")||e.getProperty("binderModuleId"),void 0!==t&&(this.modelInstanceModuleId=t)}},_name:{value:null},name:{get:function(){return this._name}},_require:{value:null},require:{get:function(){return this._require}},_objectDescriptorForPrototypeTable:{value:null},identifier:{get:function(){return["objectModel",this.name.toLowerCase()].join("_")}},modelInstanceModuleId:{serializable:!1,value:null},isDefault:{serializable:!1,value:!1},_objectDescriptors:{value:null},objectDescriptors:{get:function(){return this._objectDescriptors||(this._objectDescriptors=[])}},addObjectDescriptor:{value:function(e){if(null!==e){var t=this.objectDescriptors.indexOf(e);t<0&&(null!==e.model&&e.model!==this&&e.model.removeObjectDescriptor(e),this.objectDescriptors.push(e),e.model=this)}return e}},removeObjectDescriptor:{value:function(e){if(null!==e){var t=this.objectDescriptors.indexOf(e);t>=0&&(this.objectDescriptors.splice(t,1),e.model=null)}return e}},addObjectDescriptorNamed:{value:function(e){return this.addObjectDescriptor((new a.ObjectDescriptor).initWithName(e))}},objectDescriptorForPrototype:{value:o.deprecateMethod(void 0,function(e){return this.objectDescriptorForName(e)},"objectDescriptorForPrototype","objectDescriptorForName")},objectDescriptorForName:{value:function(e){for(var t=this.objectDescriptors,i=null,r=t.length,n=0;n<r&&!i;n++)t[n].name===e&&(i=t[n]);return i}},_objectDescriptorObjectProperty:{value:null},ObjectProperty:{get:function(){return this._objectDescriptorObjectProperty||(this._objectDescriptorObjectProperty=u.group.defaultObjectDescriptorObjectProperty),this._objectDescriptorObjectProperty}},objectDescriptorModuleId:e("../core")._objectDescriptorModuleIdDescriptor,objectDescriptor:e("../core")._objectDescriptorDescriptor,blueprints:{get:o.deprecateMethod(void 0,function(){return this.objectDescriptors},"blueprints","objectDescriptors")},addBlueprint:{value:o.deprecateMethod(void 0,function(e){return this.addObjectDescriptor(e)},"addBlueprint","addObjectDescriptor")},removeBlueprint:{value:o.deprecateMethod(void 0,function(e){return this.removeObjectDescriptor(e)},"removeBlueprint","removeObjectDescriptor")},addBlueprintNamed:{value:o.deprecateMethod(void 0,function(e){return this.addObjectDescriptorNamed(e)},"addBlueprintNamed","addObjectDescriptorNamed")},blueprintForPrototype:{value:o.deprecateMethod(void 0,function(e){return this.blueprintForName(e)},"blueprintForPrototype","blueprintForName")},blueprintForName:{value:o.deprecateMethod(void 0,function(e){return this.objectDescriptorForName(e)},"blueprintForName","objectDescriptorForName")},blueprintModuleId:e("../core")._objectDescriptorModuleIdDescriptor,blueprint:e("../core")._objectDescriptorDescriptor},{group:{get:function(){return null===l&&(l=new n,l.name=s?s.name:""),l}},manager:{get:o.deprecateMethod(void 0,function(){return t.Model.group},"Binder.manager","Model.group")}})}}),montageDefine("cf0fb3f","ui/slider.reel/slider.html",{text:'<!DOCTYPE html><html><head><meta charset=utf-8><style>.digit-Slider{display:inline-block;-moz-box-sizing:border-box;box-sizing:border-box;width:10em;height:.625em;border-radius:.25em;border:1px solid;outline:none;padding-right:-webkit-calc(1.75em - 2px);padding-right:-moz-calc(1.75em - 2px);padding-right:calc(1.75em - 2px)}.digit-Slider.montage-Slider--vertical{width:.625em;height:10em;margin:0 .625em;padding-right:0;padding-bottom:-webkit-calc(1.75em - 2px);padding-bottom:-moz-calc(1.75em - 2px);padding-bottom:calc(1.75em - 2px)}.digit-Slider-thumb{position:relative;font-size:inherit;-moz-box-sizing:border-box;box-sizing:border-box;width:1.75em;height:1.75em;margin:-.625em 0 0 -1px;border-radius:.875em;border:1px solid;background-color:currentColor;cursor:pointer}.montage-Slider--vertical .digit-Slider-thumb{margin:-1px 0 0 -.625em}.digit-Slider-thumb:after{position:absolute;content:"";top:-16px;left:-16px;bottom:-16px;right:-16px}[data-montage-skin="wireframe"] .digit-Slider{border-color:#b3b3b3;background-color:#d9d9d9}[data-montage-skin="wireframe"] .digit-Slider-thumb{border-color:#b3b3b3;background-color:#f2f2f2}[data-montage-skin="wireframe"] .montage-Slider--active .digit-Slider-thumb{background-color:#e5e5e5}[data-montage-skin="light"] .digit-Slider{border-color:hsla(0,0%,70%,1);background-color:hsl(0,0%,86%);box-shadow:inset 0 1px 2px hsla(0,0%,0%,.1),0 1px 0 hsla(0,0%,100%,.6);-webkit-transform:translate3d(0,0,0);-moz-transform:translate3d(0,0,0);-ms-transform:translate3d(0,0,0);transform:translate3d(0,0,0)}[data-montage-skin="light"] .digit-Slider-thumb{border-color:hsla(0,0%,70%,1);background-image:-webkit-linear-gradient(top,hsl(0,0%,98%),hsl(0,0%,84%));background-image:-moz-linear-gradient(top,hsl(0,0%,98%),hsl(0,0%,84%));background-image:-ms-linear-gradient(top,hsl(0,0%,98%),hsl(0,0%,84%));background-image:linear-gradient(top,hsl(0,0%,98%),hsl(0,0%,84%));box-shadow:inset 0 1px 1px hsla(0,0%,100%,.8),0 1px 2px 0 hsla(0,0%,0%,.1),0 7px 6px -3px hsla(0,0%,0%,.15)}[data-montage-skin="light"] .montage-Slider--active .digit-Slider-thumb{border-color:hsla(0,0%,65%,1);background-image:-webkit-linear-gradient(top,hsl(0,0%,96%),hsl(0,0%,83%));background-image:-moz-linear-gradient(top,hsl(0,0%,96%),hsl(0,0%,83%));background-image:-ms-linear-gradient(top,hsl(0,0%,96%),hsl(0,0%,83%));background-image:linear-gradient(top,hsl(0,0%,96%),hsl(0,0%,83%));box-shadow:inset 0 1px 1px hsla(0,0%,100%,.8),0 1px 2px 0 hsla(0,0%,0%,.2),0 6px 6px -3px hsla(0,0%,0%,.1)}[data-montage-skin="dark"] .digit-Slider{border-color:hsl(0,0%,15%);background-color:hsl(0,0%,22%);box-shadow:inset 0 1px 2px hsla(0,0%,0%,.25),0 1px 0 hsla(0,0%,100%,.1);-webkit-transform:translate3d(0,0,0);-moz-transform:translate3d(0,0,0);-ms-transform:translate3d(0,0,0);transform:translate3d(0,0,0)}[data-montage-skin="dark"] .digit-Slider-thumb{border-color:hsl(0,0%,16%);background-image:-webkit-linear-gradient(top,hsl(0,0%,36%),hsl(0,0%,24%));background-image:-moz-linear-gradient(top,hsl(0,0%,36%),hsl(0,0%,24%));background-image:-ms-linear-gradient(top,hsl(0,0%,36%),hsl(0,0%,24%));background-image:linear-gradient(top,hsl(0,0%,36%),hsl(0,0%,24%));box-shadow:inset 0 1px 1px hsla(0,0%,100%,.1),0 1px 2px 0 hsla(0,0%,0%,.15),0 7px 6px -3px hsla(0,0%,0%,.25)}[data-montage-skin="dark"] .montage-Slider--active .digit-Slider-thumb{border-color:hsl(0,0%,12%);background-image:-webkit-linear-gradient(top,hsl(0,0%,34%),hsl(0,0%,23%));background-image:-moz-linear-gradient(top,hsl(0,0%,34%),hsl(0,0%,23%));background-image:-ms-linear-gradient(top,hsl(0,0%,34%),hsl(0,0%,23%));background-image:linear-gradient(top,hsl(0,0%,34%),hsl(0,0%,23%));box-shadow:inset 0 1px 1px hsla(0,0%,100%,.1),0 1px 2px 0 hsla(0,0%,0%,.2),0 7px 6px -3px hsla(0,0%,0%,.15)}</style><script type=text/montage-serialization>{"owner":{"properties":{"element":{"#":"slider"},"_sliderThumbElement":{"#":"sliderThumb"}}}}</script></head><body><div data-montage-id=slider class=digit-Slider><div data-montage-id=sliderThumb class=digit-Slider-thumb></div></div></body></html>'
}),montageDefine("cf0fb3f","ui/button.reel/button.html",{text:'<!DOCTYPE html><html><head><meta charset=utf-8><style>.digit-Button{display:inline-block;-moz-box-sizing:border-box;box-sizing:border-box;height:2.5em;min-width:2.5em;margin:0 2px;padding:.625em 1em;border-radius:1.25em;vertical-align:middle;font-size:100%;color:inherit;border:1px solid;background-color:transparent;outline:none;cursor:pointer;text-decoration:none;-webkit-tap-highlight-color:transparent}.digit-Button.montage--active{background-color:hsla(0,0%,0%,.06)}.digit-Button:focus{box-shadow:inset 0 0 0 1px}[data-montage-skin="wireframe"] .digit-Button{color:#4D4D4D;border-color:#b3b3b3;background-color:#f2f2f2}[data-montage-skin="wireframe"] .digit-Button.montage--active{background-color:#e5e5e5}[data-montage-skin="wireframe"] .digit-Button:focus{border-color:#4D4D4D;box-shadow:none}[data-montage-skin="light"] .digit-Button{color:hsla(0,0%,0%,.7);text-shadow:0 1px 0 hsla(0,0%,100%,.5);border-color:hsl(0,0%,80%);background-image:-webkit-linear-gradient(top,hsl(0,0%,96%),hsl(0,0%,92%));background-image:-moz-linear-gradient(top,hsl(0,0%,96%),hsl(0,0%,92%));background-image:-ms-linear-gradient(top,hsl(0,0%,96%),hsl(0,0%,92%));background-image:linear-gradient(top,hsl(0,0%,96%),hsl(0,0%,92%));box-shadow:inset 0 1px 1px hsla(0,0%,100%,.8),inset 0 -1px 1px hsla(0,0%,0%,.04),0 1px 0 hsla(0,0%,100%,.6);-webkit-transform:translate3d(0,0,0);-moz-transform:translate3d(0,0,0);-ms-transform:translate3d(0,0,0);transform:translate3d(0,0,0)}[data-montage-skin="light"] .digit-Button.montage--active{border-color:hsla(0,0%,70%,1);background-image:-webkit-linear-gradient(top,hsl(0,0%,90%),hsl(0,0%,86%));background-image:-moz-linear-gradient(top,hsl(0,0%,90%),hsl(0,0%,86%));background-image:-ms-linear-gradient(top,hsl(0,0%,90%),hsl(0,0%,86%));background-image:linear-gradient(top,hsl(0,0%,90%),hsl(0,0%,86%));box-shadow:inset 0 1px 3px hsla(0,0%,0%,.2),0 1px 0 hsla(0,0%,100%,.6)}[data-montage-skin="light"] .digit-Button:focus{border-color:hsl(0,0%,50%)}[data-montage-skin="dark"] .digit-Button{color:hsl(0,0%,80%);text-shadow:0 1px 0 hsla(0,0%,0%,.2);border-color:hsl(0,0%,15%);background-image:-webkit-linear-gradient(top,hsl(0,0%,30%),hsl(0,0%,24%));background-image:-moz-linear-gradient(top,hsl(0,0%,30%),hsl(0,0%,24%));background-image:-ms-linear-gradient(top,hsl(0,0%,30%),hsl(0,0%,24%));background-image:linear-gradient(top,hsl(0,0%,30%),hsl(0,0%,24%));box-shadow:inset 0 1px 1px hsla(0,0%,100%,.1),inset 0 -1px 1px hsla(0,0%,0%,.06),0 1px 0 hsla(0,0%,100%,.1)}[data-montage-skin="dark"] .digit-Button.montage--active{color:hsl(0,0%,60%);border-color:hsl(0,0%,15%);background-image:-webkit-linear-gradient(top,hsl(0,0%,24%),hsl(0,0%,18%));background-image:-moz-linear-gradient(top,hsl(0,0%,24%),hsl(0,0%,18%));background-image:-ms-linear-gradient(top,hsl(0,0%,24%),hsl(0,0%,18%));background-image:linear-gradient(top,hsl(0,0%,24%),hsl(0,0%,18%));box-shadow:inset 0 1px 3px hsla(0,0%,0%,.3),0 1px 0 hsla(0,0%,100%,.1)}[data-montage-skin="dark"] .digit-Button:focus{border-color:hsl(0,0%,50%)}.digit-Button--glass,.digit-Button--glass.montage--active,[data-montage-skin="wireframe"] .digit-Button--glass,[data-montage-skin="wireframe"] .digit-Button--glass.montage--active,[data-montage-skin="light"] .digit-Button--glass,[data-montage-skin="light"] .digit-Button--glass.montage--active,[data-montage-skin="dark"] .digit-Button--glass,[data-montage-skin="dark"] .digit-Button--glass.montage--active{margin:0;border-radius:0;border:none;background:0 0;box-shadow:none}[data-montage-skin="dark"] .digit-Button--glass.montage--active{color:hsla(0,0%,100%,.5)}.digit-ButtonGroup{display:inline-block;vertical-align:middle;padding-left:1px;border-radius:1.25em}.digit-ButtonGroup>.digit-Button{float:left;margin:0 0 0 -1px;border-radius:0}.digit-ButtonGroup>.digit-Button:first-child{border-top-left-radius:inherit;border-bottom-left-radius:inherit}.digit-ButtonGroup>.digit-Button:last-child{border-top-right-radius:inherit;border-bottom-right-radius:inherit}</style></head><body></body></html>'}),montageDefine("cf0fb3f","ui/text-field.reel/text-field.html",{text:'<!DOCTYPE html><html><head><meta charset=utf-8><style>.digit-TextField{outline:none;box-sizing:border-box;font-size:100%;width:10em;height:2.5em;padding:0 .5em;vertical-align:middle;color:inherit;border:1px solid;border-radius:.25em;background-color:transparent;-webkit-tap-highlight-color:transparent;-webkit-appearance:none}.digit-TextField:focus{box-shadow:inset 0 0 0 1px}.digit-TextField.montage--disabled{opacity:.5;border-style:dashed;pointer-events:none}.digit-TextField:invalid{color:#E73525}.digit-TextField[readonly]{background-color:#e5e5e5}.digit-TextField::-webkit-input-placeholder{color:inherit;opacity:.5}.digit-TextField::-moz-placeholder{color:inherit;opacity:.5}.digit-TextField:-ms-input-placeholder{color:inherit;opacity:.5}[data-montage-skin="wireframe"] .digit-TextField{color:#4D4D4D;border-color:#b3b3b3;background-color:#fff}[data-montage-skin="wireframe"] .digit-TextField:focus{border-color:#7f7f7f;box-shadow:none}[data-montage-skin="wireframe"] .digit-TextField:invalid{color:#E73525;border-color:#E73525}[data-montage-skin="light"] .digit-TextField{color:hsla(0,0%,0%,.7);text-shadow:0 1px 0 hsla(0,0%,100%,.5);border-color:hsl(0,0%,80%);background-image:-webkit-linear-gradient(top,hsl(0,0%,96%),hsl(0,0%,98%));background-image:-moz-linear-gradient(top,hsl(0,0%,96%),hsl(0,0%,98%));background-image:-ms-linear-gradient(top,hsl(0,0%,96%),hsl(0,0%,98%));background-image:linear-gradient(top,hsl(0,0%,96%),hsl(0,0%,98%));box-shadow:inset 0 1px 2px hsla(0,0%,0%,.05),0 1px 0 hsla(0,0%,100%,.6);-webkit-transform:translate3d(0,0,0);-moz-transform:translate3d(0,0,0);-ms-transform:translate3d(0,0,0);transform:translate3d(0,0,0)}[data-montage-skin="light"] .digit-TextField:focus{border-color:hsla(0,0%,70%,1);background-image:-webkit-linear-gradient(top,hsl(0,0%,92%),hsl(0,0%,94%));background-image:-moz-linear-gradient(top,hsl(0,0%,92%),hsl(0,0%,94%));background-image:-ms-linear-gradient(top,hsl(0,0%,92%),hsl(0,0%,94%));background-image:linear-gradient(top,hsl(0,0%,92%),hsl(0,0%,94%));box-shadow:inset 0 1px 3px hsla(0,0%,0%,.1),0 1px 0 hsla(0,0%,100%,.6)}[data-montage-skin="light"] .digit-TextField:invalid{color:#E73525;border-color:#E73525}[data-montage-skin="dark"] .digit-TextField{color:hsl(0,0%,80%);text-shadow:0 1px 0 hsla(0,0%,0%,.2);border-color:hsl(0,0%,15%);background-image:-webkit-linear-gradient(top,hsl(0,0%,28%),hsl(0,0%,30%));background-image:-moz-linear-gradient(top,hsl(0,0%,28%),hsl(0,0%,30%));background-image:-ms-linear-gradient(top,hsl(0,0%,28%),hsl(0,0%,30%));background-image:linear-gradient(top,hsl(0,0%,28%),hsl(0,0%,30%));box-shadow:inset 0 1px 2px hsla(0,0%,0%,.1),0 1px 0 hsla(0,0%,100%,.1);-webkit-transform:translate3d(0,0,0);-moz-transform:translate3d(0,0,0);-ms-transform:translate3d(0,0,0);transform:translate3d(0,0,0)}[data-montage-skin="dark"] .digit-TextField:focus{color:hsl(0,0%,100%);border-color:hsl(0,0%,15%);background-image:-webkit-linear-gradient(top,hsl(0,0%,26%),hsl(0,0%,28%));background-image:-moz-linear-gradient(top,hsl(0,0%,26%),hsl(0,0%,28%));background-image:-ms-linear-gradient(top,hsl(0,0%,26%),hsl(0,0%,28%));background-image:linear-gradient(top,hsl(0,0%,26%),hsl(0,0%,28%));box-shadow:inset 0 1px 3px hsla(0,0%,0%,.3),0 1px 0 hsla(0,0%,100%,.1)}[data-montage-skin="dark"] .digit-TextField:invalid{color:#FF6052;border-color:#FF6052}</style><script type=text/montage-serialization>{"owner":{"properties":{"element":{"#":"textField"}}}}</script></head><body><input data-montage-id=textField class=digit-TextField></body></html>'}),montageDefine("b7b5e36","ui/base/abstract-button",{dependencies:["./abstract-control","../../composer/press-composer"],factory:function(e,t,i){var r=e("./abstract-control").AbstractControl,n=e("../../composer/press-composer").PressComposer;t.AbstractButton=r.specialize({constructor:{value:function a(){if(this.constructor===a)throw new Error("AbstractButton cannot be instantiated.");this._pressComposer=new n,this.addComposer(this._pressComposer),this._pressComposer.defineBinding("longPressThreshold ",{"<-":"holdThreshold",source:this}),this.defineBinding("classList.has('montage--disabled')",{"<-":"!enabled"}),this.defineBinding("classList.has('montage--active')",{"<-":"active"})}},enabled:{value:!0},_preventFocus:{value:!1},preventFocus:{get:function(){return this._preventFocus},set:function(e){this._preventFocus=!!e,this.needsDraw=!0}},acceptsActiveTarget:{value:function(){return!this._preventFocus}},willBecomeActiveTarget:{value:function(e){}},_labelNode:{value:void 0,enumerable:!1},_label:{value:void 0,enumerable:!1},label:{get:function(){return this._label},set:function(e){if("undefined"!=typeof e&&this.converter)try{e=this.converter.convert(e),this.error&&(this.error=null)}catch(t){this.error=t}this._label=""+e,this.needsDraw=!0}},holdThreshold:{value:1e3},_pressComposer:{value:null},_active:{value:!1},active:{get:function(){return this._active},set:function(e){this._active=e,this.needsDraw=!0}},prepareForActivationEvents:{value:function(){this._pressComposer.addEventListener("pressStart",this,!1),this._pressComposer.addEventListener("press",this,!1),this._pressComposer.addEventListener("pressCancel",this,!1)}},addEventListener:{value:function(e,t,i){r.prototype.addEventListener.call(this,e,t,i),"longAction"===e&&this._pressComposer.addEventListener("longPress",this,!1)}},handlePressStart:{value:function(e){this.active=!0,e.touch&&document.addEventListener("touchmove",this,!1),this._preventFocus||this._element.focus()}},handlePress:{value:function(e){this.active=!1,this.dispatchActionEvent(),document.removeEventListener("touchmove",this,!1)}},handleKeyup:{value:function(e){32===e.keyCode&&(this.active=!1,this.dispatchActionEvent())}},handleLongPress:{value:function(e){this._pressComposer.cancelPress();var t=document.createEvent("CustomEvent");t.initCustomEvent("longAction",!0,!0,null),this.dispatchEvent(t)}},handlePressCancel:{value:function(e){this.active=!1,document.removeEventListener("touchmove",this,!1)}},handleTouchmove:{value:function(e){e.preventDefault()}},isInputElement:{value:!1},enterDocument:{value:function(e){e&&(this.isInputElement="INPUT"===this.originalElement.tagName,this.isInputElement?void 0===this._label&&(this.label=this.originalElement.value):(this.originalElement.firstChild||this.originalElement.appendChild(document.createTextNode("")),this._labelNode=this.originalElement.firstChild,void 0===this._label&&(this.label=this._labelNode.data)),this.element.setAttribute("role","button"),this.element.addEventListener("keyup",this,!1))}},_drawLabel:{enumerable:!1,value:function(e){this.isInputElement?this._element.value=e:this._labelNode&&(this._labelNode.data=e)}},draw:{value:function(){this._elementNeedsTabIndex()&&(this._preventFocus?this.element.removeAttribute("tabindex"):this.element.setAttribute("tabindex","-1")),this.isInputElement&&(this.element.disabled=!this.enabled),this._drawLabel(this.label)}},_elementNeedsTabIndexRegex:{value:/INPUT|TEXTAREA|A|SELECT|BUTTON|LABEL/},_elementNeedsTabIndex:{value:function(){return null===this.element.tagName.match(this._elementNeedsTabIndexRegex)}}})}}),montageDefine("b7b5e36","ui/base/abstract-text-field",{dependencies:["./abstract-control","../../composer/key-composer","../../core/deprecate"],factory:function(e,t,i){var r=e("./abstract-control").AbstractControl,n=e("../../composer/key-composer").KeyComposer,a=e("../../core/deprecate");t.AbstractTextField=r.specialize({constructor:{value:function o(){if(this.constructor===o)throw new Error("AbstractTextField cannot be instantiated.");this.defineBindings({"classList.has('montage--disabled')":{"<-":"!enabled"}})}},hasTemplate:{value:!1},acceptsActiveTarget:{get:function(){return this.callDelegateMethod("shouldBeginEditing",this)!==!1}},delegate:{value:null},enabled:{value:!0},_placeholder:{value:null},placeholderValue:{set:function(e){a.deprecationWarning("placeholderValue","placeholder"),this.placeholder=e},get:function(){return this.placeholder}},placeholder:{set:function(e){this._placeholder=e,this.needsDraw=!0},get:function(){return this._placeholder}},_value:{value:null},value:{set:function(e){e!==this._value&&(this.hasFocus&&!this.callDelegateMethod("shouldAcceptValue",this,e)||(this._value=e,this.needsDraw=!0))},get:function(){return this._value}},errorMessage:{value:null},converter:{value:null},_hasFocus:{value:!1},hasFocus:{set:function(e){this._hasFocus=e},get:function(){return this._hasFocus}},__keyComposer:{value:null},_keyComposer:{get:function(){return this.__keyComposer||(this.__keyComposer=new n,this.__keyComposer.component=this,this.__keyComposer.keys="enter",this.addComposer(this.__keyComposer)),this.__keyComposer}},handleKeyPress:{value:function(e){this.enabled&&e.keyComposer===this._keyComposer&&this.dispatchActionEvent()}},prepareForActivationEvents:{value:function(){this._keyComposer.addEventListener("keyPress",this,!1)}},enterDocument:{value:function(e){e&&(this.element.addEventListener("input",this,!1),this.element.addEventListener("change",this,!1))}},draw:{value:function(){var e,t=this.value,i=this.element.selectionStart,r=this.element.selectionEnd;this.converter&&(t=this.converter.convert(t)),e=typeof t,null===t||"undefined"===e?this.element.value="":"boolean"===e||"object"===e||"number"===e?this.element.value=t.toString():this.element.value=t,this.eventManager.activeTarget===this&&"function"==typeof this.element.setSelectionRange&&this.element.setSelectionRange(i,r),this._placeholder&&this.element.setAttribute("placeholder",this._placeholder),this.element.disabled=!this.enabled}},handleChange:{value:function(){this._updateValueFromDom()}},handleInput:{value:function(e){this._updateValueFromDom()}},willBecomeActiveTarget:{value:function(e){this.hasFocus=!0,this.callDelegateMethod("didBeginEditing",this)}},surrendersActiveTarget:{value:function(e){return this.callDelegateMethod("shouldEndEditing",this)!==!1&&(this._hasFocus=!1,this.callDelegateMethod("didEndEditing",this),!0)}},_updateValueFromDom:{value:function(){var e,t;if(t=e=this.element.value,this.converter)try{t=this.converter.revert(e),this.errorMessage=null}catch(i){this.errorMessage=i.message||i}this._value!==t&&(this._value=t,this.dispatchOwnPropertyChange("value",this._value),this.callDelegateMethod("didChange",this)),this.converter&&(this.needsDraw=!0)}}})}}),montageDefine("b7b5e36","data/model/enumeration",{dependencies:["core/core"],factory:function(e,t,i){var r=e("core/core").Montage;t.Enumeration=r.specialize({},{specialize:{value:function(e,t,i,r,n){return this._specialize(this._parseSpecializeArguments.apply(this,arguments))}},getterFor:{value:function(e,i,r,n,a,o){var s=this._parseSpecializeArguments.apply(this,Array.prototype.slice.call(arguments,1));return function(){return this.hasOwnProperty(e)||(this[e]=t.Enumeration._specialize(s)),this[e]}}},_parseSpecializeArguments:{value:function(){var e,t,i,r,n,a;for(e=0,Array.isArray(arguments[e])?t=arguments[e]:"string"==typeof arguments[e]&&arguments[e].length>0?t=[arguments[e]]:null===arguments[e]||void 0===arguments[e]||""===arguments[e]?t=[]:(t=[],e-=1),i=Array.isArray(arguments[e+1])&&arguments[e+1],n=e+1,a=arguments.length;!i;n+=1)n!==a&&arguments[n]&&"string"==typeof arguments[n]||(i=Array.prototype.slice.call(arguments,e+1,n),e=n-2);return r=Math.min(arguments.length,e+5),{uniquePropertyNames:t,otherPropertyNames:i,prototypeDescriptor:r>e+3?arguments[e+2]:{},constructorDescriptor:r>e+4?arguments[e+3]:{},constantDescriptors:r>e+2?arguments[r-1]:{}}}},_specialize:{value:function(e){var i,n,a,o,s,l=e.uniquePropertyNames,u=e.otherPropertyNames,c=e.prototypeDescriptor,h=e.constructorDescriptor,d=e.constantDescriptors;for(this._addPropertiesToDescriptor(c,l,u),this._addLookupFunctionsToDescriptor(h,l),this._addConstructorFunctionToDescriptor(h,l,[]),u.length&&this._addConstructorFunctionToDescriptor(h,l,u),i=r.specialize.call(t.Enumeration,c,h),n=this._makeCreateFunction(l,u),o=Object.keys(d),a=0;s=o[a];++a)i[s]=n.apply(i,d[s]);return i}},_addPropertiesToDescriptor:{value:function(e,t,i){var r,n;for(r=0,n=t.length;r<n;r+=1)e[t[r]]||(e[t[r]]={value:void 0});for(r=0,n=i.length;r<n;r+=1)e[i[r]]||(e[i[r]]={value:void 0})}},_addLookupFunctionsToDescriptor:{value:function(e,t){var i,r,n,a;for(n=0,a=t.length;n<a;n+=1)i="for"+t[n][0].toUpperCase()+t[n].slice(1),r=this._makeLookupFunction(t[n]),e[i]={value:r}}},_makeLookupFunction:{value:function(e){return function(t){return this._instances&&this._instances[e]&&this._instances[e][t]}}},_addConstructorFunctionToDescriptor:{value:function(e,t,i){var r,n,a,o;if(t.length||i.length){for(r=this._makeCreateFunction(t,i),n=["with"],a=0,o=t.length;a<o;a+=1)n.push(t[a][0].toUpperCase()),n.push(t[a].slice(1));for(a=0,o=i.length;a<o;a+=1)n.push(i[a][0].toUpperCase()),n.push(i[a].slice(1));n.length>3&&n.splice(n.length-2,0,"And"),e[n.join("")]={value:r}}}},_makeCreateFunction:{value:function(e,t){var i=this;return function(r,n){var a=i._parseCreateArguments(e,t,arguments);return i._create(this,e,t,a)}}},_parseCreateArguments:{value:function(e,t,i){var r=e.length+t.length;return{propertyValues:Array.prototype.slice.call(i,0,r),propertyDescriptors:i[r]||{}}}},_create:{value:function(e,t,i,n){var a,o,s,l,u;for(a=new e,r.defineProperties(a,n.propertyDescriptors),s=0,u=t.length,l=i.length;s<u+l;s+=1)o=s<u?t[s]:i[s-u],a[o]=n.propertyValues[s];for(s=0,u=t.length;s<u;s+=1)e._instances=e._instances||{},e._instances[t[s]]=e._instances[t[s]]||{},e._instances[t[s]][n.propertyValues[s]]=a;return a}}})}}),montageDefine("b7b5e36","core/criteria",{dependencies:["./core","frb/parse","frb/stringify","frb/evaluate","frb/language","frb/scope","frb/compile-evaluator"],factory:function(e,t,i){var r=e("./core").Montage,n=e("frb/parse"),a=e("frb/stringify"),o=(e("frb/evaluate"),e("frb/language").precedence),s=e("frb/scope"),l=e("frb/compile-evaluator"),u=t.Criteria=r.specialize({_expression:{value:null},expression:{get:function(){return this._expression}},parameters:{value:null},_syntax:{value:null},syntax:{get:function(){return this._syntax||(this._syntax=n(this._expression))}},_compiledSyntax:{value:null},compiledSyntax:{get:function(){return this._compiledSyntax||(this._compiledSyntax=l(this.syntax))}},initWithSyntax:{value:function(e,t){return this._syntax=e,this.parameters=t,this}},initWithExpression:{value:function(e,t){return this._expression=e,this.parameters=t,this}},initWithPath:{value:function(e){return this.initWithExpression(e)}},criteriaWithParameters:{value:function(e){var t=(new this.constructor).initWithExpression(this.expression);return t.parameters=e,t}},serializeSelf:{value:function(e){e.setProperty("expression",this._expression||(this._expression=a(this.syntax))),e.setProperty("parameters",this.parameters)}},deserializeSelf:{value:function(e){var t;t=e.getProperty("expression")||e.getProperty("path"),void 0!==t&&(this._expression=t),t=e.getProperty("parameters"),void 0!==t&&(this.parameters=t)}},__scope:{value:null},_scope:{get:function(){return this.__scope||(this.__scope=new s)}},evaluate:{value:function(e,t){return this._scope.parameters=t||this.parameters,this._scope.value=e,this.compiledSyntax(this._scope)}}},{forObjectsLike:{value:function(e){var t,i,r,n,a,o,s,l=Object.keys(e),u="";for(t=0;i=l[t];t++)if(r=e[i],Array.isArray(r)){for(o="",n=0;a=r[n];n++)s=i,s+=n,o.length>0&&(o+=" && "),o+=i,o+=".has($",o+=s,o+=")",e[s]=a;u.length>0&&(u+=" && "),u+=o}else u.length>0&&(u+=" && "),u+=i,u+="== $",u+=i;return(new this).initWithExpression(u,e)}},withExpression:{value:function(e,t){return(new this).initWithExpression(e,t)}},withSyntax:{value:function(e,t){return(new this).initWithSyntax(e,t)}}});o.forEach(function(e,t,i){r.defineProperty(u.prototype,t,{value:function(){var e=Array.prototype.map.call(arguments,function(e){return"string"==typeof e?n(e):e.syntax?e.syntax:"object"==typeof e?e:void 0});return(new this.constructor).initWithSyntax({type:t,args:[this.syntax].concat(e)})}}),r.defineProperty(u,t,{value:function(){var e=Array.prototype.map.call(arguments,function(e){return"string"==typeof e?n(e):e.syntax?e.syntax:"object"==typeof e?e:void 0});return(new this).initWithSyntax({type:t,args:e})}})})}}),montageDefine("b7b5e36","core/meta/model-group",{dependencies:["../core","./model","./object-property","../deprecate"],factory:function(e,t,i){var r=e("../core").Montage,n=e("./model"),a=e("./object-property").ObjectProperty,o=e("../deprecate");t.ModelGroup=r.specialize({constructor:{value:function(){this._models=[],this._modelTable={}}},_name:{value:null},name:{get:function(){return this._name},set:function(e){e!==this._name&&(this._name=e)}},_models:{value:null},_modelTable:{value:null},models:{get:function(){return this._models}},addModel:{value:function(e){var t;null!==e&&(this._modelTable[e.name]&&this.removeModel(this._modelTable[e.name]),t=this._models.indexOf(e),t>=0&&this._models.splice(t,1),this._models.push(e),this._modelTable[e.name]=e)}},removeModel:{value:function(e){var t;null!==e&&(t=this._models.indexOf(e),t>=0&&this._models.splice(t,1),this._modelTable[e.name]&&delete this._modelTable[e.name])}},modelForName:{value:function(e){return this._modelTable[e]}},objectDescriptorForPrototype:{value:function(e,t){var i,r,n=null;for(r=0;"undefined"!=typeof(i=this.models[r])&&!n;r++)n=i.objectDescriptorForName(e);return n}},_defaultObjectDescriptorObjectProperty:{serializable:!0,value:null},defaultObjectDescriptorObjectProperty:{get:function(){return this._defaultObjectDescriptorObjectProperty||(this._defaultObjectDescriptorObjectProperty=(new a).init()),this._defaultObjectDescriptorObjectProperty}},_defaultModel:{serializable:!0,value:null},defaultModel:{get:function(){if(!this._defaultModel){var t=global.mr||e;this._defaultModel=(new n.Model).initWithNameAndRequire("default",t),this._defaultModel.isDefault=!0,this.addModel(this._defaultModel)}return this._defaultModel}},binders:{get:o.deprecateMethod(void 0,function(){return this.models},"binders","models")},addBinder:{value:o.deprecateMethod(void 0,function(e){this.addModel(e)},"addBinder","addModel")},removeBinder:{value:o.deprecateMethod(void 0,function(e){return this.removeModel(e)},"removeBinder","removeModel")},binderForName:{value:o.deprecateMethod(void 0,function(e){return this.modelForName(e)},"binderForName","modelForName")},blueprintForPrototype:{value:o.deprecateMethod(void 0,function(e,t){return this.objectDescriptorForPrototype(e)},"blueprintForPrototype","objectDescriptorForPrototype")},defaultBlueprintObjectProperty:{get:o.deprecateMethod(void 0,function(){return this.defaultObjectDescriptorObjectProperty},"defaultBlueprintObjectProperty","defaultObjectDescriptorObjectProperty")},defaultBinder:{get:o.deprecateMethod(void 0,function(){return this.defaultModel},"defaultBinder","defaultModel")}})}}),montageDefine("b7b5e36","composer/key-composer",{dependencies:["../core/core","./composer"],factory:function(e,t,i){var r=e("../core/core").Montage,n=e("./composer").Composer,a=null,o=r.specialize({_defaultKeyManager:{value:null},_loadingDefaultKeyManager:{value:!1},_keysToRegister:{value:[]},registerKey:{value:function(t){var i=this;this._defaultKeyManager?this._defaultKeyManager.registerKey(t):(this._keysToRegister.push(t),this._loadingDefaultKeyManager||(this._loadingDefaultKeyManager=!0,e.async("core/event/key-manager").then(function(e){var t=i._defaultKeyManager=e.defaultKeyManager;i._keysToRegister.forEach(function(e){t.registerKey(e)}),i._keysToRegister.length=0})))}},unregisterKey:{value:function(e){this._defaultKeyManager&&this._defaultKeyManager.unregisterKey(e)}}},{defaultKeyManager:{get:function(){return a||(a=new o),this._defaultKeyManager?this._defaultKeyManager:a}}}),s="keyPress",l="longKeyPress",u="keyRelease",c=t.KeyComposer=n.specialize({_shouldDispatchEvent:{value:!1},shouldDispatchLongPress:{value:!1},_longPressTimeout:{value:null},_keyRegistered:{value:!1},_keys:{value:null},keys:{get:function(){return this._keys},set:function(e){this._keyRegistered?(o.defaultKeyManager.unregisterKey(this),this._keys=e,o.defaultKeyManager.registerKey(this)):this._keys=e}},load:{value:function(){this._shouldDispatchEvent&&!this._keyRegistered&&(o.defaultKeyManager.registerKey(this),this._keyRegistered=!0)}},unload:{value:function(){o.defaultKeyManager.unregisterKey(this),this._keyRegistered=!1}},addEventListener:{value:function(e,t,i){var r=this.component;n.prototype.addEventListener.call(this,e,t,i),e!==s&&e!==l&&e!==u||(this._shouldDispatchEvent=!0,e===l&&(this._shouldDispatchLongPress=!0),this._isLoaded?this._keyRegistered||(o.defaultKeyManager.registerKey(this),this._keyRegistered=!0):r&&"function"!=typeof r.addComposer&&(this.element||(this.element=window),this.component.loadComposer(this)))}},deserializedFromTemplate:{value:function(){var e=this.component;null===this.identifier&&(this.identifier=r.getInfoForObject(this).label),e&&("function"==typeof e.addComposer?e.addComposer(this):this._isLoaded||(this.element||(this.element=window),this.component.loadComposer(this)))}}},{createKey:{value:function(e,t,i){var r=this;return this===c&&(r=new c),i||(i=e.identifier?e.identifier+t.toLowerCase().replace(/[ +]/g).toCapitalized():t.toLowerCase().replace(/[ +]/g)),r.keys=t,r.identifier=i,e.addComposer(r),r}},createGlobalKey:{value:function(e,t,i){var r=this;return this===c&&(r=new c),r.keys=t,r.identifier=i,e.addComposerForElement(r,window),r}}})}}),montageDefine("b7b5e36","window-loader/montage-window",{dependencies:["../core/core"],factory:function(e,t,i){var r=e("../core/core").Montage;t.MontageWindow=r.specialize({_application:{value:null},application:{get:function(){return this._application},set:function(e){null===this._application&&(this._application=e,this.focused&&this._setFocusedWindow(this))}},_window:{value:null},window:{get:function(){return this._window},set:function(e){if(null===this._window){var t=e.document.body;this._window=e,e.addEventListener("beforeunload",this,!0),e.addEventListener("focus",this,!0),e.addEventListener("mousedown",this,!0),null===t.getAttribute("tabIndex")&&(t.setAttribute("tabIndex",-1),t.focus())}}},document:{get:function(){return this._window.document}},_component:{value:null},component:{get:function(){return this._component},set:function(e){null===this._component&&(this._component=e)}},title:{get:function(){return this.document.title},set:function(e){this.document.title=e}},focused:{value:!1},focus:{value:function(){this._window&&this._window.focus()}},_setFocusedWindow:{value:function(e){var t,i,r,n=this.application;if(n._multipleWindow){t=n.windows;for(r in t)t.hasOwnProperty(r)&&(i=t[r],i.window===e?i.focused!==!0&&(i.focused=!0,"z-order"===n.windowsSortOrder?(t.splice(r,1),t.unshift(i)):"reverse-z-order"===n.windowsSortOrder&&(t.splice(r,1),t.push(i))):i.focused=!1)}else this.focused=!0}},closed:{get:function(){return!!this._window&&this._window.closed}},close:{value:function(){this._window&&this._window.close()}},resizeTo:{value:function(e,t){this._window&&this._window.resizeTo(e,t)}},moveTo:{value:function(e,t){this._window&&this._window.moveTo(e,t)}},captureFocus:{value:function(e){var t=this.application;if(!this.application)return void(this.focused=!0);if(t.parentApplication)t.mainApplication.window.captureFocus(e);else{var i=(e.target.ownerDocument?e.target.ownerDocument.defaultView:null)||e.target.defaultView||e.target;this._setFocusedWindow(i)}}},captureMousedown:{value:function(e){this.captureFocus(e)}},captureBeforeunload:{value:function(e){var t,i=this.application,r=i.windows,n=i.attachedWindows;i.attachedWindows=[];for(t in n)n.hasOwnProperty(t)&&n[t].close();i.parentApplication&&(n=i.parentApplication.attachedWindows,t=n.indexOf(this),t!==-1&&n.splice(t,1),t=r.indexOf(this),t!==-1&&r.splice(t,1),this.window.removeEventListener("beforeunload",this,!0),this.close())}}})}}),montageDefine("b7b5e36","data/service/data-stream",{dependencies:["data/service/data-provider","data/model/data-object-descriptor","data/model/data-query","core/promise","core/deprecate","frb/parse","frb/scope","frb/compile-evaluator"],factory:function(e,t,i){var r=e("data/service/data-provider").DataProvider,n=e("data/model/data-object-descriptor").DataObjectDescriptor,a=e("data/model/data-query").DataQuery,o=e("core/promise").Promise,s=e("core/deprecate"),l=e("frb/parse"),u=e("frb/scope"),c=e("frb/compile-evaluator");t.DataStream=r.specialize({query:{value:void 0},selector:{get:s.deprecateMethod(void 0,function(){return this.query},"selector","query"),set:s.deprecateMethod(void 0,function(e){this.query=e},"selector","query")},data:{get:function(){return this._data||(this._data=[]),this._data}},requestData:{value:function(e,t){return this}},_resolve:{value:function(e){this.__promise||(this.__promise=o.resolve(e))}},_reject:{value:function(e){this.__promise||(this.__promise=function(){return o.reject(e)})}},_promise:{get:function(){var e=this;return"function"==typeof this.__promise?this.__promise=this.__promise():this.__promise||(this.__promise=new o(function(t,i){e._resolve=t,e._reject=i})),this.__promise}},then:{value:function(e,t){return this._promise.then(e,t)}},"catch":{value:function(e){return this._promise["catch"](e)}},addData:{value:function(e){var t=e;this.dataExpression&&e&&(t=this._compiledDataExpression(new u(e))),t&&Array.isArray(t)?this.data.push.apply(this.data,t):t&&this.data.push(t)}},dataDone:{value:function(){this._resolve(this.data),delete this._resolve,delete this._reject}},dataError:{value:function(e){this._reject(e),delete this._reject,delete this._resolve}},_compiledDataExpression:{get:function(){return this.__compiledDataExpression||(this.__compiledDataExpression=c(this._dataExpressionSyntax))}},_dataExpressionSyntax:{get:function(){return this.__dataExpressionSyntax||(this.__dataExpressionSyntax=l(this.dataExpression))}},dataExpression:{value:void 0},evaluateDataExpression:{value:function(e){return this._compiledDataExpression(e)}},dataReceptionTime:{value:void 0},_dataMaxAge:{value:void 0},dataMaxAge:{get:function(){return this._dataMaxAge||this.query.type.maxAge},set:function(e){this._dataMaxAge=e}}},{withTypeOrSelector:{value:function(e){var t=e instanceof n&&e,i=t&&a.withTypeAndCriteria(t)||e,r=new this;return r.query=i,r}}})}}),montageDefine("b7b5e36","core/meta/validation-rule",{dependencies:["../core","./validation-semantics","../selector","../deprecate","../core","../core","../core","../core"],factory:function(e,t,i){var r=e("../core").Montage,n=e("./validation-semantics").PropertyValidationSemantics,a=e("../selector").Selector,o=e("../deprecate");t.PropertyValidationRule=r.specialize({initWithNameAndObjectDescriptor:{value:function(e,t){return this._name=e,this._owner=t,this}},serializeSelf:{value:function(e){e.setProperty("name",this.name),e.setProperty("objectDescriptor",this.owner,"reference"),e.setProperty("messageKey",this.messageKey),e.setAllValues()}},deserializeSelf:{value:function(e){var t;t=e.getProperty("name"),void 0!==t&&(this._name=t),t=e.getProperty("objectDescriptor")||e.getProperty("blueprint"),void 0!==t&&(this._owner=t),t=e.getProperty("messageKey"),void 0!==t&&(this._messageKey=t);for(var i=r.getSerializablePropertyNames(this),n=0,a=i.length;n<a;n++){var o=i[n];this[o]=e.getProperty(o)}}},_owner:{value:null},owner:{get:function(){return this._owner}},identifier:{get:function(){return[this.objectDescriptor.identifier,"rule",this.name].join("_")}},_name:{value:""},name:{get:function(){return this._name}},_validationSelector:{value:null},validationSelector:{serializable:!1,get:function(){return this._validationSelector||(this._validationSelector=a["false"]),this._validationSelector},set:function(e){this._validationSelector=e}},_messageKey:{value:""},messageKey:{serializable:!1,get:function(){return this._messageKey&&0!==this._messageKey.length?this._messageKey:this._name},set:function(e){this._messageKey=e}},_propertyValidationEvaluator:{value:null
},evaluateRule:{value:function(e){if(null===this._propertyValidationEvaluator){var t=(new n).initWithBlueprint(this.objectDescriptor);this._propertyValidationEvaluator=t.compile(this.selector.syntax)}return this._propertyValidationEvaluator(e)}},objectDescriptorModuleId:e("../core")._objectDescriptorModuleIdDescriptor,objectDescriptor:e("../core")._objectDescriptorDescriptor,initWithNameAndBlueprint:{value:o.deprecateMethod(void 0,function(e,t){return this.initWithNameAndObjectDescriptor(e,t)},"initWithNameAndBlueprint","initWithNameAndObjectDescriptor")},blueprintModuleId:e("../core")._objectDescriptorModuleIdDescriptor,blueprint:e("../core")._objectDescriptorDescriptor})}}),montageDefine("cf0fb3f","package.json",{exports:{name:"digit",description:"Touch-optimized MontageJS components for tablets and phones.",version:"3.0.0",license:"BSD-3-Clause",repository:{type:"git",url:"git+https://github.com/montagejs/digit.git"},dependencies:{montage:"^17.0.7"},devDependencies:{concurrently:"^3.4.0","http-server":"^0.9.0","jasmine-console-reporter":"^1.2.7","jasmine-core":"^2.5.2",karma:"^1.5.0","karma-chrome-launcher":"^2.0.0","karma-coverage":"^1.1.1","karma-firefox-launcher":"^1.0.1","karma-jasmine":"^1.1.0","karma-phantomjs-launcher":"^1.0.2","montage-testing":"git://github.com/montagejs/montage-testing.git#master",open:"0.0.5"},scripts:{test:"node test/run-node.js","test:karma":"karma start --no-auto-watch --single-run","test:karma-dev":"karma start --auto-watch --no-single-run","test:jasmine":'concurrently "http-server -a localhost -p 8085" "open http://localhost:8085/test/run.html"',"start:demo":'concurrently "http-server -a localhost -p 8085" "open http://localhost:8085/demo/sizing/index.html"',"start:overview":'concurrently "http-server -a localhost -p 8085" "open http://localhost:8085/overview/index.html"'},exclude:["overview","test"],gitHead:"a46d7aa68cbf985e6f4b322096a1e2a022c14035",bugs:{url:"https://github.com/montagejs/digit/issues"},homepage:"https://github.com/montagejs/digit#readme",_id:"digit@3.0.0",_shasum:"1d2be43a34f5aa1684c22934a4b2b6b5f80638f0",_from:"digit@>=3.0.0 <4.0.0",_npmVersion:"2.15.11",_nodeVersion:"4.8.0",_npmUser:{name:"hthetiot",email:"hthetiot@gmail.com"},dist:{shasum:"1d2be43a34f5aa1684c22934a4b2b6b5f80638f0",tarball:"https://registry.npmjs.org/digit/-/digit-3.0.0.tgz"},maintainers:[{name:"francoisfrisch",email:"francoisfrisch@gmail.com"},{name:"hthetiot",email:"hthetiot@gmail.com"},{name:"marchant",email:"benoit@montagestudio.com"},{name:"montage-bot",email:"francoisfrisch@gmail.com"}],_npmOperationalInternal:{host:"s3://npm-registry-packages",tmp:"tmp/digit-3.0.0.tgz_1495575626923_0.7017284843605012"},directories:{},_resolved:"https://registry.npmjs.org/digit/-/digit-3.0.0.tgz",main:"index",hash:"cf0fb3f",mappings:{montage:{name:"montage",hash:"b7b5e36",location:"../montage@b7b5e36/"}},production:!0,useScriptInjection:!0}}),montageDefine("b7b5e36","core/extras/dom",{dependencies:[],factory:function(e,t,i){if("undefined"!=typeof Node){var r=Node.prototype;r.get=function(e){return this.getAttribute(e)||this[e]},r.parentOf=function(e){do e=e.parentNode;while(e&&e!==this);return!!e}}if("undefined"!=typeof Element){var n=Element.prototype;Object.defineProperty(n,"set",{value:function(e,t,i){var r,n,a,o,s,l=e.indexOf(".",i);i=i||0,n=e.substring(i,l===-1?e.length:l),l===-1?this.setAttribute(n,t):(a=e.lastIndexOf("."),"style"===n?(o=e.substring(l+1,e.length),this.style[o]=t):"classList"===n?(s=e.substring(l+1,e.length),t?this.classList.add(s):this.classList.remove(s)):(r=this.get(e.substring(0,a)))&&(r[e.substring(a+1,e.length)]=t))},enumerable:!1});var a="classList";if(!n.hasOwnProperty(a)){var o=/^\s+|\s+$/g,s=function(e,t){e.setAttribute("class",t.join(" "))},l=function(e,t){if(""===t)throw"SYNTAX_ERR";if(/\s/.test(t))throw"INVALID_CHARACTER_ERR";return e.indexOf(t)},u=function(){var e=this,t=e.getAttribute("class")||"";return t=t.replace(o,"").split(/\s+/),{length:t.length,item:function(e){return t[e]||null},contains:function(e){return l(t,e)!==-1},add:function(i){l(t,i)===-1&&(t.push(i),this.length=t.length,s(e,t))},remove:function(i){var r=l(t,i);r!==-1&&(t.splice(r,1),this.length=t.length,s(e,t))},toggle:function(e){l(t,e)===-1?this.add(e):this.remove(e)},toString:function(){return e.getAttribute("class")||""}}};Object.defineProperty?Object.defineProperty(n,a,{get:u,enumerable:!0}):Object.prototype.__defineGetter__&&n.__defineGetter__(a,u)}}if("undefined"!=typeof Node){var c=Object.getPrototypeOf(document);c.addRule=function(e,t){var i,r;if(i=document.styleSheets[0])r=document.getRule(e,i);else{var n=document.createElement("style");n.type="text/css",document.head.appendChild(n),i=document.styleSheets[0]}r||i.insertRule(e+" "+t,i.cssRules.length)},c.getRule=function(e,t){var i;if(t.cssRules)for(var r=0;i=t.cssRules[r];r++){if(i.name&&i.name===e)return i;if(i.selectorText===e)return i}}}if("undefined"!=typeof DOMTokenList){var h=window.DOMTokenList.prototype;"undefined"==typeof h.has&&Object.defineProperty(h,"has",{value:function(e){return this.contains(e)}})}}}),montageDefine("24e6f9c","ui/converter.reel/converter.html",{text:'<!DOCTYPE html><html><head><title></title><style>.Converter{margin:20px auto;padding:20px;width:300px;border-radius:10px;background-color:hsl(0,0%,98%);box-shadow:inset 0 1px 2px 1px hsla(0,0%,100%,1),0 2px 5px hsla(0,0%,0%,.1)}.Converter:after{content:"";display:block;clear:both}.Numbers{float:left;border:none;margin:0;padding:0}.Label{margin:15px 0;line-height:40px;font-size:1.2em}.Label .digit-NumberField-input{width:70px;vertical-align:middle}.Slider{float:right;margin:0;padding:8px 4px;border-radius:100px;border:none;box-shadow:inset 0 1px 3px hsla(0,0%,0%,.3),0 2px 0 hsla(0,0%,100%,1);background:-webkit-linear-gradient(bottom,hsl(200,100%,50%),hsl(200,100%,80%)30%,hsl(60,100%,65%)50%,hsl(0,100%,80%)70%,hsl(0,100%,50%));background:linear-gradient(to top,hsl(200,100%,50%),hsl(200,100%,80%)30%,hsl(60,100%,65%)50%,hsl(0,100%,80%)70%,hsl(0,100%,50%))}.Slider-handle.digit-Slider.montage-Slider--vertical{height:120px}.Slider-handle.digit-Slider{background-color:transparent;border-color:transparent;box-shadow:none}</style><script type=text/montage-serialization>{"owner":{"properties":{"element":{"#":"owner"}}},"celsiusNumberfield":{"prototype":"digit/ui/number-field.reel","properties":{"element":{"#":"celsius"}},"bindings":{"value":{"<->":"(+@fahrenheitNumberfield.value - 32) / 1.8"}}},"fahrenheitNumberfield":{"prototype":"digit/ui/number-field.reel","properties":{"element":{"#":"fahrenheit"}},"bindings":{"value":{"<->":"@owner.weatherReport.temp"}}},"thermometer":{"prototype":"digit/ui/slider.reel","properties":{"element":{"#":"thermometer"},"axis":"vertical"},"bindings":{"value":{"<->":"@fahrenheitNumberfield.value"}}}}</script></head><body><div data-montage-id=owner class=Converter><fieldset class=Numbers><div class=Label>C <input data-montage-id=celsius></div><div class=Label>F <input data-montage-id=fahrenheit></div></fieldset><fieldset class=Slider><input data-montage-id=thermometer class=Slider-handle type=range min=-13 max=122></fieldset></div></body></html>'}),montageDefine("b7b5e36","core/meta/event-descriptor",{dependencies:["../core","../logger","../deprecate","../core","../core","../core","../core"],factory:function(e,t,i){var r=e("../core").Montage,n=(e("../logger").logger("objectDescriptor"),e("../deprecate")),a={name:"default",detailKeys:[],detailValueTypes:[],helpKey:""};t.EventDescriptor=r.specialize({constructor:{value:function(){this._detailKeys=[]}},initWithNameAndObjectDescriptor:{value:function(e,t){return this._name=null!==e?e:a.name,this._owner=t,this}},initWithNameAndBlueprint:{value:n.deprecateMethod(void 0,function(e,t){return this.initWithNameAndObjectDescriptor(e,t)},"new EventBlueprint().initWithNameAndBlueprint","new EventDescriptor().initWithNameAndObjectDescriptor")},serializeSelf:{value:function(e){e.setProperty("name",this.name),e.setProperty("objectDescriptor",this._owner,"reference"),this.detailKeys.length>0&&this._setPropertyWithDefaults(e,"detailKeys",this.detailKeys),this._setPropertyWithDefaults(e,"helpKey",this.helpKey)}},deserializeSelf:{value:function(e){var t;t=e.getProperty("name"),void 0!==t&&(this._name=t),t=e.getProperty("objectDescriptor")||e.getProperty("blueprint"),void 0!==t&&(this._owner=t),this.detailKeys=this._getPropertyWithDefaults(e,"detailKeys"),this.helpKey=this._getPropertyWithDefaults(e,"helpKey")}},_setPropertyWithDefaults:{value:function(e,t,i){i!==a[t]&&e.setProperty(t,i)}},_getPropertyWithDefaults:{value:function(e,t){var i=e.getProperty(t)||this[t];return i||this[t]||a[t]}},_owner:{value:null},owner:{get:function(){return this._owner}},_name:{value:null},name:{serializable:!1,get:function(){return this._name}},identifier:{get:function(){return[this.owner.identifier,this.name].join("_")}},_detailKeys:{value:null},detailKeys:{get:function(){return this._detailKeys},set:function(e){Array.isArray(e)&&(this._detailKeys=e)}},helpKey:{value:a.helpKey},objectDescriptorModuleId:e("../core")._objectDescriptorModuleIdDescriptor,objectDescriptor:e("../core")._objectDescriptorDescriptor,blueprintModuleId:e("../core")._blueprintModuleIdDescriptor,blueprint:e("../core")._blueprintDescriptor})}}),montageDefine("24e6f9c","logic/service/remote-data-service",{dependencies:["montage/data/service/http-service","montage/data/model/data-object-descriptor","montage/core/serialization/serializer/montage-serializer","montage/core/serialization/deserializer/montage-deserializer"],factory:function(e,t,i){var r=e("montage/data/service/http-service").HttpService,n=(e("montage/data/model/data-object-descriptor").DataObjectDescriptor,e("montage/core/serialization/serializer/montage-serializer").serialize),a=e("montage/core/serialization/deserializer/montage-deserializer").deserialize;t.RemoteDataService=r.specialize({ENDPOINT:{value:"https://localhost:8080"},fetchRawData:{value:function(e){return this.fetchRawDataWithQuery(e)}},mapFromRawData:{value:function(e,t,i){e.temp=t[0].temp}},fetchRawDataWithQuery:{value:function(e){var t=this,i=e.selector.criteria,r=e.selector.type,n=e.selector,a=t.ENDPOINT,o=this._getQuery(i,r,n);return a+="?query="+o,t.fetchHttpRawData(a,!1).then(function(r){r&&(t.addRawData(e,[r],i),t.rawDataDone(e))})}},fetchRawDataWithBody:{value:function(e){var t=this,i=e.selector.criteria,r=e.selector.type,n=e.selector,a=t.ENDPOINT,o=this._getQuery(i,r,n);return t.fetchHttpRawData(a,o,!1).then(function(r){r&&(t.addRawData(e,[r],i),t.rawDataDone(e))})}},fetchRawDataUsingParams:{value:function(e){var t=this,i=e.selector.criteria,r=e.selector.type,n=e.selector,a=t.ENDPOINT;return a+=this._getUrlQueryParams(i,r,n),t.fetchHttpRawData(a,!1).then(function(r){r&&(t.addRawData(e,[r],i),t.rawDataDone(e))})}},_getQuery:{value:function(t,i,r){var o=n(r,e);return a(o,e).then(function(e){}),encodeURIComponent(o)}},_getUrlQueryParams:{value:function(t,i,r){var a=i._montage_metadata.module,o=i._montage_metadata.property;return n(r,e),"?parameters="+encodeURIComponent(JSON.stringify(t.parameters))+"&module="+encodeURIComponent(a)+"&moduleName="+encodeURIComponent(o)+"&expression="+encodeURIComponent(t.expression)}}})}}),montageDefine("cf0fb3f","ui/number-field.reel/number-field.html",{text:'<!DOCTYPE html><html><head><meta charset=utf-8><style>.digit-NumberField{box-sizing:border-box;position:relative;display:inline-block;width:auto;margin:0 4px;vertical-align:middle;outline:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.digit-NumberField>.digit-NumberField-input{float:left;width:3.75em;border-radius:0;text-align:center}.digit-NumberField>.digit-NumberField-plus,.digit-NumberField>.digit-NumberField-minus{float:left;margin:0;padding:2px;-webkit-transform:translate3d(0,0,0);-moz-transform:translate3d(0,0,0);-ms-transform:translate3d(0,0,0);transform:translate3d(0,0,0);-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.digit-NumberField>.digit-NumberField-plus{border-width:1px 1px 1px 0;border-radius:0 2.5em 2.5em 0}.digit-NumberField>.digit-NumberField-minus{border-width:1px 0 1px 1px;border-radius:2.5em 0 0 2.5em}</style><script type=text/montage-serialization>{"owner":{"properties":{"element":{"#":"numberField"},"_numberFieldTextFieldComponent":{"@":"textField"},"_numberFieldMinusComponent":{"@":"minus"},"_numberFieldPlusComponent":{"@":"plus"}}},"textField":{"prototype":"ui/text-field.reel","properties":{"element":{"#":"textField"}},"bindings":{"value":{"<->":"@owner.value"}}},"plus":{"prototype":"ui/button.reel","properties":{"element":{"#":"buttonPlus"}}},"minus":{"prototype":"ui/button.reel","properties":{"element":{"#":"buttonMinus"}}}}</script></head><body><span data-montage-id=numberField class=digit-NumberField><button data-montage-id=buttonMinus class=digit-NumberField-minus tabindex=-1></button> <input data-montage-id=textField class=digit-NumberField-input> <button data-montage-id=buttonPlus class=digit-NumberField-plus tabindex=-1>+</button></span></body></html>'}),montageDefine("b7b5e36","data/model/data-object-descriptor",{dependencies:["./object-descriptor","./data-property-descriptor"],factory:function(e,t,i){var r=e("./object-descriptor").ObjectDescriptor,n=e("./data-property-descriptor").DataPropertyDescriptor;t.DataObjectDescriptor=r.specialize({identifierNames:{value:[]},propertyDescriptors:{get:function(){return Object.getOwnPropertyDescriptor(r.prototype,"propertyDescriptors").get.call(this)}},setPropertyDescriptor:{value:function(e,t){r.prototype.setPropertyDescriptor.call(this,e,t)}},makePropertyDescriptor:{value:function(){return new n}},_addRelationships:{value:function(e){var t,i,r;if(e)for(t=Object.keys(e),i=0,r=t.length;i<r;i+=1)this._addRelationship(t[i],e[t[i]])}},_addRelationship:{value:function(e,t){this.propertyDescriptors[e]||this.setPropertyDescriptor(e,this.makePropertyDescriptor()),this.propertyDescriptors[e].isRelationship=!0,this.propertyDescriptors[e].isGlobal=!!t.isGlobal}}},{getterFor:{value:function(e,t,i,n,a){var o=this._parseGetterForArguments.apply(this,arguments),s=r.getterFor.call(this,o.exports,o.name,o.types);return function(){return this.hasOwnProperty("_TYPE")||(this._TYPE=s.call(this),this._TYPE.identifierNames=o.identifiers,this._TYPE._addRelationships(o.relationships)),this._TYPE}}},_parseGetterForArguments:{value:function(){var e,t,i,r;if(e={exports:arguments[0],name:arguments[1]},arguments.length>3&&this._isRealObject(arguments[2])?(e.types=arguments[2],t=3):t=2,Array.isArray(arguments[t]))e.identifiers=arguments[t],t+=1;else{for(i=t,r=arguments.length;i<r&&"string"==typeof arguments[i];i+=1)e.identifiers=Array.prototype.slice.call(arguments,t,i);t=i}return e.relationships=arguments[t],e}},_isRealObject:{value:function(e){return e&&"object"==typeof e&&!Array.isArray(e)&&!(e instanceof String)&&!(e instanceof Number)&&!(e instanceof Boolean)}}})}}),montageDefine("b7b5e36","core/gate",{dependencies:["./core","./logger","collections/map"],factory:function(e,t,i){var r=e("./core").Montage,n=e("./logger").logger("gate"),a=e("collections/map");t.Gate=r.specialize({init:{enumerable:!1,value:function(){return this.reset(),this}},initWithDelegate:{enumerable:!1,value:function(e){return this.reset(),this.delegate=e,this}},initWithDescriptor:{enumerable:!1,value:function(e){var t;this.reset();for(t in e)e.hasOwnProperty(t)&&this.setField(t,e[t].value);return this}},count:{value:0},table:{value:null},getField:{enumerable:!1,value:function(e){var t=this.table;return!t||t[e]}},setField:{enumerable:!1,value:function(e,t){var i,r=this.table||(this.table=new a),o=this.count;i=r[e],"undefined"!=typeof i||t?"undefined"!=typeof i&&i!==t?t?this.count--:this.count++:t&&n.isDebug&&n.debug(this,e+" was not set before."):this.count++,r[e]=!!t,0===this.count&&o>0?this.callDelegateMethod(!0):0===o&&this.count>0&&this.callDelegateMethod(!1)}},removeField:{enumerable:!1,value:function(e){var t=this.table,i=t[e];"undefined"==typeof i||i||this.count--,delete t[e]}},delegate:{enumerable:!1,value:null},callDelegateMethod:{value:function(e){var t;this.delegate&&"function"==typeof(t=this.delegate["gateDidBecome"+(e?"True":"False")])&&t.call(this.delegate,this)},enumerable:!1},value:{enumerable:!1,get:function(){return 0===this.count}},reset:{enumerable:!1,value:function(){this.table={},this.count=0}},toString:{value:function(){var e,t,i=this._fields,r="";for(e=0;t=i[e];e++)r+=t+"["+(this._value&i[t])+"], ";return r}}})}}),montageDefine("b7b5e36","data/model/object-descriptor",{dependencies:["core/core","data/model/property-descriptor"],factory:function(e,t,i){var r=e("core/core").Montage,n=e("data/model/property-descriptor").PropertyDescriptor;t.ObjectDescriptor=r.specialize({typeName:{value:void 0},objectPrototype:{value:r.prototype},propertyDescriptors:{get:function(){return this._propertyDescriptors||(this._propertyDescriptors={}),this._propertyDescriptors}},setPropertyDescriptor:{value:function(e,t){this.propertyDescriptors[e]=t}},deletePropertyDescriptor:{value:function(e){delete this.propertyDescriptors[e]}},makePropertyDescriptor:{value:function(){return new n}},_setPropertyDescriptorsFromTypes:{value:function(e){var t,i,r,n=Object.keys(e);for(t=0;r=n[t];++t)i=this.makePropertyDescriptor(),this.setPropertyDescriptor(r,i)}},_setPropertyDescriptorsFromPrototype:{value:function(e){for(var t,i,n,a;e!==r.prototype&&null!==e;e=Object.getPrototypeOf(e))for(t=Object.getOwnPropertyNames(e),n=0,a=t.length;n<a;n+=1)this.propertyDescriptors[t[n]]||(i=this.makePropertyDescriptor(),this.setPropertyDescriptor(t[n],i))}}},{getterFor:{value:function(e,t,i){var r=this;return function(){return this.hasOwnProperty("_TYPE")||(this._TYPE=new r,this._TYPE.typeName=t,this._TYPE.objectPrototype=e[t].prototype,i?this._TYPE._setPropertyDescriptorsFromTypes(i):this._TYPE._setPropertyDescriptorsFromPrototype(this._TYPE.objectPrototype)),this._TYPE}}}})}}),montageDefine("b7b5e36","core/document-part",{dependencies:["./core","./logger","./promise","./event/event-manager"],factory:function(e,t,i){var r=e("./core").Montage,n=(e("./logger").logger("document-part"),e("./promise").Promise),a=e("./event/event-manager").defaultEventManager,o=r.specialize({parentDocumentPart:{value:null},template:{value:null},fragment:{value:null},objects:{value:null},childComponents:{value:null},parameters:{value:null},initWithTemplateAndFragment:{value:function(e,t){this.template=e,this.fragment=t,this.objects=null,this.childComponents=[],this.parameters=null}},startActingAsTopComponent:{value:function(){this.fragment&&a.registerEventHandlerForElement(this,this.fragment)}},stopActingAsTopComponent:{value:function(){this.fragment&&a.unregisterEventHandlerForElement(this.fragment)}},addChildComponent:{value:function(e){this.childComponents.indexOf(e)===-1&&this.childComponents.push(e)}},removeChildComponent:{value:function(e){var t=this.childComponents,i=t.indexOf(e);i>-1&&(t.splice(i,1),e._parentComponent=null,e._alternateParentComponent=null)}},_addToDrawList:{value:Function.noop},_componentTreeLoadedDeferred:{value:null},loadComponentTree:{value:function(){if(!this._componentTreeLoadedDeferred){for(var e=[],t=this.childComponents,i=0,r=t.length;i<r;i++)e.push(t[i].loadComponentTree());this._componentTreeLoadedDeferred=n.all(e)}return this._componentTreeLoadedDeferred}}});t.DocumentPart=o}}),montageDefine("b7b5e36","composer/composer",{dependencies:["../core/target","../core/event/event-manager"],factory:function(e,t,i){var r=e("../core/target").Target,n=e("../core/event/event-manager").defaultEventManager;t.Composer=r.specialize({_component:{value:null},component:{get:function(){return this._component},set:function(e){this._component=e}},_element:{value:null},element:{get:function(){return this._element},set:function(e){this._element=e}},_shawdowRoot:{value:null},shawdowRoot:{get:function(){return this._shawdowRoot||(this._shawdowRoot=n.shawdowRootFromNode(this.element)),this._shawdowRoot}},lazyLoad:{value:!0},_needsFrame:{value:!1},needsFrame:{set:function(e){this._needsFrame!==e&&(this._needsFrame=e,this._component&&e&&this._component.scheduleComposer(this))},get:function(){return this._needsFrame}},frame:{value:Function.noop},_resolveDefaults:{value:function(){this.element||null!==this.element||null===this.component||(this.element=this.component.element)}},_isLoaded:{value:!1},isLoaded:{get:function(){return this._isLoaded}},load:{value:Function.noop},unload:{value:Function.noop},deserializedFromTemplate:{value:function(){this.component&&this.component.addComposer(this)}}},{isCoordinateOutsideRadius:{value:function(e,t,i){return e*e+t*t>i*i}}})}}),montageDefine("b7b5e36","core/meta/derived-descriptor",{dependencies:["./property-descriptor","../logger"],factory:function(e,t,i){var r=e("./property-descriptor").PropertyDescriptor,n=(e("../logger").logger("objectDescriptor"),{dependencies:[],getterDefinition:"",setterDefinition:""});t.DerivedDescriptor=r.specialize({serializeSelf:{value:function(e){this.dependencies.length>0&&this._setPropertyWithDefaults(e,"dependencies",this.dependencies),this._setPropertyWithDefaults(e,"getterDefinition",this.getterDefinition),this._setPropertyWithDefaults(e,"setterDefinition",this.setterDefinition)}},deserializeSelf:{value:function(e){this.dependencies=this._getPropertyWithDefaults(e,"dependencies"),this.getterDefinition=this._getPropertyWithDefaults(e,"getterDefinition"),this.setterDefinition=this._getPropertyWithDefaults(e,"setterDefinition")}},_setPropertyWithDefaults:{value:function(e,t,i){i!==n[t]&&e.setProperty(t,i)}},_getPropertyWithDefaults:{value:function(e,t){var i=e.getProperty(t);return i||this[t]||n[t]}},isDerived:{get:function(){return!0},serializable:!1},_dependencies:{value:null},dependencies:{get:function(){return this._dependencies||(this._dependencies=[])}},getterDefinition:{value:n.getterDefinition},setterDefinition:{value:n.setterDefinition}})}}),montageDefine("24e6f9c","ui/converter.reel/converter",{dependencies:["montage/ui/component","montage/core/criteria","logic/model/weather-report","logic/model/weather-report","logic/service/weather-service","logic/service/remote-data-service","montage/data/service/data-service","montage/data/service/data-selector"],factory:function(e,t,i){var r=e("montage/ui/component").Component,n=e("montage/core/criteria").Criteria,a=e("logic/model/weather-report").WeatherReport,o=(e("logic/model/weather-report").Type,e("logic/service/weather-service").WeatherService),s=(e("logic/service/remote-data-service").RemoteDataService,e("montage/data/service/data-service").DataService),l=e("montage/data/service/data-selector").DataSelector;t.Converter=r.specialize({constructor:{value:function(){var e=this;this["super"]();var t=new s;t.addChildService(new o);var i="city = $city && unit = $unit && country = $country",r={city:"San-Francisco",country:"us",unit:"imperial"},u=(new n).initWithExpression(i,r),c=a.TYPE,h=l.withTypeAndCriteria(c,u);t.fetchData(h).then(function(t){e.weatherReport=t[0]})}},_weatherReport:{value:null},weatherReport:{get:function(){return this._weatherReport},set:function(e){this._weatherReport!==e&&(this._weatherReport=e,this.needsDraw=!0)}}})}}),montageDefine("b7b5e36","core/target",{dependencies:["./core","./event/event-manager","./event/mutable-event"],factory:function(e,t,i){var r=e("./core").Montage,n=e("./event/event-manager").defaultEventManager,a=e("./event/mutable-event").MutableEvent;t.Target=r.specialize({acceptsActiveTarget:{serializable:!1,value:!1},isActiveTarget:{get:function(){return this===n.activeTarget}},willBecomeActiveTarget:{value:Function.noop},didBecomeActiveTarget:{value:Function.noop},surrendersActiveTarget:{value:function(e){return!0}},nextTarget:{serializable:!1,value:null},dispatchEvent:{value:function(e){var t=e instanceof a?e:a.fromEvent(e);return t.target=this,n.handleEvent(t),!e.defaultPrevented}},dispatchEventNamed:{value:function(e,t,i,r){var o=a.fromType(e,t,i,r);return o.target=this,n.handleEvent(o),!o.defaultPrevented}},addEventListener:{value:function(e,t,i){t&&n.registerEventListener(this,e,t,i)}},removeEventListener:{value:function(e,t,i){t&&n.unregisterEventListener(this,e,t,i)}},loadComposer:{value:function(e){e&&!e._isLoaded&&(e._resolveDefaults(),e.load(),e._isLoaded=!0)}},unloadComposer:{value:function(e){e&&e._isLoaded&&(e.unload(),e._isLoaded=!1)}}})}}),montageDefine("24e6f9c","ui/main.reel/main.html",{text:'<!DOCTYPE html><html><head><meta http-equiv=content-type content="text/html; charset=utf-8"><title>Main</title><style>*{-moz-box-sizing:border-box;box-sizing:border-box}body{margin:0;font-family:"Lucida Grande","Trebuchet MS",Verdana,sans-serif;color:hsl(0,0%,60%);background-color:hsl(0,0%,95%)}.Main{padding:3em 1em;text-align:center}.Title{font-size:1.3em}</style><script type=text/montage-serialization>{"owner":{"properties":{"element":{"#":"main"}}},"title":{"prototype":"ui/title.reel","properties":{"element":{"#":"title"}},"bindings":{"value":{"<->":"@owner.titleValue"}}},"tempConverter":{"prototype":"ui/converter.reel","properties":{"element":{"#":"tempConverter"}}},"montageVersion":{"prototype":"ui/version.reel","properties":{"element":{"#":"montageVersion"}}}}</script></head><body><div data-montage-id=main data-montage-skin=light class=Main><h1 data-montage-id=title class=Title></h1><div data-montage-id=tempConverter></div><footer data-montage-id=montageVersion></footer></div></body></html>'}),montageDefine("b7b5e36","core/meta/validation-semantics",{dependencies:["../core","../deprecate","../logger"],factory:function(e,t,i){var r=e("../core").Montage,n=r,a=e("../deprecate"),o=(e("../logger").logger("objectDescriptor"),t.PropertyValidationSemantics=n.specialize({initWithObjectDescriptor:{value:function(e){return this._objectDescriptor=e,this}},_objectDescriptor:{value:void 0},objectDescriptor:{get:function(){return this._objectDescriptor}},compile:{value:function(e,t){n.compile.call(this,e,t)}},operators:{value:{isBound:function(e){return!e}}},evaluators:{value:{isBound:function(e,t){var i=this;return function(r,n){return r=i.count(e(r,n)),t(r,n)}}}},initWithBlueprint:{value:a.deprecateMethod(void 0,function(e){return this.initWithObjectDescriptor(e)},"initWithBlueprint","initWithObjectDescriptor")},blueprint:{get:a.deprecateMethod(void 0,function(){return this._blueprint},"blueprint","objectDescriptor")}}));for(var s in n.operators)n.operators.hasOwnProperty(s)&&(o.operators[s]=n.operators[s]);for(var l in n.evaluators)n.evaluators.hasOwnProperty(l)&&(o.evaluators[l]=n.evaluators[l])}}),montageDefine("b7b5e36","core/exception",{dependencies:["./core","./logger"],factory:function(e,t,i){var r=e("./core").Montage;e("./logger").logger("exception"),t.Exception=r.specialize({message:{value:null},target:{value:null},method:{value:null},initWithMessage:{enumerable:!0,value:function(e){return this.initWithMessageTargetAndMethod(e,null,null)}},initWithMessageAndTarget:{enumerable:!0,value:function(e,t){return this.initWithMessageTargetAndMethod(e,t,null)}},initWithMessageTargetAndMethod:{enumerable:!0,value:function(e,t,i){return this.message="undefined"!=typeof e?e:null,Object.defineProperty(this,"message",{writable:!1}),this.target="undefined"!=typeof t?t:null,Object.defineProperty(this,"target",{writable:!1}),this.method="undefined"!=typeof i?i:null,Object.defineProperty(this,"method",{writable:!1}),this}},toString:{enumerable:!1,value:function(){return"Exception: "+(null!==this.message?this.message+" ":null)+(null!==this.target?this.target+" ":null)+(null!==this.method?this.method+" ":null)}}})}}),montageDefine("24e6f9c","logic/service/weather-service",{dependencies:["montage/data/service/http-service","montage/data/service/data-service","montage/data/service/data-selector","../model/weather-report"],factory:function(e,t,i){var r=e("montage/data/service/http-service").HttpService;e("montage/data/service/data-service").DataService,e("montage/data/service/data-selector").DataSelector,e("../model/weather-report").WeatherReport,t.WeatherService=r.specialize({API_KEY:{value:"7593a575795cbd73f54c69a321ed86fe"},ENDPOINT:{value:"http://api.openweathermap.org/data/2.5/"},fetchRawData:{value:function(e){var t=this,i=e.selector.criteria;return t.fetchHttpRawData(this._getUrl(i,!0),!1).then(function(r){r&&(t.addRawData(e,[r],i),t.rawDataDone(e))})}},mapFromRawData:{value:function(e,t,i){e.temp=t.main.temp}},_getUrl:{value:function(e,t){var i=e.parameters;return this.ENDPOINT+"weather?q="+i.city+","+i.country+"&units="+i.unit+"&appid="+this.API_KEY}}})}}),montageDefine("b7b5e36","ui/text.reel/text",{dependencies:["../component"],factory:function(e,t,i){var r=e("../component").Component,n=t.Text=r.specialize({hasTemplate:{value:!1},_value:{value:null},value:{get:function(){return this._value},set:function(e){this._value!==e&&(this._value=e,this.needsDraw=!0)}},converter:{value:null},defaultValue:{value:""},_valueNode:{value:null},_RANGE:{value:document.createRange()},enterDocument:{value:function(e){if(e){var t=this._RANGE;t.selectNodeContents(this.element),t.deleteContents(),this._valueNode=document.createTextNode(""),t.insertNode(this._valueNode),this.element.classList.add("montage-Text")}}},draw:{value:function(){var e="undefined"!=typeof this._value&&null!==this._value?this._value:this.defaultValue;this._valueNode.data=this.converter?this.converter.convert(e):e}}});window.MontageElement&&MontageElement.define("montage-text",n,{observedAttributes:["value"]})}}),montageDefine("b7b5e36","data/model/data-identifier",{dependencies:["core/core"],factory:function(e,t,i){var r=e("core/core").Montage;t.DataIdentifier=r.specialize({dataService:{value:void 0},objectDescriptor:{value:void 0},primaryKey:{value:void 0},_typeName:{value:void 0},typeName:{get:function(){return this._typeName||(this._typeName=this.objectDescriptor?this.objectDescriptor.name:"MISSING_TYPE_NAME")},set:function(e){this._typeName=e}},isPersistent:{value:!1},_identifier:{value:!1},_url:{value:void 0},url:{get:function(){if(!this._url){var e="montage-data://";e+=this.dataService.identifier,e+="/",e+=this.dataService.connectionDescriptor?this.dataService.connectionDescriptor.name:"default",e+="/",e+=this.objectDescriptor.name,e+="/",e+=this.primaryKey,this._url=e}return this._url},set:function(e){return this._url=e}}})}}),montageDefine("b7b5e36","ui/base/abstract-control",{dependencies:["../component","collections/map"],factory:function(e,t,i){var r=e("../component").Component,n=e("collections/map");t.AbstractControl=r.specialize({dispatchActionEvent:{value:function(){return this.dispatchEvent(this.createActionEvent())}},_detail:{value:null},detail:{get:function(){return null!==this._detail&&void 0!==this._detail||(this._detail=new n),this._detail}},createActionEvent:{value:function(){var e,t=document.createEvent("CustomEvent");return e=this._detail,t.initCustomEvent("action",!0,!0,e),t}},disabled:{get:function(){return!this.enabled},set:function(e){"boolean"==typeof e&&(this.enabled=!e)}}})}}),montageDefine("b7b5e36","data/model/data-query",{dependencies:["montage"],factory:function(e,t,i){var r=e("montage").Montage;t.DataQuery=r.specialize({type:{value:void 0},criteria:{get:function(){return this._criteria||(this._criteria={}),this._criteria},set:function(e){this._criteria=e}},_criteria:{value:void 0},orderings:{get:function(){return this._orderings||(this._orderings=[]),this._orderings},set:function(e){this._orderings=e}},_orderings:{value:void 0},selectBindings:{value:void 0},selectExpression:{value:void 0},prefetchExpressions:{value:null}},{withTypeAndCriteria:{value:function(e,t){var i;return i=new this,i.type=e,i.criteria=t,i}}})}}),montageDefine("b7b5e36","data/service/data-mapping",{dependencies:["core/core"],factory:function(e,t,i){var r=e("core/core").Montage;t.DataMapping=r.specialize({mapRawDataToObject:{value:function(e,t,i){var r,n,a=Object.keys(e);if(e)for(r=0;n=a[r];++r)t[n]=e[n]}},mapObjectToRawData:{value:function(e,t){}},nullPromise:{
get:function(){return this._nullPromise||(this._nullPromise=Promise.resolve(null)),this._nullPromise}},mapFromRawData:{value:function(e,t,i){this.mapRawDataToObject(t,e,i)}},mapToRawData:{value:function(e,t){this.mapObjectToRawData(e,t)}}},{withObjectDescriptor:{value:function(e){var t=new this;return t._descriptor=e,t}}})}}),montageDefine("24e6f9c","ui/version.reel/version.html",{text:'<!DOCTYPE html><html><head><title></title><style>.Version{color:hsl(0,0%,80%)}</style><script type=text/montage-serialization>{"owner":{"properties":{"element":{"#":"version"}}},"montageVersion":{"prototype":"montage/ui/text.reel","properties":{"element":{"#":"montageVersion"}},"bindings":{"value":{"<-":"@owner.montageDescription.version"}}}}</script></head><body><footer data-montage-id=version class=Version>Montage version: <span data-montage-id=montageVersion></span></footer></body></html>'}),montageDefine("24e6f9c","logic/model/weather-report",{dependencies:["montage","montage/data/model/data-object-descriptor"],factory:function(e,t,i){var r=e("montage").Montage;e("montage/data/model/data-object-descriptor").DataObjectDescriptor,t.WeatherReport=WeatherReport=r.specialize({temp:{value:null},constructor:{value:function(){}}},{TYPE:{get:function(){return WeatherReport.objectPrototype=WeatherReport,WeatherReport}}})}}),montageDefine("b7b5e36","data/service/authorization-policy",{dependencies:["core/core"],factory:function(e,t,i){var r=e("core/core").Montage,n=t.AuthorizationPolicy=r.specialize({id:{value:void 0}},{withID:{value:function(e){var t=new this;return t.id=e,t}}});n.ON_DEMAND=n.withID("ON_DEMAND"),n.ON_FIRST_FETCH=n.withID("ON_FIRST_FETCH"),n.NONE=n.withID("NONE"),n.UP_FRONT=n.withID("UP_FRONT")}}),montageDefine("cf0fb3f","ui/title.reel/title.html",{text:'<!DOCTYPE html><html><head><title></title><style>.digit-Title{margin:0;padding:0;font-size:1.5em;line-height:1.5}[data-montage-skin="light"] .digit-Title{color:hsl(0,0%,40%);text-shadow:0 1px 0 hsla(0,0%,100%,.8)}[data-montage-skin="dark"] .digit-Title{color:hsl(0,0%,80%)}</style></head><body></body></html>'}),montageDefine("24e6f9c","ui/version.reel/version",{dependencies:["montage/ui/component"],factory:function(e,t,i){var r=e("montage/ui/component").Component;t.Version=r.specialize({constructor:{value:function(){this["super"]()}},montageDescription:{get:function(){return("undefined"!=typeof montageRequire?montageRequire:mr).packageDescription}}})}}),montageDefine("cf0fb3f","ui/button.reel/button",{dependencies:["montage/ui/base/abstract-button"],factory:function(e,t,i){var r=e("montage/ui/base/abstract-button").AbstractButton;t.Button=r.specialize({hasTemplate:{value:!0},constructor:{value:function(){this["super"](),this.classList.add("digit-Button")}}})}}),montageDefine("cf0fb3f","ui/text-field.reel/text-field",{dependencies:["montage/ui/base/abstract-text-field"],factory:function(e,t,i){var r=e("montage/ui/base/abstract-text-field").AbstractTextField;t.TextField=r.specialize({hasTemplate:{value:!0},constructor:{value:function(){this["super"]()}}})}}),montageDefine("b7b5e36","data/service/data-provider",{dependencies:["core/core","core/promise"],factory:function(e,t,i){var r=e("core/core").Montage,n=e("core/promise").Promise;t.DataProvider=r.specialize({data:{value:void 0},requestData:{value:function(e,t){return n.resolve(this.data)}}})}}),montageDefine("cf0fb3f","ui/number-field.reel/number-field",{dependencies:["montage/ui/base/abstract-number-field"],factory:function(e,t,i){var r=e("montage/ui/base/abstract-number-field").AbstractNumberField;t.NumberField=r.specialize({constructor:{value:function(){this["super"]()}}})}}),montageDefine("24e6f9c","ui/main.reel/main",{dependencies:["montage/ui/component"],factory:function(e,t,i){var r=e("montage/ui/component").Component;t.Main=r.specialize({constructor:{value:function(){this["super"]()}},titleValue:{get:function(){return"Temperature Converter"}}})}}),montageDefine("cf0fb3f","ui/title.reel/title",{dependencies:["montage/ui/text.reel"],factory:function(e,t,i){var r=e("montage/ui/text.reel").Text;t.Title=r.specialize({hasTemplate:{value:!0},constructor:{value:function(){this["super"](),this.classList.add("digit-Title")}}})}}),montageDefine("b7b5e36","data/model/data-property-descriptor",{dependencies:["data/model/property-descriptor"],factory:function(e,t,i){var r=e("data/model/property-descriptor").PropertyDescriptor;t.DataPropertyDescriptor=r.specialize({isGlobal:{value:!1}})}}),montageDefine("cf0fb3f","ui/slider.reel/slider",{dependencies:["montage/ui/base/abstract-slider"],factory:function(e,t,i){var r=e("montage/ui/base/abstract-slider").AbstractSlider;t.Slider=r.specialize({constructor:{value:function(){this["super"]()}}})}}),montageDefine("24e6f9c","ui/title.reel/title",{dependencies:["digit/ui/title.reel"],factory:function(e,t,i){var r=e("digit/ui/title.reel").Title;t.Title=r.specialize({constructor:{value:function(){this["super"](),this.classList.add("my-Title")}}})}}),montageDefine("b7b5e36","data/model/property-descriptor",{dependencies:["core/core"],factory:function(e,t,i){var r=e("core/core").Montage;t.PropertyDescriptor=r.specialize({isRelationship:{value:!1},isOptional:{value:!1}})}}),montageDefine("b7b5e36","data/service/data-selector",{dependencies:["data/model/data-selector"],factory:function(e,t,i){var r=e("data/model/data-selector").DataSelector;t.DataSelector=r}}),montageDefine("b7b5e36","data/model/data-selector",{dependencies:["data/model/data-query"],factory:function(e,t,i){var r=e("data/model/data-query").DataQuery;t.DataSelector=r}}),montageDefine("b7b5e36","core/selector",{dependencies:["./criteria"],factory:function(e,t,i){var r=e("./criteria").Criteria;t.Selector=r}}),montageDefine("24e6f9c","ui/title.reel/title.html",{text:"<!DOCTYPE html><html><head><title></title></head><body></body></html>"}),montageDefine("b7b5e36","core/dom",{dependencies:["./extras/dom"],factory:function(e,t,i){e("./extras/dom")}});
bundleLoaded("run-tests.html.bundle-1-0.js")